import{_decorator,Component,director,SpriteFrame,Texture2D,instantiate,native,assetManager,Node,UITransform,CCFloat,Size as Size$1,NodeEventType,Enum,Vec3 as Vec3$1,Label,v3 as v3$1,dynamicAtlasManager,Sprite,SpriteAtlas,CCInteger,UIRenderer,cclegacy,InstanceMaterialType,RenderTexture,Material,EventTarget,Vec2 as Vec2$1,UIOpacity,Input,misc,CCBoolean,RigidBody2D}from"cc";import{NATIVE,EDITOR,BUILD}from"cc/env";class Singleton{constructor(){this._isDisposed=!1}static get(){const t=this;if(null==t._inst)throw new Error(`Singleton is not initialized or destroyed, name is ${t.name}`);return t._inst}get isDisposed(){return this._isDisposed}dispose(){this._onPreDestroy()}_onPreDestroy(){this._isDisposed||(this.destroy&&this.destroy(),Singleton._inst=null,this._isDisposed=!0)}}class TimeInfo extends Singleton{constructor(){super(...arguments),this.deltaTime=0}awake(){this.serverMinusClientTime=0}clientNow(){return Date.now()}serverNow(){return this.clientNow()+this.serverMinusClientTime}update(t){this.deltaTime=t}}class JsHelper{static getMethodName(){const t=(new Error).stack.split("at ")[2],e=t.indexOf(" ");return t.substring(0,e)}static getRootDirName(t){return t.split("/")[0]}static sleep(t){return new Promise((e=>setTimeout(e,t)))}static isNullOrEmpty(t){return null==t||(0==t.length||void 0)}static getStringHashCode(t){let e=5381,s=t.length;for(;s;)e=33*e^t.charCodeAt(--s);return e>>>0}static modeString(t,e){return this.getStringHashCode(t)%e}static powBigInt(t,e){let s=BigInt(1);for(let i=0;i<e;i++)s*=t;return s}static formatStr(t,...e){if("string"!=typeof t){const t=new Error("formatStr args err");return t.name+t.stack}if(0==e.length)return t;return t.replace(/\{\{|\}\}|\{(\d+)\}/g,(function(t,s){return"{{"==t?"{":"}}"==t?"}":e[s]}))}}class Options extends Singleton{constructor(){super(...arguments),this.isServer=!1,this.logLevel=1,this.develop=!0}}class LoggerDefault{log(t){console.log(t)}warn(t){console.warn(t)}error(t){console.error(t)}}class Logger extends Singleton{set iLog(t){this._logInst=t}get _iLog(){return this._logInst||(this._logInst=new LoggerDefault,this._logInst.warn("not set iLog, use default logger")),this._logInst}log(t,...e){if(this.checkLogLevel(Logger.LOG_LEVEL)){const s=JsHelper.formatStr(t,...e);this._iLog.log(s)}}warn(t,...e){if(this.checkLogLevel(Logger.WARN_LEVEL)){const s=JsHelper.formatStr(t,...e);this._iLog.warn(s)}}error(t,...e){const s=JsHelper.formatStr(t,...e);this._iLog.error(s)}checkLogLevel(t){return Options.get().logLevel<=t}coreLog(t){this._iLog.log(t)}coreWarn(t){this._iLog.warn(t)}coreError(t){this._iLog.error(t)}}function log(t,...e){Logger.get().log(t,...e)}function warn(t,...e){Logger.get().warn(t,...e)}function error(t,...e){Logger.get().error(t,...e)}function coreLog(t,e,...s){const i=`[${t}]: ${JsHelper.formatStr(e,...s)}`;try{Logger.get().coreLog(i)}catch(t){console.log(i)}}function coreWarn(t,e,...s){const i=`[${t}]: ${JsHelper.formatStr(e,...s)}`;try{Logger.get().coreWarn(i)}catch(t){console.warn(i)}}function coreError(t,e,...s){const i=`[${t}]: ${JsHelper.formatStr(e,...s)}`;try{Logger.get().coreError(i)}catch(t){console.error(i)}}Logger.LOG_LEVEL=1,Logger.WARN_LEVEL=2;const IdGeneratorTag="IdGenerator",timeBit$1=30n,processBit=14n,valueBit$1=20n,powTimeBit$1=JsHelper.powBigInt(2n,timeBit$1)-1n,powProcessBit=JsHelper.powBigInt(2n,processBit)-1n,powValueBit$1=JsHelper.powBigInt(2n,valueBit$1)-1n,epoch$1=new Date(2023,4,1).getTime();class IdStruct{static get inst(){return null==IdStruct._inst&&(IdStruct._inst=new IdStruct),IdStruct._inst}static generate(){0==this._lastTime&&(this._lastTime=this.timeSinceEpoch(),this._lastTime<=0&&(coreWarn("IdGenerator","{0}: lastTime less than 0: {1}",(new this).constructor.name,this._lastTime),this._lastTime=1));const t=this.timeSinceEpoch();t>this._lastTime?(this._lastTime=t,this._idCount=0):(++this._idCount,this._idCount>powValueBit$1&&(++this._lastTime,this._idCount=0,coreError("IdGenerator","{0}: idCount per sec overflow: {1} {2}",(new this).constructor.name,t,this._lastTime)));const e=IdStruct.inst;return e.init(this._lastTime,1,this._idCount),e.result}static convertToId(t,e,s){return IdStruct.inst.init(t,e,s).result}static parseId(t){return IdStruct.inst.initById(t)}static timeSinceEpoch(){const t=(TimeInfo.get().clientNow()-epoch$1)/1e3;return Math.floor(t)}initById(t){return this.result=t,this.time=t&powTimeBit$1,t>>=timeBit$1,this.process=t&powProcessBit,t>>=processBit,this.value=t&powValueBit$1,this}init(t,e,s){return this.time=BigInt(t),this.process=BigInt(e),this.value=BigInt(s),this.updateResult(),this}updateResult(){this.result=this.value,this.result<<=processBit,this.result|=this.process,this.result<<=timeBit$1,this.result|=this.time}}IdStruct._lastTime=0,IdStruct._idCount=0;const timeBit=32n,valueBit=32n,powTimeBit=JsHelper.powBigInt(2n,timeBit)-1n,powValueBit=JsHelper.powBigInt(2n,valueBit)-1n,epoch=new Date(2023,4,1).getTime();class InstanceIdStruct{static get inst(){return null==InstanceIdStruct._inst&&(InstanceIdStruct._inst=new InstanceIdStruct),InstanceIdStruct._inst}static generate(){0==this._lastTime&&(this._lastTime=this.timeSinceEpoch(),this._lastTime<=0&&(coreWarn("IdGenerator","{0}: lastTime less than 0: {1}",(new this).constructor.name,this._lastTime),this._lastTime=1));const t=this.timeSinceEpoch();t>this._lastTime?(this._lastTime=t,this._idCount=0):(++this._idCount,this._idCount>powValueBit&&(++this._lastTime,this._idCount=0,coreError("IdGenerator","{0}: idCount per sec overflow: {1} {2}",(new this).constructor.name,t,this._lastTime)));const e=InstanceIdStruct.inst;return e.init(this._lastTime,this._idCount),e.result}static convertToId(t,e){return InstanceIdStruct.inst.init(t,e).result}static parseId(t){return InstanceIdStruct.inst.initById(t)}static timeSinceEpoch(){const t=(TimeInfo.get().clientNow()-epoch)/1e3;return Math.floor(t)}initById(t){return this.result=t,this.time=t&powTimeBit,t>>=timeBit,this.value=t&powValueBit,this}init(t,e){return this.time=BigInt(t),this.value=BigInt(e),this.updateResult(),this}updateResult(){this.result=this.value,this.result<<=timeBit,this.result|=this.time}}InstanceIdStruct._lastTime=0,InstanceIdStruct._idCount=0;class IdGenerator extends Singleton{generateInstanceId(){return InstanceIdStruct.generate()}generateId(){return IdStruct.generate()}}class ObjectPool extends Singleton{constructor(){super(...arguments),this._pool=new Map}fetch(t){const e=this._pool.get(t);return e?0===e.length?new t:e.shift():new t}recycle(t){const e=t.constructor;let s=this._pool.get(e);s||(s=[],this._pool.set(e,s)),s.length>1e3?console.warn(`pool ${e.name} is too large`):s.push(t)}}class EntityCenter extends Singleton{constructor(){super(...arguments),this._allEntities=new Map}add(t){this._allEntities.set(t.instanceId,t)}remove(t){this._allEntities.delete(t)}get(t){return this._allEntities.get(t)}}var InstanceQueueIndex,EntityStatus,SceneType;!function(t){t[t.NONE=-1]="NONE",t[t.UPDATE=0]="UPDATE",t[t.LATE_UPDATE=1]="LATE_UPDATE",t[t.MAX=2]="MAX"}(InstanceQueueIndex||(InstanceQueueIndex={}));class EntityLifiCycleMgr extends Singleton{constructor(){super(...arguments),this._queues=new Array(InstanceQueueIndex.MAX)}awake(){for(let t=0;t<this._queues.length;t++)this._queues[t]=[]}registerSystem(t){t.update&&this._queues[InstanceQueueIndex.UPDATE].push(t.instanceId),t.lateUpdate&&this._queues[InstanceQueueIndex.LATE_UPDATE].push(t.instanceId)}awakeComEvent(t){t.awake()}destroyComEvent(t){t.destroy()}update(){const t=this._queues[InstanceQueueIndex.UPDATE],e=EntityCenter.get();for(let s=t.length-1;s>=0;s--){const i=t[s],r=e.get(i);r?r.isDisposed?t.splice(s,1):r.update():t.splice(s,1)}}lateUpdate(){const t=this._queues[InstanceQueueIndex.LATE_UPDATE],e=EntityCenter.get();for(let s=t.length-1;s>=0;s--){const i=t[s],r=e.get(i);r?r.isDisposed?t.splice(s,1):r.lateUpdate():t.splice(s,1)}}}!function(t){t[t.NONE=0]="NONE",t[t.IS_FROM_POOL=1]="IS_FROM_POOL",t[t.IS_REGISTER=2]="IS_REGISTER",t[t.IS_COMPONENT=4]="IS_COMPONENT",t[t.IS_CREATED=8]="IS_CREATED",t[t.IS_NEW=16]="IS_NEW"}(EntityStatus||(EntityStatus={}));class Entity{constructor(){this._status=EntityStatus.NONE}get parent(){return this._parent}set parent(t){if(null==t)throw new Error(`cant set parent null: ${this.constructor.name}`);if(t==this)throw new Error(`cant set parent self: ${this.constructor.name}`);if(null==t.domain)throw new Error(`cant set parent because parent domain is null: ${this.constructor.name} ${t.constructor.name}`);if(null!=this._parent){if(this._parent==t)throw new Error(`重复设置了Parent: ${this.constructor.name} parent: ${this._parent.constructor.name}`);this._parent.removeFromChildren(this)}this._parent=t,this.isComponent=!1,this._parent.addToChildren(this),this.domain=this.parent.domain}get domain(){return this._domain}set domain(t){if(null==t)throw new Error(`domain cant set null: ${this.constructor.name}`);if(this._domain==t)return;const e=this._domain;if(this._domain=t,null==e&&(this.instanceId=IdGenerator.get().generateInstanceId(),this.isRegister=!0),null!=this._children)for(const[t,e]of this._children.entries())e.domain=this._domain;if(null!=this._components)for(const[t,e]of this._components.entries())e.domain=this._domain;this.isCreated||(this.isCreated=!0)}get isDisposed(){return 0n==this.instanceId}get children(){return this._children??(this._children=ObjectPool.get().fetch(Map))}get components(){return this._components??(this._components=ObjectPool.get().fetch(Map))}get isFromPool(){return(this._status&EntityStatus.IS_FROM_POOL)==EntityStatus.IS_FROM_POOL}set isFromPool(t){t?this._status|=EntityStatus.IS_FROM_POOL:this._status&=~EntityStatus.IS_FROM_POOL}get isComponent(){return(this._status&EntityStatus.IS_COMPONENT)==EntityStatus.IS_COMPONENT}set isComponent(t){t?this._status|=EntityStatus.IS_COMPONENT:this._status&=~EntityStatus.IS_COMPONENT}get isCreated(){return(this._status&EntityStatus.IS_CREATED)==EntityStatus.IS_CREATED}set isCreated(t){t?this._status|=EntityStatus.IS_CREATED:this._status&=~EntityStatus.IS_CREATED}get isNew(){return(this._status&EntityStatus.IS_NEW)==EntityStatus.IS_NEW}set isNew(t){t?this._status|=EntityStatus.IS_NEW:this._status&=~EntityStatus.IS_NEW}get isRegister(){return(this._status&EntityStatus.IS_REGISTER)==EntityStatus.IS_REGISTER}set isRegister(t){if(this.isRegister!=t)if(t?this._status|=EntityStatus.IS_REGISTER:this._status&=~EntityStatus.IS_REGISTER,t){const t=this;EntityCenter.get().add(t),EntityLifiCycleMgr.get().registerSystem(t)}else EntityCenter.get().remove(this.instanceId)}set componentParent(t){if(null==t)throw new Error(`cant set parent null: ${this.constructor.name}`);if(t==this)throw new Error(`cant set parent self: ${this.constructor.name}`);if(null==t.domain)throw new Error(`cant set parent because parent domain is null: ${this.constructor.name} ${t.constructor.name}`);if(null!=this.parent){if(this.parent==t)throw new Error(`重复设置了Parent: ${this.constructor.name} parent: ${this.parent.constructor.name}`);this.parent.removeFromComponents(this)}this._parent=t,this.isComponent=!0,this._parent.addToComponents(this),this.domain=this.parent.domain}addCom(t,e){return t instanceof Entity?this.addComByEntity(t):this.addComByType(t,e)}tryAddCom(t){let e=this.getCom(t);return null==e&&(e=this.addCom(t)),e}addComByEntity(t){const e=t.constructor;if(null!=this._components&&this._components.has(e))throw new Error(`entity already has component: ${e.name}`);return t.componentParent=this,t}addComByType(t,e=!1){if(null!=this._components&&this._components.has(t))throw new Error(`entity already has component: ${t.name}`);const s=this.create(t,e);return s.id=this.id,s.componentParent=this,s.awake&&EntityLifiCycleMgr.get().awakeComEvent(s),s}addChild(t,e){return t instanceof Entity?this.addChildByEntity(t):this.addChildByType(t,e)}addChildWithId(t,e,s=!1){const i=this.create(t,s);return i.id=e,i.parent=this,i.awake&&EntityLifiCycleMgr.get().awakeComEvent(i),i}addChildByEntity(t){return t.parent=this,t}addChildByType(t,e=!1){const s=this.create(t,e);return s.id=IdGenerator.get().generateId(),s.parent=this,s.awake&&EntityLifiCycleMgr.get().awakeComEvent(s),s}create(t,e){let s;return s=e?ObjectPool.get().fetch(t):new t,s.isFromPool=e,s.isCreated=!0,s.isNew=!0,s.id=0n,s}removeFromChildren(t){null!=this._children&&(this._children.delete(t.id),0==this._children.size&&(ObjectPool.get().recycle(this._children),this._children=null))}removeFromComponents(t){null!=this._components&&(this._components.delete(t.constructor),0==this._components.size&&(ObjectPool.get().recycle(this._components),this._components=null))}addToComponents(t){this.components.set(t.constructor,t)}addToChildren(t){if(this.children.has(t.id))throw new Error(`entity already has child: ${t.id}`);this.children.set(t.id,t)}getCom(t){if(null==this._components)return null;const e=this._components.get(t);return e||null}removeCom(t){if(this.isDisposed)return;if(null==this._components)return;const e=this.getCom(t);null!=e&&(this.removeFromComponents(e),e.dispose())}getParent(t){return this.parent}getChild(t,e){if(null==this._children)return null;return this._children.get(e)}removeChild(t){if(null==this._children)return;const e=this._children.get(t);e&&(this._children.delete(t),e.dispose())}dispose(){if(!this.isDisposed){if(this.isRegister=!1,this.instanceId=0n,null!=this._children){for(const[t,e]of this._children.entries())e.dispose();this._children.clear(),ObjectPool.get().recycle(this._children),this._children=null}if(null!=this._components){for(const[t,e]of this._components.entries())e.dispose();this._components.clear(),ObjectPool.get().recycle(this._components),this._components=null}this.destroy&&EntityLifiCycleMgr.get().destroyComEvent(this),this._domain=null,null==this._parent||this._parent.isDisposed||(this.isComponent?this._parent.removeCom(this.getType()):this._parent.removeFromChildren(this)),this._parent=null,this.isFromPool&&ObjectPool.get().recycle(this),this._status=EntityStatus.NONE}}domainScene(){return this.domain}getType(){return this.constructor}}class Scene extends Entity{set domain(t){this._domain=t}get domain(){return this._domain}set parent(t){null!=t&&(this._parent=t,this._parent.children.set(this.id,this))}get parent(){return this._parent}init(t){this.id=t.id,this.instanceId=t.instanceId,this.sceneType=t.sceneType,this.name=t.name,this.parent=t.parent,this.isCreated=!0,this.isNew=!0,this.domain=this,this.isRegister=!0,coreLog("scene","scene create sceneType = {0}, name = {1}, id = {2}",this.sceneType,this.name,this.id)}}!function(t){t.NONE="NONE",t.PROCESS="PROCESS",t.CLIENT="CLIENT",t.CURRENT="CURRENT"}(SceneType||(SceneType={}));class Root extends Singleton{get scene(){return this._scene}awake(){const t=new Scene;t.init({id:0n,sceneType:SceneType.PROCESS,name:"Process",instanceId:IdGenerator.get().generateInstanceId()}),this._scene=t}}class RecycleObj{constructor(){this._isRecycle=!1}static create(t){const e=ObjectPool.get().fetch(this);return t&&Object.assign(e,t),e._isRecycle=!0,e}dispose(){this._isRecycle&&ObjectPool.get().recycle(this)}}class AEvent extends RecycleObj{}class BeforeSingletonAdd extends AEvent{}class AfterSingletonAdd extends AEvent{}class BeforeProgramInit extends AEvent{}class AfterProgramInit extends AEvent{}class BeforeProgramStart extends AEvent{}class AfterProgramStart extends AEvent{}class AfterCreateClientScene extends AEvent{}class AfterCreateCurrentScene extends AEvent{}class DecoratorCollector{constructor(){this._decorators=new Map}static get inst(){return null==DecoratorCollector._inst&&(DecoratorCollector._inst=new DecoratorCollector),DecoratorCollector._inst}add(t,...e){let s=this._decorators.get(t);s||(s=[],this._decorators.set(t,s)),s.push(e)}get(t){return this._decorators.get(t)||[]}}const EventDecoratorType="EventDecoratorType";function EventDecorator(t,e){return function(s){null==e&&console.error("EventDecorator必须要传 sceneType"),DecoratorCollector.inst.add(EventDecoratorType,t,s,e)}}class EventInfo{constructor(t,e){this.eventHandler=t,this.sceneType=e}}class MoyeEventCenter{constructor(){this.allEvents=new Map}static get inst(){return null==this._inst&&(this._inst=new MoyeEventCenter,this._inst.reloadEvent()),this._inst}reloadEvent(){const t=DecoratorCollector.inst.get(EventDecoratorType);this.allEvents.clear();for(const e of t){const t=e[0],s=e[1],i=e[2];let r=this.allEvents.get(t);r||(r=[],this.allEvents.set(t,r)),r.push(new EventInfo(new s,i))}}publish(t){const e=this.allEvents.get(t.constructor);if(e){for(let s=0;s<e.length;s++){e[s].eventHandler.handle(null,t)}t.dispose()}}}class Task extends Promise{static create(t){let e;const s=new Task((t=>{e=t}));return s._resolve=e,s}setResult(t){if(!this._resolve)throw new Error("setResult but task has been disposed");this._resolve(t),this.dispose()}constructor(t){super(t)}dispose(){this._resolve=null}}class Game{static addSingleton(t,e=!0){if(Game._singletonMap.has(t))throw new Error(`already exist singleton: ${t.name}`);e&&MoyeEventCenter.inst.publish(BeforeSingletonAdd.create({singletonType:t}));const s=new t;t._inst=s,Game._singletonMap.set(t,s),Game._singletons.push(s);const i=s;return i.awake&&i.awake(),Game._destroys.push(i),i.update&&Game._updates.push(i),i.lateUpdate&&Game._lateUpdates.push(i),e&&MoyeEventCenter.inst.publish(AfterSingletonAdd.create({singletonType:t})),s}static async waitFrameFinish(){const t=Task.create();Game._frameFinishTaskQueue.push(t),await t}static update(t){for(let e=0;e<Game._updates.length;e++){const s=Game._updates[e];s.isDisposed||s.update(t)}}static lateUpdate(t){for(let e=0;e<Game._lateUpdates.length;e++){const s=Game._lateUpdates[e];s.isDisposed||s.lateUpdate(t)}}static frameFinishUpdate(){const t=Game._frameFinishTaskQueue.length;if(0!=t){for(let e=0;e<t;e++){Game._frameFinishTaskQueue[e].setResult()}Game._frameFinishTaskQueue=[]}}static dispose(){for(let t=Game._singletons.length-1;t>=0;t--){const e=Game._singletons[t];e.isDisposed||e._onPreDestroy()}}}Game._singletonMap=new Map,Game._singletons=[],Game._destroys=[],Game._updates=[],Game._lateUpdates=[],Game._frameFinishTaskQueue=[];class EventSystem extends Singleton{async publishAsync(t,e){const s=MoyeEventCenter.inst.allEvents.get(e.constructor);if(!s)return;const i=[];for(let r=0;r<s.length;r++){const a=s[r];a.sceneType!=t.sceneType&&"None"!=a.sceneType||i.push(a.eventHandler.handleAsync(t,e))}await Promise.all(i),e.dispose()}publish(t,e){const s=MoyeEventCenter.inst.allEvents.get(e.constructor);if(s){for(let i=0;i<s.length;i++){const r=s[i];r.sceneType!=t.sceneType&&"None"!=r.sceneType||r.eventHandler.handle(t,e)}e.dispose()}}}var __decorate$6=function(t,e,s,i){var r,a=arguments.length,n=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,s,i);else for(var m=t.length-1;m>=0;m--)(r=t[m])&&(n=(a<3?r(n):a>3?r(e,s,n):r(e,s))||n);return a>3&&n&&Object.defineProperty(e,s,n),n};const{ccclass:ccclass$5,property:property$5}=_decorator;let MoyeRuntime=class extends Component{start(){director.addPersistRootNode(this.node)}update(t){Game.update(1e3*t)}lateUpdate(t){Game.lateUpdate(1e3*t),Game.frameFinishUpdate()}onDestroy(){Game.dispose()}};MoyeRuntime=__decorate$6([ccclass$5("MoyeRuntime")],MoyeRuntime);class TimeHelper{static clientNow(){return TimeInfo.get().clientNow()}static clientNowSeconds(){return Math.floor(TimeHelper.clientNow()/1e3)}static serverNow(){return TimeInfo.get().serverNow()}}var TimerType;TimeHelper.oneDay=864e5,TimeHelper.oneHour=36e5,TimeHelper.oneMinute=6e4,function(t){t[t.ONCE=0]="ONCE",t[t.REPEAT=1]="REPEAT"}(TimerType||(TimerType={}));class Timer{static create(){const t=ObjectPool.get().fetch(Timer);return t.reset(),t.id=Timer.getId(),t}static getId(){return++this._idGenerator}reset(){this.cb=null,this.tcs=null,this.id=0,this.expireTime=0,this.interval=0}dispose(){this.reset(),ObjectPool.get().recycle(this)}}Timer._idGenerator=1e3;class TimerMgr extends Singleton{constructor(){super(...arguments),this._timerMap=new Map,this._timers=[]}newRepeatedTimer(t,e,s=!1){const i=Timer.create();return i.type=TimerType.REPEAT,i.cb=e,i.interval=t,i.expireTime=t+TimeHelper.clientNow(),this._timerMap.set(i.id,i),this._timers.push(i),s&&e(),i.id}newOnceTimer(t,e){const s=Timer.create();return s.type=TimerType.ONCE,s.cb=e,s.expireTime=t+TimeHelper.clientNow(),this._timerMap.set(s.id,s),this._timers.push(s),s.id}newFrameTimer(t){const e=Timer.create();return e.type=TimerType.REPEAT,e.cb=t,e.interval=1,e.expireTime=e.interval+TimeHelper.clientNow(),this._timerMap.set(e.id,e),this._timers.push(e),e.id}remove(t){const e=this._timerMap.get(t);return!!e&&(e.id=0,this._timerMap.delete(t),!0)}update(){const t=TimeHelper.clientNow();for(let e=this._timers.length-1;e>=0;e--){const s=this._timers[e];0!=s.id?s.expireTime>t||(null!=s.cb&&s.cb(),null!=s.tcs&&s.tcs.setResult(),s.type==TimerType.REPEAT?s.expireTime+=s.interval:this.remove(s.id)):(this._timers.splice(e,1),s.dispose())}}async waitAsync(t,e){if(t<=0)return;const s=Task.create(),i=Timer.create();let r;i.type=TimerType.ONCE,i.tcs=s,i.expireTime=t+TimeHelper.clientNow(),this._timerMap.set(i.id,i),this._timers.push(i),e&&(r=()=>{this.remove(i.id)&&s.setResult()},e.add(r));try{await s}finally{e?.remove(r),r=null}}}const CoroutineLockTag="CoroutineLock";class CoroutineLockItem{init(t){this.key=t,this.task=Task.create(),Options.get().develop&&this.setTimeout(6e4,"CoroutineLock timeout")}setTimeout(t,e){this.deleteTimeout(),this._timerId=TimerMgr.get().newOnceTimer(t,this.timeout.bind(this)),this._timeoutInfo=e}deleteTimeout(){null!=this._timerId&&(TimerMgr.get().remove(this._timerId),this._timerId=null)}async timeout(){coreWarn("CoroutineLock","CoroutineLock timeout key: {0}, info: {1}",this.key,this._timeoutInfo)}dispose(){null!=this.key?(this.deleteTimeout(),CoroutineLock.get().runNextLock(this),this.key=null,this.task=null):coreWarn("CoroutineLock","repeat dispose CoroutineLockItem")}}class CoroutineLock extends Singleton{constructor(){super(...arguments),this._lockMap=new Map}async wait(t,e){const s=`${t}_${e}`;let i=this._lockMap.get(s);i||(i=new Set,this._lockMap.set(s,i));const r=ObjectPool.get().fetch(CoroutineLockItem);return r.init(s),i.add(r),i.size>1?await r.task:r.task.setResult(),r}runNextLock(t){const e=this._lockMap.get(t.key);e.delete(t),ObjectPool.get().recycle(t);for(const t of Array.from(e.values())){t.task.setResult();break}}}class SceneRefCom extends Entity{}class SceneFactory{static createClientScene(){const t=Root.get().scene.getCom(SceneRefCom);t.scene?.dispose();const e=new Scene;return e.init({id:1n,sceneType:SceneType.CLIENT,name:"Game",instanceId:IdGenerator.get().generateInstanceId(),parent:t}),e.addCom(SceneRefCom),t.scene=e,EventSystem.get().publish(e,AfterCreateClientScene.create()),e}static createCurrentScene(t,e){const s=Root.get().scene.getCom(SceneRefCom).scene.getCom(SceneRefCom);s.scene?.dispose();const i=new Scene;return i.init({id:t,sceneType:SceneType.CURRENT,name:e,instanceId:IdGenerator.get().generateInstanceId(),parent:s}),s.scene=i,EventSystem.get().publish(i,AfterCreateCurrentScene.create()),i}}class Program{static init(t){MoyeEventCenter.inst.publish(new BeforeProgramInit),Game.addSingleton(ObjectPool,!1),Game.addSingleton(Options),Game.addSingleton(Logger),Game.addSingleton(EventSystem),Game.addSingleton(TimeInfo),Game.addSingleton(TimerMgr),Game.addSingleton(CoroutineLock),Game.addSingleton(IdGenerator),Game.addSingleton(EntityCenter),Game.addSingleton(EntityLifiCycleMgr),Game.addSingleton(Root),t.addComponent(MoyeRuntime),MoyeEventCenter.inst.publish(new AfterProgramInit)}static start(){MoyeEventCenter.inst.reloadEvent(),MoyeEventCenter.inst.publish(new BeforeProgramStart),MoyeEventCenter.inst.publish(new AfterProgramStart),Root.get().scene.addCom(SceneRefCom),SceneFactory.createClientScene()}}async function safeCall(t){try{return await t}catch(t){coreError("safeCall",t)}}const EventHandlerTag="EventHandler";class AEventHandler{async handleAsync(t,e){try{await this.run(t,e)}catch(t){coreError("EventHandler","error:{0}",t)}}handle(t,e){try{const s=this.run(t,e);s instanceof Promise&&(coreWarn("EventHandler","{0}的run方法是异步的, 请尽量不要用publish来通知",this.constructor.name),safeCall(s))}catch(t){coreError("EventHandler","error:{0}",t)}}}const CancellationTokenTag="CancellationToken";class CancellationToken{constructor(){this._actions=new Set}add(t){null!=t?this._actions.add(t):coreError("CancellationToken","CancellationToken add error, callback is null")}remove(t){this._actions?.delete(t)}cancel(){null!=this._actions?this.invoke():coreError("CancellationToken","CancellationToken cancel error, repeat cancel")}isCancel(){return null==this._actions}invoke(){const t=this._actions;this._actions=null;try{for(const e of t)e();t.clear()}catch(t){coreError("CancellationToken",t)}}}Entity.prototype.clientScene=function(){const t=this.domainScene();return t.sceneType==SceneType.CLIENT?t:t.sceneType==SceneType.CURRENT?t.parent.parent:t.sceneType==SceneType.PROCESS?t.getCom(SceneRefCom).scene:void 0},Entity.prototype.currentScene=function(){return this.clientScene().getCom(SceneRefCom).scene};class EventAutoReleaseCom extends Entity{constructor(){super(...arguments),this.events=[]}addItem(t){this.events.push(t)}destroy(){const t=this.eventCom.eventMap;for(const e of this.events){t.get(e.eventCode).delete(e),e.entity=null,e.handler=null,e.eventCode=null,e.dispose()}this.events=null,this.eventCom=null}}class EventItem extends RecycleObj{}class EventCom extends Entity{constructor(){super(...arguments),this._eventMap=new Map}destroy(){const t=this._eventMap;for(const e of t.values()){for(const t of e)t.entity=null,t.handler=null,t.eventCode=null,t.dispose();e.clear()}t.clear()}subscribe(t,e,s){const i=EventItem.create({entity:s,handler:e,eventCode:t});let r=this._eventMap.get(t);r||(r=new Set,this._eventMap.set(t,r)),r.add(i);let a=s.getCom(EventAutoReleaseCom);a||(a=s.addCom(EventAutoReleaseCom),a.eventCom=this),a.addItem(i)}publish(t,...e){const s=this._eventMap.get(t);if(s)for(const t of s)t.handler.apply(t.entity,e)}}const INT_BITS=32,INT_MAX=2147483647,INT_MIN=-1<<31;function sign(t){return(t>0)-(t<0)}function abs(t){const e=t>>31;return(t^e)-e}function min(t,e){return e^(t^e)&-(t<e)}function max(t,e){return t^(t^e)&-(t<e)}function isPow2(t){return!(t&t-1||!t)}function log2(t){let e,s;return e=(t>65535)<<4,s=((t>>>=e)>255)<<3,e|=s,s=((t>>>=s)>15)<<2,e|=s,s=((t>>>=s)>3)<<1,e|=s,e|(t>>>=s)>>1}function log10(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0}function popCount(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24}function countTrailingZeros(t){let e=32;return(t&=-t)&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}function nextPow2$1(t){return--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function prevPow2(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)}function parity(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1}const REVERSE_TABLE=new Array(256);function reverse(t){return REVERSE_TABLE[255&t]<<24|REVERSE_TABLE[t>>>8&255]<<16|REVERSE_TABLE[t>>>16&255]<<8|REVERSE_TABLE[t>>>24&255]}function interleave2(t,e){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function deinterleave2(t,e){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>e&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16}function interleave3(t,e,s){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<1)|(s=1227133513&((s=3272356035&((s=251719695&((s=4278190335&((s&=1023)|s<<16))|s<<8))|s<<4))|s<<2))<<2}function deinterleave3(t,e){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>e&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22}function nextCombination(t){const e=t|t-1;return e+1|(~e&-~e)-1>>>countTrailingZeros(t)+1}(t=>{for(let e=0;e<256;++e){let s=e,i=e,r=7;for(s>>>=1;s;s>>>=1)i<<=1,i|=1&s,--r;t[e]=i<<r&255}})(REVERSE_TABLE);var bits=Object.freeze({__proto__:null,INT_BITS:32,INT_MAX:INT_MAX,INT_MIN:INT_MIN,abs:abs,countTrailingZeros:countTrailingZeros,deinterleave2:deinterleave2,deinterleave3:deinterleave3,interleave2:interleave2,interleave3:interleave3,isPow2:isPow2,log10:log10,log2:log2,max:max,min:min,nextCombination:nextCombination,nextPow2:nextPow2$1,parity:parity,popCount:popCount,prevPow2:prevPow2,reverse:reverse,sign:sign});const _d2r=Math.PI/180,_r2d=180/Math.PI;let _random=Math.random;const HALF_PI=.5*Math.PI,TWO_PI=2*Math.PI,EPSILON=1e-6;function equals(t,e){return Math.abs(t-e)<=EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}function approx(t,e,s){return s=s||EPSILON,Math.abs(t-e)<=s}function clamp(t,e,s){if(e>s){const t=e;e=s,s=t}return t<e?e:t>s?s:t}function clamp01(t){return t<0?0:t>1?1:t}function lerp(t,e,s){return t+(e-t)*s}function toRadian(t){return t*_d2r}function toDegree(t){return t*_r2d}function random(){return _random()}function setRandGenerator(t){_random=t}function randomRange(t,e){return random()*(e-t)+t}function randomRangeInt(t,e){return Math.floor(randomRange(t,e))}function pseudoRandom(t){return(t=(9301*t+49297)%233280)/233280}function pseudoRandomRange(t,e,s){return pseudoRandom(t)*(s-e)+e}function pseudoRandomRangeInt(t,e,s){return Math.floor(pseudoRandomRange(t,e,s))}function nextPow2(t){return nextPow2$1(t)}function repeat(t,e){return t-Math.floor(t/e)*e}function pingPong(t,e){return t=repeat(t,2*e),t=e-Math.abs(t-e)}function inverseLerp(t,e,s){return(s-t)/(e-t)}function absMaxComponent(t){return Math.abs(t.x)>Math.abs(t.y)?Math.abs(t.x)>Math.abs(t.z)?t.x:t.z:Math.abs(t.y)>Math.abs(t.z)?t.y:t.z}function absMax(t,e){return Math.abs(t)>Math.abs(e)?t:e}function enumerableProps(t,e){e.forEach((e=>{Object.defineProperty(t,e,{enumerable:!0})}))}const toHalf=function(){const t=new Float32Array(1),e=new Int32Array(t.buffer);return function(s){t[0]=s;const i=e[0],r=i>>16&32768,a=2147483647&i;let n=a-(112<<23)+4096>>13;return n=a<113<<23?0:n,n=a>=143<<23?31744:n,n=a>255<<23?32256:n,e[0]=r|n,e[0]}}(),fromHalf=function(){const t=new Float32Array(1),e=new Int32Array(t.buffer);return function(s){const i=32767&s;let r=i<<13,a=0;return 31744!==r?(r+=112<<23,0===i?r=(1048575&r)>>1:32767===i&&(r=2147483647)):r=2139095040,a=(s>>15&1)<<31|r,e[0]=a,t[0]}}();function floatToHalf(t){return toHalf(t)}function halfToFloat(t){return fromHalf(t)}class Vec3{static zero(t){return t.x=0,t.y=0,t.z=0,t}static clone(t){return new Vec3(t.x,t.y,t.z)}static copy(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t}static set(t,e,s,i){return t.x=e,t.y=s,t.z=i,t}static add(t,e,s){return t.x=e.x+s.x,t.y=e.y+s.y,t.z=e.z+s.z,t}static subtract(t,e,s){return t.x=e.x-s.x,t.y=e.y-s.y,t.z=e.z-s.z,t}static multiply(t,e,s){return t.x=e.x*s.x,t.y=e.y*s.y,t.z=e.z*s.z,t}static divide(t,e,s){return t.x=e.x/s.x,t.y=e.y/s.y,t.z=e.z/s.z,t}static ceil(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t.z=Math.ceil(e.z),t}static floor(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t.z=Math.floor(e.z),t}static min(t,e,s){return t.x=Math.min(e.x,s.x),t.y=Math.min(e.y,s.y),t.z=Math.min(e.z,s.z),t}static max(t,e,s){return t.x=Math.max(e.x,s.x),t.y=Math.max(e.y,s.y),t.z=Math.max(e.z,s.z),t}static round(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t}static multiplyScalar(t,e,s){return t.x=e.x*s,t.y=e.y*s,t.z=e.z*s,t}static scaleAndAdd(t,e,s,i){return t.x=e.x+s.x*i,t.y=e.y+s.y*i,t.z=e.z+s.z*i,t}static distance(t,e){const s=e.x-t.x,i=e.y-t.y,r=e.z-t.z;return Math.sqrt(s*s+i*i+r*r)}static squaredDistance(t,e){const s=e.x-t.x,i=e.y-t.y,r=e.z-t.z;return s*s+i*i+r*r}static len(t){const e=t.x,s=t.y,i=t.z;return Math.sqrt(e*e+s*s+i*i)}static lengthSqr(t){const e=t.x,s=t.y,i=t.z;return e*e+s*s+i*i}static negate(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t}static invert(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t}static invertSafe(t,e){const s=e.x,i=e.y,r=e.z;return Math.abs(s)<EPSILON?t.x=0:t.x=1/s,Math.abs(i)<EPSILON?t.y=0:t.y=1/i,Math.abs(r)<EPSILON?t.z=0:t.z=1/r,t}static normalize(t,e){const s=e.x,i=e.y,r=e.z;let a=s*s+i*i+r*r;return a>0?(a=1/Math.sqrt(a),t.x=s*a,t.y=i*a,t.z=r*a):(t.x=0,t.y=0,t.z=0),t}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static cross(t,e,s){const{x:i,y:r,z:a}=e,{x:n,y:m,z:o}=s;return t.x=r*o-a*m,t.y=a*n-i*o,t.z=i*m-r*n,t}static lerp(t,e,s,i){return t.x=e.x+i*(s.x-e.x),t.y=e.y+i*(s.y-e.y),t.z=e.z+i*(s.z-e.z),t}static random(t,e){e=e||1;const s=2*random()*Math.PI,i=2*random()-1,r=Math.sqrt(1-i*i);return t.x=r*Math.cos(s)*e,t.y=r*Math.sin(s)*e,t.z=i*e,t}static transformMat4(t,e,s){const i=e.x,r=e.y,a=e.z;let n=s.m03*i+s.m07*r+s.m11*a+s.m15;return n=n?1/n:1,t.x=(s.m00*i+s.m04*r+s.m08*a+s.m12)*n,t.y=(s.m01*i+s.m05*r+s.m09*a+s.m13)*n,t.z=(s.m02*i+s.m06*r+s.m10*a+s.m14)*n,t}static transformMat4Normal(t,e,s){const i=e.x,r=e.y,a=e.z;let n=s.m03*i+s.m07*r+s.m11*a;return n=n?1/n:1,t.x=(s.m00*i+s.m04*r+s.m08*a)*n,t.y=(s.m01*i+s.m05*r+s.m09*a)*n,t.z=(s.m02*i+s.m06*r+s.m10*a)*n,t}static transformMat3(t,e,s){const i=e.x,r=e.y,a=e.z;return t.x=i*s.m00+r*s.m03+a*s.m06,t.y=i*s.m01+r*s.m04+a*s.m07,t.z=i*s.m02+r*s.m05+a*s.m08,t}static transformAffine(t,e,s){const i=e.x,r=e.y,a=e.z;return t.x=s.m00*i+s.m04*r+s.m08*a+s.m12,t.y=s.m01*i+s.m05*r+s.m09*a+s.m13,t.z=s.m02*i+s.m06*r+s.m10*a+s.m14,t}static transformQuat(t,e,s){const i=s.w*e.x+s.y*e.z-s.z*e.y,r=s.w*e.y+s.z*e.x-s.x*e.z,a=s.w*e.z+s.x*e.y-s.y*e.x,n=-s.x*e.x-s.y*e.y-s.z*e.z;return t.x=i*s.w+n*-s.x+r*-s.z-a*-s.y,t.y=r*s.w+n*-s.y+a*-s.x-i*-s.z,t.z=a*s.w+n*-s.z+i*-s.y-r*-s.x,t}static transformRTS(t,e,s,i,r){const a=e.x*r.x,n=e.y*r.y,m=e.z*r.z,o=s.w*a+s.y*m-s.z*n,h=s.w*n+s.z*a-s.x*m,c=s.w*m+s.x*n-s.y*a,l=-s.x*a-s.y*n-s.z*m;return t.x=o*s.w+l*-s.x+h*-s.z-c*-s.y+i.x,t.y=h*s.w+l*-s.y+c*-s.x-o*-s.z+i.y,t.z=c*s.w+l*-s.z+o*-s.y-h*-s.x+i.z,t}static transformInverseRTS(t,e,s,i,r){const a=e.x-i.x,n=e.y-i.y,m=e.z-i.z,o=s.w*a-s.y*m+s.z*n,h=s.w*n-s.z*a+s.x*m,c=s.w*m-s.x*n+s.y*a,l=s.x*a+s.y*n+s.z*m;return t.x=(o*s.w+l*s.x+h*s.z-c*s.y)/r.x,t.y=(h*s.w+l*s.y+c*s.x-o*s.z)/r.y,t.z=(c*s.w+l*s.z+o*s.y-h*s.x)/r.z,t}static rotateX(t,e,s,i){const r=e.x-s.x,a=e.y-s.y,n=e.z-s.z,m=Math.cos(i),o=Math.sin(i),h=r,c=a*m-n*o,l=a*o+n*m;return t.x=h+s.x,t.y=c+s.y,t.z=l+s.z,t}static rotateY(t,e,s,i){const r=e.x-s.x,a=e.y-s.y,n=e.z-s.z,m=Math.cos(i),o=Math.sin(i),h=n*o+r*m,c=a,l=n*m-r*o;return t.x=h+s.x,t.y=c+s.y,t.z=l+s.z,t}static rotateZ(t,e,s,i){const r=e.x-s.x,a=e.y-s.y,n=e.z-s.z,m=Math.cos(i),o=Math.sin(i),h=r*m-a*o,c=r*o+a*m,l=n;return t.x=h+s.x,t.y=c+s.y,t.z=l+s.z,t}static rotateN(t,e,s,i,r){const a=e.x-s.x,n=e.y-s.y,m=e.z-s.z,o=i.x,h=i.y,c=i.z,l=Math.cos(r),u=Math.sin(r),d=a*(o*o*(1-l)+l)+n*(o*h*(1-l)-o*u)+m*(o*c*(1-l)+h*u),y=a*(o*h*(1-l)+c*u)+n*(h*h*(1-l)+l)+m*(h*c*(1-l)-o*u),p=a*(o*c*(1-l)-h*u)+n*(h*c*(1-l)+o*u)+m*(c*c*(1-l)+l);return t.x=d+s.x,t.y=y+s.y,t.z=p+s.z,t}static toArray(t,e,s=0){return t[s+0]=e.x,t[s+1]=e.y,t[s+2]=e.z,t}static fromArray(t,e,s=0){return t.x=e[s+0],t.y=e[s+1],t.z=e[s+2],t}static strictEquals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}static equals(t,e,s=EPSILON){const{x:i,y:r,z:a}=t,{x:n,y:m,z:o}=e;return Math.abs(i-n)<=s*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-m)<=s*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(a-o)<=s*Math.max(1,Math.abs(a),Math.abs(o))}static angle(t,e){const s=t.x*t.x+t.y*t.y+t.z*t.z,i=e.x*e.x+e.y*e.y+e.z*e.z;if(0===s||0===i)return 0;let r=(t.x*e.x+t.y*e.y+t.z*e.z)/Math.sqrt(s*i);return r=clamp(r,-1,1),Math.acos(r)}static projectOnPlane(t,e,s){return Vec3.subtract(t,e,Vec3.project(t,e,s))}static project(t,e,s){const i=Vec3.lengthSqr(s);return i<1e-6?Vec3.set(t,0,0,0):Vec3.multiplyScalar(t,s,Vec3.dot(e,s)/i)}static moveTowards(t,e,s,i){const r=s.x-e.x,a=s.y-e.y,n=s.z-e.z,m=r*r+a*a+n*n;if(0===m||i>=0&&m<i*i)return t.x=s.x,t.y=s.y,t.z=s.z,t;const o=i/Math.sqrt(m);return t.x=e.x+r*o,t.y=e.y+a*o,t.z=e.z+n*o,t}static generateOrthogonal(t,e){const{x:s,y:i,z:r}=e,a=Math.abs(s),n=Math.abs(i),m=Math.abs(r);return a<n&&a<m?Vec3.set(t,0,r,-i):n<m?Vec3.set(t,r,0,-s):Vec3.set(t,i,-s,0),Vec3.normalize(t,t)}constructor(t,e,s){"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=e||0,this.z=s||0)}clone(){return new Vec3(this.x,this.y,this.z)}set(t,e,s){return"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=e||0,this.z=s||0),this}equals(t,e=EPSILON){return Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e&&Math.abs(this.z-t.z)<=e}equals3f(t,e,s,i=EPSILON){return Math.abs(this.x-t)<=i&&Math.abs(this.y-e)<=i&&Math.abs(this.z-s)<=i}strictEquals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}strictEquals3f(t,e,s){return this.x===t&&this.y===e&&this.z===s}toString(){return`(${this.x.toFixed(2)}, ${this.y.toFixed(2)}, ${this.z.toFixed(2)})`}lerp(t,e){return this.x+=e*(t.x-this.x),this.y+=e*(t.y-this.y),this.z+=e*(t.z-this.z),this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}add3f(t,e,s){return this.x+=t,this.y+=e,this.z+=s,this}subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subtract3f(t,e,s){return this.x-=t,this.y-=e,this.z-=s,this}multiplyScalar(t){return"object"==typeof t&&console.warn("should use Vec3.multiply for vector * vector operation"),this.x*=t,this.y*=t,this.z*=t,this}multiply(t){return"object"!=typeof t&&console.warn("should use Vec3.scale for vector * scalar operation"),this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiply3f(t,e,s){return this.x*=t,this.y*=e,this.z*=s,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divide3f(t,e,s){return this.x/=t,this.y/=e,this.z/=s,this}negative(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}clampf(t,e){return this.x=clamp(this.x,t.x,e.x),this.y=clamp(this.y,t.y,e.y),this.z=clamp(this.z,t.z,e.z),this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){const{x:e,y:s,z:i}=this,{x:r,y:a,z:n}=t;return this.x=s*n-i*a,this.y=i*r-e*n,this.z=e*a-s*r,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSqr(){return this.x*this.x+this.y*this.y+this.z*this.z}normalize(){const t=this.x,e=this.y,s=this.z;let i=t*t+e*e+s*s;return i>0&&(i=1/Math.sqrt(i),this.x=t*i,this.y=e*i,this.z=s*i),this}transformMat4(t){const e=this.x,s=this.y,i=this.z;let r=t.m03*e+t.m07*s+t.m11*i+t.m15;return r=r?1/r:1,this.x=(t.m00*e+t.m04*s+t.m08*i+t.m12)*r,this.y=(t.m01*e+t.m05*s+t.m09*i+t.m13)*r,this.z=(t.m02*e+t.m06*s+t.m10*i+t.m14)*r,this}}function v3(t,e,s){return new Vec3(t,e,s)}Vec3.UNIT_X=Object.freeze(new Vec3(1,0,0)),Vec3.UNIT_Y=Object.freeze(new Vec3(0,1,0)),Vec3.UNIT_Z=Object.freeze(new Vec3(0,0,1)),Vec3.RIGHT=Object.freeze(new Vec3(1,0,0)),Vec3.UP=Object.freeze(new Vec3(0,1,0)),Vec3.FORWARD=Object.freeze(new Vec3(0,0,-1)),Vec3.ZERO=Object.freeze(new Vec3(0,0,0)),Vec3.ONE=Object.freeze(new Vec3(1,1,1)),Vec3.NEG_ONE=Object.freeze(new Vec3(-1,-1,-1)),Vec3.slerp=(()=>{const t=new Vec3,e=new Vec3,s=new Vec3;return(i,r,a,n)=>{const m=1e-5,o=Vec3.len(r),h=Vec3.len(a);if(o<m||h<m)return Vec3.lerp(i,r,a,n);const c=lerp(o,h,n),l=Vec3.dot(r,a)/(o*h);if(l>.99999)return Vec3.lerp(i,r,a,n);if(l<-.99999){const a=Vec3.multiplyScalar(t,r,1/o),m=Vec3.generateOrthogonal(e,a),h=Math.PI*n;return rotateAxisAngle(s,a,m,h),Vec3.multiplyScalar(i,s,c),i}{const m=l,u=Math.acos(m)*n,d=Vec3.multiplyScalar(t,r,1/o),y=Vec3.multiplyScalar(e,a,1/h);return Vec3.scaleAndAdd(s,y,d,-m),Vec3.normalize(s,s),Vec3.multiplyScalar(s,s,Math.sin(u)),Vec3.scaleAndAdd(s,s,d,Math.cos(u)),Vec3.multiplyScalar(i,s,c),i}}})();const rotateAxisAngle=(()=>{const t={x:0,y:0,z:0,w:0};return(e,s,i,r)=>{const a=.5*r,n=Math.sin(a);return t.x=n*i.x,t.y=n*i.y,t.z=n*i.z,t.w=Math.cos(a),Vec3.transformQuat(e,s,t),e}})();class Vec2{static clone(t){return new Vec2(t.x,t.y)}static copy(t,e){return t.x=e.x,t.y=e.y,t}static set(t,e,s){return t.x=e,t.y=s,t}static add(t,e,s){return t.x=e.x+s.x,t.y=e.y+s.y,t}static subtract(t,e,s){return t.x=e.x-s.x,t.y=e.y-s.y,t}static multiply(t,e,s){return t.x=e.x*s.x,t.y=e.y*s.y,t}static divide(t,e,s){return t.x=e.x/s.x,t.y=e.y/s.y,t}static ceil(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t}static floor(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t}static min(t,e,s){return t.x=Math.min(e.x,s.x),t.y=Math.min(e.y,s.y),t}static max(t,e,s){return t.x=Math.max(e.x,s.x),t.y=Math.max(e.y,s.y),t}static round(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t}static multiplyScalar(t,e,s){return t.x=e.x*s,t.y=e.y*s,t}static scaleAndAdd(t,e,s,i){return t.x=e.x+s.x*i,t.y=e.y+s.y*i,t}static distance(t,e){const s=e.x-t.x,i=e.y-t.y;return Math.sqrt(s*s+i*i)}static squaredDistance(t,e){const s=e.x-t.x,i=e.y-t.y;return s*s+i*i}static len(t){const e=t.x,s=t.y;return Math.sqrt(e*e+s*s)}static lengthSqr(t){const e=t.x,s=t.y;return e*e+s*s}static negate(t,e){return t.x=-e.x,t.y=-e.y,t}static inverse(t,e){return t.x=1/e.x,t.y=1/e.y,t}static inverseSafe(t,e){const s=e.x,i=e.y;return Math.abs(s)<EPSILON?t.x=0:t.x=1/s,Math.abs(i)<EPSILON?t.y=0:t.y=1/i,t}static normalize(t,e){const s=e.x,i=e.y;let r=s*s+i*i;return r>0?(r=1/Math.sqrt(r),t.x=s*r,t.y=i*r):(t.x=0,t.y=0),t}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e,s){return t instanceof Vec3?(t.x=t.y=0,t.z=e.x*s.y-e.y*s.x,t):t.x*e.y-t.y*e.x}static lerp(t,e,s,i){const r=e.x,a=e.y;return t.x=r+i*(s.x-r),t.y=a+i*(s.y-a),t}static random(t,e){e=e||1;const s=2*random()*Math.PI;return t.x=Math.cos(s)*e,t.y=Math.sin(s)*e,t}static transformMat3(t,e,s){const i=e.x,r=e.y;return t.x=s.m00*i+s.m03*r+s.m06,t.y=s.m01*i+s.m04*r+s.m07,t}static transformMat4(t,e,s){const i=e.x,r=e.y;return t.x=s.m00*i+s.m04*r+s.m12,t.y=s.m01*i+s.m05*r+s.m13,t}static str(t){return`Vec2(${t.x}, ${t.y})`}static toArray(t,e,s=0){return t[s+0]=e.x,t[s+1]=e.y,t}static fromArray(t,e,s=0){return t.x=e[s+0],t.y=e[s+1],t}static strictEquals(t,e){return t.x===e.x&&t.y===e.y}static equals(t,e,s=EPSILON){return Math.abs(t.x-e.x)<=s*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=s*Math.max(1,Math.abs(t.y),Math.abs(e.y))}static angle(t,e){const s=t.x*t.x+t.y*t.y,i=e.x*e.x+e.y*e.y;if(0===s||0===i)return 0;let r=(t.x*e.x+t.y*e.y)/Math.sqrt(s*i);return r=clamp(r,-1,1),Math.acos(r)}constructor(t,e){"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=e||0)}clone(){return new Vec2(this.x,this.y)}set(t,e){return"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=e||0),this}equals(t,e=EPSILON){return Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))}equals2f(t,e,s=EPSILON){return Math.abs(this.x-t)<=s*Math.max(1,Math.abs(this.x),Math.abs(t))&&Math.abs(this.y-e)<=s*Math.max(1,Math.abs(this.y),Math.abs(e))}strictEquals(t){return t&&this.x===t.x&&this.y===t.y}strictEquals2f(t,e){return this.x===t&&this.y===e}toString(){return`(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}lerp(t,e){const s=this.x,i=this.y;return this.x=s+e*(t.x-s),this.y=i+e*(t.y-i),this}clampf(t,e){return this.x=clamp(this.x,t.x,e.x),this.y=clamp(this.y,t.y,e.y),this}add(t){return this.x+=t.x,this.y+=t.y,this}add2f(t,e){return this.x+=t,this.y+=e,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}subtract2f(t,e){return this.x-=t,this.y-=e,this}multiplyScalar(t){return"object"==typeof t&&console.warn("should use Vec2.multiply for vector * vector operation"),this.x*=t,this.y*=t,this}multiply(t){return"object"!=typeof t&&console.warn("should use Vec2.scale for vector * scalar operation"),this.x*=t.x,this.y*=t.y,this}multiply2f(t,e){return this.x*=t,this.y*=e,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divide2f(t,e){return this.x/=t,this.y/=e,this}negative(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSqr(){return this.x*this.x+this.y*this.y}normalize(){const t=this.x,e=this.y;let s=t*t+e*e;return s>0&&(s=1/Math.sqrt(s),this.x*=s,this.y*=s),this}angle(t){const e=this.lengthSqr(),s=t.lengthSqr();if(0===e||0===s)return 0;let i=this.dot(t)/Math.sqrt(e*s);return i=clamp(i,-1,1),Math.acos(i)}signAngle(t){const e=this.angle(t);return this.cross(t)<0?-e:e}rotate(t){const e=this.x,s=this.y,i=Math.sin(t),r=Math.cos(t);return this.x=r*e-i*s,this.y=i*e+r*s,this}project(t){const e=this.dot(t)/t.dot(t);return this.x=t.x*e,this.y=t.y*e,this}transformMat4(t){const e=this.x,s=this.y;return this.x=t.m00*e+t.m04*s+t.m12,this.y=t.m01*e+t.m05*s+t.m13,this}}function v2(t,e){return new Vec2(t,e)}Vec2.ZERO=Object.freeze(new Vec2(0,0)),Vec2.ONE=Object.freeze(new Vec2(1,1)),Vec2.NEG_ONE=Object.freeze(new Vec2(-1,-1)),Vec2.UNIT_X=Object.freeze(new Vec2(1,0)),Vec2.UNIT_Y=Object.freeze(new Vec2(0,1));class Vec4{static clone(t){return new Vec4(t.x,t.y,t.z,t.w)}static copy(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}static set(t,e,s,i,r){return t.x=e,t.y=s,t.z=i,t.w=r,t}static fromColor(t,e){return t.x=e.r,t.y=e.g,t.z=e.b,t.w=e.a,t}static angle(t,e){const s=t.y*e.z-t.z*e.y,i=t.z*e.x-t.x*e.z,r=t.x*e.y-t.y*e.x,a=t.x*e.x+t.y*e.y+t.z*e.z;return Math.atan2(Math.sqrt(s*s+i*i+r*r),a)}static add(t,e,s){return t.x=e.x+s.x,t.y=e.y+s.y,t.z=e.z+s.z,t.w=e.w+s.w,t}static subtract(t,e,s){return t.x=e.x-s.x,t.y=e.y-s.y,t.z=e.z-s.z,t.w=e.w-s.w,t}static multiply(t,e,s){return t.x=e.x*s.x,t.y=e.y*s.y,t.z=e.z*s.z,t.w=e.w*s.w,t}static divide(t,e,s){return t.x=e.x/s.x,t.y=e.y/s.y,t.z=e.z/s.z,t.w=e.w/s.w,t}static ceil(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t.z=Math.ceil(e.z),t.w=Math.ceil(e.w),t}static floor(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t.z=Math.floor(e.z),t.w=Math.floor(e.w),t}static min(t,e,s){return t.x=Math.min(e.x,s.x),t.y=Math.min(e.y,s.y),t.z=Math.min(e.z,s.z),t.w=Math.min(e.w,s.w),t}static max(t,e,s){return t.x=Math.max(e.x,s.x),t.y=Math.max(e.y,s.y),t.z=Math.max(e.z,s.z),t.w=Math.max(e.w,s.w),t}static round(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t.w=Math.round(e.w),t}static multiplyScalar(t,e,s){return t.x=e.x*s,t.y=e.y*s,t.z=e.z*s,t.w=e.w*s,t}static scaleAndAdd(t,e,s,i){return t.x=e.x+s.x*i,t.y=e.y+s.y*i,t.z=e.z+s.z*i,t.w=e.w+s.w*i,t}static distance(t,e){const s=e.x-t.x,i=e.y-t.y,r=e.z-t.z,a=e.w-t.w;return Math.sqrt(s*s+i*i+r*r+a*a)}static squaredDistance(t,e){const s=e.x-t.x,i=e.y-t.y,r=e.z-t.z,a=e.w-t.w;return s*s+i*i+r*r+a*a}static len(t){const e=t.x,s=t.y,i=t.z,r=t.w;return Math.sqrt(e*e+s*s+i*i+r*r)}static lengthSqr(t){const e=t.x,s=t.y,i=t.z,r=t.w;return e*e+s*s+i*i+r*r}static negate(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t}static inverse(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t.w=1/e.w,t}static inverseSafe(t,e){const s=e.x,i=e.y,r=e.z,a=e.w;return Math.abs(s)<EPSILON?t.x=0:t.x=1/s,Math.abs(i)<EPSILON?t.y=0:t.y=1/i,Math.abs(r)<EPSILON?t.z=0:t.z=1/r,Math.abs(a)<EPSILON?t.w=0:t.w=1/a,t}static normalize(t,e){const s=e.x,i=e.y,r=e.z,a=e.w;let n=s*s+i*i+r*r+a*a;return n>0?(n=1/Math.sqrt(n),t.x=s*n,t.y=i*n,t.z=r*n,t.w=a*n):(t.x=0,t.y=0,t.z=0,t.w=0),t}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w}static lerp(t,e,s,i){return t.x=e.x+i*(s.x-e.x),t.y=e.y+i*(s.y-e.y),t.z=e.z+i*(s.z-e.z),t.w=e.w+i*(s.w-e.w),t}static scale(t,e,s){return t.x=e.x*s,t.y=e.y*s,t.z=e.z*s,t.w=e.w*s,t}static random(t,e){e=e||1;const s=2*random()*Math.PI,i=2*random()-1,r=Math.sqrt(1-i*i);return t.x=r*Math.cos(s)*e,t.y=r*Math.sin(s)*e,t.z=i*e,t.w=0,t}static transformMat4(t,e,s){const i=e.x,r=e.y,a=e.z,n=e.w;return t.x=s.m00*i+s.m04*r+s.m08*a+s.m12*n,t.y=s.m01*i+s.m05*r+s.m09*a+s.m13*n,t.z=s.m02*i+s.m06*r+s.m10*a+s.m14*n,t.w=s.m03*i+s.m07*r+s.m11*a+s.m15*n,t}static transformAffine(t,e,s){const i=e.x,r=e.y,a=e.z,n=e.w;return t.x=s.m00*i+s.m04*r+s.m08*a+s.m12*n,t.y=s.m01*i+s.m05*r+s.m09*a+s.m13*n,t.z=s.m02*i+s.m06*r+s.m10*a+s.m14*n,t.w=e.w,t}static transformQuat(t,e,s){const{x:i,y:r,z:a}=e,n=s.x,m=s.y,o=s.z,h=s.w,c=h*i+m*a-o*r,l=h*r+o*i-n*a,u=h*a+n*r-m*i,d=-n*i-m*r-o*a;return t.x=c*h+d*-n+l*-o-u*-m,t.y=l*h+d*-m+u*-n-c*-o,t.z=u*h+d*-o+c*-m-l*-n,t.w=e.w,t}static toArray(t,e,s=0){return t[s+0]=e.x,t[s+1]=e.y,t[s+2]=e.z,t[s+3]=e.w,t}static fromArray(t,e,s=0){return t.x=e[s+0],t.y=e[s+1],t.z=e[s+2],t.w=e[s+3],t}static strictEquals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}static equals(t,e,s=EPSILON){return!(Math.abs(t.x)===1/0||Math.abs(t.y)===1/0||Math.abs(t.z)===1/0||Math.abs(t.w)===1/0||Math.abs(e.x)===1/0||Math.abs(e.y)===1/0||Math.abs(e.z)===1/0||Math.abs(e.w)===1/0)&&Math.abs(t.x-e.x)<=s*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=s*Math.max(1,Math.abs(t.y),Math.abs(e.y))&&Math.abs(t.z-e.z)<=s*Math.max(1,Math.abs(t.z),Math.abs(e.z))&&Math.abs(t.w-e.w)<=s*Math.max(1,Math.abs(t.w),Math.abs(e.w))}constructor(t,e,s,i){"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=s||0,this.w=i||0)}clone(){return new Vec4(this.x,this.y,this.z,this.w)}set(t,e,s,i){return"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=s||0,this.w=i||0),this}equals(t,e=EPSILON){return Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))&&Math.abs(this.z-t.z)<=e*Math.max(1,Math.abs(this.z),Math.abs(t.z))&&Math.abs(this.w-t.w)<=e*Math.max(1,Math.abs(this.w),Math.abs(t.w))}equals4f(t,e,s,i,r=EPSILON){return Math.abs(this.x-t)<=r*Math.max(1,Math.abs(this.x),Math.abs(t))&&Math.abs(this.y-e)<=r*Math.max(1,Math.abs(this.y),Math.abs(e))&&Math.abs(this.z-s)<=r*Math.max(1,Math.abs(this.z),Math.abs(s))&&Math.abs(this.w-i)<=r*Math.max(1,Math.abs(this.w),Math.abs(i))}strictEquals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}strictEquals4f(t,e,s,i){return this.x===t&&this.y===e&&this.z===s&&this.w===i}lerp(t,e){const s=this.x,i=this.y,r=this.z,a=this.w;return this.x=s+e*(t.x-s),this.y=i+e*(t.y-i),this.z=r+e*(t.z-r),this.w=a+e*(t.w-a),this}toString(){return`(${this.x.toFixed(2)}, ${this.y.toFixed(2)}, ${this.z.toFixed(2)}, ${this.w.toFixed(2)})`}clampf(t,e){return this.x=clamp(this.x,t.x,e.x),this.y=clamp(this.y,t.y,e.y),this.z=clamp(this.z,t.z,e.z),this.w=clamp(this.w,t.w,e.w),this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}add4f(t,e,s,i){return this.x+=t,this.y+=e,this.z+=s,this.w+=i,this}subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subtract4f(t,e,s,i){return this.x-=t,this.y-=e,this.z-=s,this.w-=i,this}multiplyScalar(t){return"object"==typeof t&&console.warn("should use Vec4.multiply for vector * vector operation"),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}multiply(t){return"object"!=typeof t&&console.warn("should use Vec4.scale for vector * scalar operation"),this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiply4f(t,e,s,i){return this.x*=t,this.y*=e,this.z*=s,this.w*=i,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divide4f(t,e,s,i){return this.x/=t,this.y/=e,this.z/=s,this.w/=i,this}negative(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}cross(t){const{x:e,y:s,z:i}=this,{x:r,y:a,z:n}=t;return this.x=s*n-i*a,this.y=i*r-e*n,this.z=e*a-s*r,this}length(){const t=this.x,e=this.y,s=this.z,i=this.w;return Math.sqrt(t*t+e*e+s*s+i*i)}lengthSqr(){const t=this.x,e=this.y,s=this.z,i=this.w;return t*t+e*e+s*s+i*i}normalize(){const t=this.x,e=this.y,s=this.z,i=this.w;let r=t*t+e*e+s*s+i*i;return r>0&&(r=1/Math.sqrt(r),this.x=t*r,this.y=e*r,this.z=s*r,this.w=i*r),this}scale(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}transformMat4(t){const e=this.x,s=this.y,i=this.z,r=this.w;return this.x=t.m00*e+t.m04*s+t.m08*i+t.m12*r,this.y=t.m01*e+t.m05*s+t.m09*i+t.m13*r,this.z=t.m02*e+t.m06*s+t.m10*i+t.m14*r,this.w=t.m03*e+t.m07*s+t.m11*i+t.m15*r,this}}function v4(t,e,s,i){return new Vec4(t,e,s,i)}Vec4.ZERO=Object.freeze(new Vec4(0,0,0,0)),Vec4.ONE=Object.freeze(new Vec4(1,1,1,1)),Vec4.NEG_ONE=Object.freeze(new Vec4(-1,-1,-1,-1)),Vec4.UNIT_X=Object.freeze(new Vec4(1,0,0,0)),Vec4.UNIT_Y=Object.freeze(new Vec4(0,1,0,0)),Vec4.UNIT_Z=Object.freeze(new Vec4(0,0,1,0)),Vec4.UNIT_W=Object.freeze(new Vec4(0,0,0,1));class Mat3{static clone(t){return new Mat3(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08)}static copy(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t}static set(t,e,s,i,r,a,n,m,o,h){return t.m00=e,t.m01=s,t.m02=i,t.m03=r,t.m04=a,t.m05=n,t.m06=m,t.m07=o,t.m08=h,t}static identity(t){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=1,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t}static transpose(t,e){if(t===e){const s=e.m01,i=e.m02,r=e.m05;t.m01=e.m03,t.m02=e.m06,t.m03=s,t.m05=e.m07,t.m06=i,t.m07=r}else t.m00=e.m00,t.m01=e.m03,t.m02=e.m06,t.m03=e.m01,t.m04=e.m04,t.m05=e.m07,t.m06=e.m02,t.m07=e.m05,t.m08=e.m08;return t}static invert(t,e){const s=e.m00,i=e.m01,r=e.m02,a=e.m03,n=e.m04,m=e.m05,o=e.m06,h=e.m07,c=e.m08,l=c*n-m*h,u=-c*a+m*o,d=h*a-n*o;let y=s*l+i*u+r*d;return 0===y?(t.m00=0,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=0,t.m06=0,t.m07=0,t.m08=0,t):(y=1/y,t.m00=l*y,t.m01=(-c*i+r*h)*y,t.m02=(m*i-r*n)*y,t.m03=u*y,t.m04=(c*s-r*o)*y,t.m05=(-m*s+r*a)*y,t.m06=d*y,t.m07=(-h*s+i*o)*y,t.m08=(n*s-i*a)*y,t)}static determinant(t){const e=t.m00,s=t.m01,i=t.m02,r=t.m03,a=t.m04,n=t.m05,m=t.m06,o=t.m07,h=t.m08;return e*(h*a-n*o)+s*(-h*r+n*m)+i*(o*r-a*m)}static multiply(t,e,s){const i=e.m00,r=e.m01,a=e.m02,n=e.m03,m=e.m04,o=e.m05,h=e.m06,c=e.m07,l=e.m08,u=s.m00,d=s.m01,y=s.m02,p=s.m03,_=s.m04,g=s.m05,x=s.m06,M=s.m07,f=s.m08;return t.m00=u*i+d*n+y*h,t.m01=u*r+d*m+y*c,t.m02=u*a+d*o+y*l,t.m03=p*i+_*n+g*h,t.m04=p*r+_*m+g*c,t.m05=p*a+_*o+g*l,t.m06=x*i+M*n+f*h,t.m07=x*r+M*m+f*c,t.m08=x*a+M*o+f*l,t}static multiplyMat4(t,e,s){const i=e.m00,r=e.m01,a=e.m02,n=e.m03,m=e.m04,o=e.m05,h=e.m06,c=e.m07,l=e.m08,u=s.m00,d=s.m01,y=s.m02,p=s.m04,_=s.m05,g=s.m06,x=s.m08,M=s.m09,f=s.m10;return t.m00=u*i+d*n+y*h,t.m01=u*r+d*m+y*c,t.m02=u*a+d*o+y*l,t.m03=p*i+_*n+g*h,t.m04=p*r+_*m+g*c,t.m05=p*a+_*o+g*l,t.m06=x*i+M*n+f*h,t.m07=x*r+M*m+f*c,t.m08=x*a+M*o+f*l,t}static transform(t,e,s){this.translate(t,e,s)}static translate(t,e,s){const i=e.m00,r=e.m01,a=e.m02,n=e.m03,m=e.m04,o=e.m05,h=e.m06,c=e.m07,l=e.m08,u=s.x,d=s.y;return t.m00=i,t.m01=r,t.m02=a,t.m03=n,t.m04=m,t.m05=o,t.m06=u*i+d*n+h,t.m07=u*r+d*m+c,t.m08=u*a+d*o+l,t}static scale(t,e,s){const i=s.x,r=s.y;return t.m00=i*e.m00,t.m01=i*e.m01,t.m02=i*e.m02,t.m03=r*e.m03,t.m04=r*e.m04,t.m05=r*e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t}static rotate(t,e,s){const i=e.m00,r=e.m01,a=e.m02,n=e.m03,m=e.m04,o=e.m05,h=e.m06,c=e.m07,l=e.m08,u=Math.sin(s),d=Math.cos(s);return t.m00=d*i+u*n,t.m01=d*r+u*m,t.m02=d*a+u*o,t.m03=d*n-u*i,t.m04=d*m-u*r,t.m05=d*o-u*a,t.m06=h,t.m07=c,t.m08=l,t}static fromMat4(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m04,t.m04=e.m05,t.m05=e.m06,t.m06=e.m08,t.m07=e.m09,t.m08=e.m10,t}static fromViewUp(t,e,s){return Vec3.lengthSqr(e)<1e-12?(Mat3.identity(t),t):(s=s||Vec3.UNIT_Y,Vec3.normalize(v3_1$2,Vec3.cross(v3_1$2,s,e)),Vec3.lengthSqr(v3_1$2)<1e-12?(Mat3.identity(t),t):(Vec3.cross(v3_2,e,v3_1$2),Mat3.set(t,v3_1$2.x,v3_1$2.y,v3_1$2.z,v3_2.x,v3_2.y,v3_2.z,e.x,e.y,e.z),t))}static fromTranslation(t,e){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=1,t.m05=0,t.m06=e.x,t.m07=e.y,t.m08=1,t}static fromScaling(t,e){return t.m00=e.x,t.m01=0,t.m02=0,t.m03=0,t.m04=e.y,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t}static fromRotation(t,e){const s=Math.sin(e),i=Math.cos(e);return t.m00=i,t.m01=s,t.m02=0,t.m03=-s,t.m04=i,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t}static fromQuat(t,e){const s=e.x,i=e.y,r=e.z,a=e.w,n=s+s,m=i+i,o=r+r,h=s*n,c=i*n,l=i*m,u=r*n,d=r*m,y=r*o,p=a*n,_=a*m,g=a*o;return t.m00=1-l-y,t.m03=c-g,t.m06=u+_,t.m01=c+g,t.m04=1-h-y,t.m07=d-p,t.m02=u-_,t.m05=d+p,t.m08=1-h-l,t}static inverseTransposeMat4(t,e){const s=e.m00,i=e.m01,r=e.m02,a=e.m03,n=e.m04,m=e.m05,o=e.m06,h=e.m07,c=e.m08,l=e.m09,u=e.m10,d=e.m11,y=e.m12,p=e.m13,_=e.m14,g=e.m15,x=s*m-i*n,M=s*o-r*n,f=s*h-a*n,w=i*o-r*m,T=i*h-a*m,b=r*h-a*o,z=c*p-l*y,E=c*_-u*y,S=c*g-d*y,v=l*_-u*p,C=l*g-d*p,I=u*g-d*_;let O=x*I-M*C+f*v+w*S-T*E+b*z;return O?(O=1/O,t.m00=(m*I-o*C+h*v)*O,t.m01=(o*S-n*I-h*E)*O,t.m02=(n*C-m*S+h*z)*O,t.m03=(r*C-i*I-a*v)*O,t.m04=(s*I-r*S+a*E)*O,t.m05=(i*S-s*C-a*z)*O,t.m06=(p*b-_*T+g*w)*O,t.m07=(_*f-y*b-g*M)*O,t.m08=(y*T-p*f+g*x)*O,t):null}static toArray(t,e,s=0){return t[s+0]=e.m00,t[s+1]=e.m01,t[s+2]=e.m02,t[s+3]=e.m03,t[s+4]=e.m04,t[s+5]=e.m05,t[s+6]=e.m06,t[s+7]=e.m07,t[s+8]=e.m08,t}static fromArray(t,e,s=0){return t.m00=e[s+0],t.m01=e[s+1],t.m02=e[s+2],t.m03=e[s+3],t.m04=e[s+4],t.m05=e[s+5],t.m06=e[s+6],t.m07=e[s+7],t.m08=e[s+8],t}static add(t,e,s){return t.m00=e.m00+s.m00,t.m01=e.m01+s.m01,t.m02=e.m02+s.m02,t.m03=e.m03+s.m03,t.m04=e.m04+s.m04,t.m05=e.m05+s.m05,t.m06=e.m06+s.m06,t.m07=e.m07+s.m07,t.m08=e.m08+s.m08,t}static subtract(t,e,s){return t.m00=e.m00-s.m00,t.m01=e.m01-s.m01,t.m02=e.m02-s.m02,t.m03=e.m03-s.m03,t.m04=e.m04-s.m04,t.m05=e.m05-s.m05,t.m06=e.m06-s.m06,t.m07=e.m07-s.m07,t.m08=e.m08-s.m08,t}static multiplyScalar(t,e,s){return t.m00=e.m00*s,t.m01=e.m01*s,t.m02=e.m02*s,t.m03=e.m03*s,t.m04=e.m04*s,t.m05=e.m05*s,t.m06=e.m06*s,t.m07=e.m07*s,t.m08=e.m08*s,t}static multiplyScalarAndAdd(t,e,s,i){return t.m00=s.m00*i+e.m00,t.m01=s.m01*i+e.m01,t.m02=s.m02*i+e.m02,t.m03=s.m03*i+e.m03,t.m04=s.m04*i+e.m04,t.m05=s.m05*i+e.m05,t.m06=s.m06*i+e.m06,t.m07=s.m07*i+e.m07,t.m08=s.m08*i+e.m08,t}static strictEquals(t,e){return t.m00===e.m00&&t.m01===e.m01&&t.m02===e.m02&&t.m03===e.m03&&t.m04===e.m04&&t.m05===e.m05&&t.m06===e.m06&&t.m07===e.m07&&t.m08===e.m08}static equals(t,e,s=EPSILON){return Math.abs(t.m00-e.m00)<=s*Math.max(1,Math.abs(t.m00),Math.abs(e.m00))&&Math.abs(t.m01-e.m01)<=s*Math.max(1,Math.abs(t.m01),Math.abs(e.m01))&&Math.abs(t.m02-e.m02)<=s*Math.max(1,Math.abs(t.m02),Math.abs(e.m02))&&Math.abs(t.m03-e.m03)<=s*Math.max(1,Math.abs(t.m03),Math.abs(e.m03))&&Math.abs(t.m04-e.m04)<=s*Math.max(1,Math.abs(t.m04),Math.abs(e.m04))&&Math.abs(t.m05-e.m05)<=s*Math.max(1,Math.abs(t.m05),Math.abs(e.m05))&&Math.abs(t.m06-e.m06)<=s*Math.max(1,Math.abs(t.m06),Math.abs(e.m06))&&Math.abs(t.m07-e.m07)<=s*Math.max(1,Math.abs(t.m07),Math.abs(e.m07))&&Math.abs(t.m08-e.m08)<=s*Math.max(1,Math.abs(t.m08),Math.abs(e.m08))}static toEuler(t,e){const s=t.m00,i=t.m01;t.m02;const r=t.m03,a=t.m04;t.m05;const n=t.m06,m=t.m07,o=t.m08;return m<.999?m>-.999?(e.x=Math.asin(-m),e.y=Math.atan2(n,o),e.z=Math.atan2(i,a),!0):(e.x=HALF_PI,e.y=Math.atan2(r,s),e.z=0,!1):(e.x=-HALF_PI,e.y=Math.atan2(-r,s),e.z=0,!1)}constructor(t=1,e=0,s=0,i=0,r=1,a=0,n=0,m=0,o=1){"object"==typeof t?(this.m00=t.m00,this.m01=t.m01,this.m02=t.m02,this.m03=t.m03,this.m04=t.m04,this.m05=t.m05,this.m06=t.m06,this.m07=t.m07,this.m08=t.m08):(this.m00=t,this.m01=e,this.m02=s,this.m03=i,this.m04=r,this.m05=a,this.m06=n,this.m07=m,this.m08=o)}clone(){const t=this;return new Mat3(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08)}set(t=1,e=0,s=0,i=0,r=1,a=0,n=0,m=0,o=1){return"object"==typeof t?(this.m00=t.m00,this.m01=t.m01,this.m02=t.m02,this.m03=t.m03,this.m04=t.m04,this.m05=t.m05,this.m06=t.m06,this.m07=t.m07,this.m08=t.m08):(this.m00=t,this.m01=e,this.m02=s,this.m03=i,this.m04=r,this.m05=a,this.m06=n,this.m07=m,this.m08=o),this}equals(t,e=EPSILON){return Math.abs(this.m00-t.m00)<=e*Math.max(1,Math.abs(this.m00),Math.abs(t.m00))&&Math.abs(this.m01-t.m01)<=e*Math.max(1,Math.abs(this.m01),Math.abs(t.m01))&&Math.abs(this.m02-t.m02)<=e*Math.max(1,Math.abs(this.m02),Math.abs(t.m02))&&Math.abs(this.m03-t.m03)<=e*Math.max(1,Math.abs(this.m03),Math.abs(t.m03))&&Math.abs(this.m04-t.m04)<=e*Math.max(1,Math.abs(this.m04),Math.abs(t.m04))&&Math.abs(this.m05-t.m05)<=e*Math.max(1,Math.abs(this.m05),Math.abs(t.m05))&&Math.abs(this.m06-t.m06)<=e*Math.max(1,Math.abs(this.m06),Math.abs(t.m06))&&Math.abs(this.m07-t.m07)<=e*Math.max(1,Math.abs(this.m07),Math.abs(t.m07))&&Math.abs(this.m08-t.m08)<=e*Math.max(1,Math.abs(this.m08),Math.abs(t.m08))}strictEquals(t){return this.m00===t.m00&&this.m01===t.m01&&this.m02===t.m02&&this.m03===t.m03&&this.m04===t.m04&&this.m05===t.m05&&this.m06===t.m06&&this.m07===t.m07&&this.m08===t.m08}toString(){const t=this;return`[\n${t.m00}, ${t.m01}, ${t.m02},\n${t.m03},\n${t.m04}, ${t.m05},\n${t.m06}, ${t.m07},\n${t.m08}\n]`}identity(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=1,this.m05=0,this.m06=0,this.m07=0,this.m08=1,this}transpose(){const t=this.m01,e=this.m02,s=this.m05;return this.m01=this.m03,this.m02=this.m06,this.m03=t,this.m05=this.m07,this.m06=e,this.m07=s,this}invert(){const t=this.m00,e=this.m01,s=this.m02,i=this.m03,r=this.m04,a=this.m05,n=this.m06,m=this.m07,o=this.m08,h=o*r-a*m,c=-o*i+a*n,l=m*i-r*n;let u=t*h+e*c+s*l;return 0===u?(this.set(0,0,0,0,0,0,0,0,0),this):(u=1/u,this.m00=h*u,this.m01=(-o*e+s*m)*u,this.m02=(a*e-s*r)*u,this.m03=c*u,this.m04=(o*t-s*n)*u,this.m05=(-a*t+s*i)*u,this.m06=l*u,this.m07=(-m*t+e*n)*u,this.m08=(r*t-e*i)*u,this)}determinant(){const t=this.m00,e=this.m01,s=this.m02,i=this.m03,r=this.m04,a=this.m05,n=this.m06,m=this.m07,o=this.m08;return t*(o*r-a*m)+e*(-o*i+a*n)+s*(m*i-r*n)}add(t){return this.m00+=t.m00,this.m01+=t.m01,this.m02+=t.m02,this.m03+=t.m03,this.m04+=t.m04,this.m05+=t.m05,this.m06+=t.m06,this.m07+=t.m07,this.m08+=t.m08,this}subtract(t){return this.m00-=t.m00,this.m01-=t.m01,this.m02-=t.m02,this.m03-=t.m03,this.m04-=t.m04,this.m05-=t.m05,this.m06-=t.m06,this.m07-=t.m07,this.m08-=t.m08,this}multiply(t){const e=this.m00,s=this.m01,i=this.m02,r=this.m03,a=this.m04,n=this.m05,m=this.m06,o=this.m07,h=this.m08,c=t.m00,l=t.m01,u=t.m02,d=t.m03,y=t.m04,p=t.m05,_=t.m06,g=t.m07,x=t.m08;return this.m00=c*e+l*r+u*m,this.m01=c*s+l*a+u*o,this.m02=c*i+l*n+u*h,this.m03=d*e+y*r+p*m,this.m04=d*s+y*a+p*o,this.m05=d*i+y*n+p*h,this.m06=_*e+g*r+x*m,this.m07=_*s+g*a+x*o,this.m08=_*i+g*n+x*h,this}multiplyScalar(t){return this.m00*=t,this.m01*=t,this.m02*=t,this.m03*=t,this.m04*=t,this.m05*=t,this.m06*=t,this.m07*=t,this.m08*=t,this}scale(t){const e=t.x,s=t.y;return this.m00=e*this.m00,this.m01=e*this.m01,this.m02=e*this.m02,this.m03=s*this.m03,this.m04=s*this.m04,this.m05=s*this.m05,this.m06=this.m06,this.m07=this.m07,this.m08=this.m08,this}rotate(t){const e=this.m00,s=this.m01,i=this.m02,r=this.m03,a=this.m04,n=this.m05,m=this.m06,o=this.m07,h=this.m08,c=Math.sin(t),l=Math.cos(t);return this.m00=l*e+c*r,this.m01=l*s+c*a,this.m02=l*i+c*n,this.m03=l*r-c*e,this.m04=l*a-c*s,this.m05=l*n-c*i,this.m06=m,this.m07=o,this.m08=h,this}fromQuat(t){const e=t.x,s=t.y,i=t.z,r=t.w,a=e+e,n=s+s,m=i+i,o=e*a,h=s*a,c=s*n,l=i*a,u=i*n,d=i*m,y=r*a,p=r*n,_=r*m;return this.m00=1-c-d,this.m03=h-_,this.m06=l+p,this.m01=h+_,this.m04=1-o-d,this.m07=u-y,this.m02=l-p,this.m05=u+y,this.m08=1-o-c,this}}Mat3.IDENTITY=Object.freeze(new Mat3);const v3_1$2=new Vec3,v3_2=new Vec3;class Quat{static clone(t){return new Quat(t.x,t.y,t.z,t.w)}static copy(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}static set(t,e,s,i,r){return t.x=e,t.y=s,t.z=i,t.w=r,t}static identity(t){return t.x=0,t.y=0,t.z=0,t.w=1,t}static rotationTo(t,e,s){const i=Vec3.dot(e,s);return i<-.999999?(Vec3.cross(v3_1$1,Vec3.UNIT_X,e),v3_1$1.length()<1e-6&&Vec3.cross(v3_1$1,Vec3.UNIT_Y,e),Vec3.normalize(v3_1$1,v3_1$1),Quat.fromAxisAngle(t,v3_1$1,Math.PI),t):i>.999999?(t.x=0,t.y=0,t.z=0,t.w=1,t):(Vec3.cross(v3_1$1,e,s),t.x=v3_1$1.x,t.y=v3_1$1.y,t.z=v3_1$1.z,t.w=1+i,Quat.normalize(t,t))}static getAxisAngle(t,e){const s=2*Math.acos(e.w),i=Math.sin(s/2);return 0!==i?(t.x=e.x/i,t.y=e.y/i,t.z=e.z/i):(t.x=1,t.y=0,t.z=0),s}static multiply(t,e,s){const i=e.x*s.w+e.w*s.x+e.y*s.z-e.z*s.y,r=e.y*s.w+e.w*s.y+e.z*s.x-e.x*s.z,a=e.z*s.w+e.w*s.z+e.x*s.y-e.y*s.x,n=e.w*s.w-e.x*s.x-e.y*s.y-e.z*s.z;return t.x=i,t.y=r,t.z=a,t.w=n,t}static multiplyScalar(t,e,s){return t.x=e.x*s,t.y=e.y*s,t.z=e.z*s,t.w=e.w*s,t}static scaleAndAdd(t,e,s,i){return t.x=e.x+s.x*i,t.y=e.y+s.y*i,t.z=e.z+s.z*i,t.w=e.w+s.w*i,t}static rotateX(t,e,s){s*=.5;const i=Math.sin(s),r=Math.cos(s),{x:a,y:n,z:m,w:o}=e;return t.x=a*r+o*i,t.y=n*r+m*i,t.z=m*r-n*i,t.w=o*r-a*i,t}static rotateY(t,e,s){s*=.5;const i=Math.sin(s),r=Math.cos(s),{x:a,y:n,z:m,w:o}=e;return t.x=a*r-m*i,t.y=n*r+o*i,t.z=m*r+a*i,t.w=o*r-n*i,t}static rotateZ(t,e,s){s*=.5;const i=Math.sin(s),r=Math.cos(s),{x:a,y:n,z:m,w:o}=e;return t.x=a*r+n*i,t.y=n*r-a*i,t.z=m*r+o*i,t.w=o*r-m*i,t}static rotateAround(t,e,s,i){return Quat.invert(qt_1,e),Vec3.transformQuat(v3_1$1,s,qt_1),Quat.fromAxisAngle(qt_1,v3_1$1,i),Quat.multiply(t,e,qt_1),t}static rotateAroundLocal(t,e,s,i){return Quat.fromAxisAngle(qt_1,s,i),Quat.multiply(t,e,qt_1),t}static calculateW(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=Math.sqrt(Math.abs(1-e.x*e.x-e.y*e.y-e.z*e.z)),t}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w}static lerp(t,e,s,i){return t.x=e.x+i*(s.x-e.x),t.y=e.y+i*(s.y-e.y),t.z=e.z+i*(s.z-e.z),t.w=e.w+i*(s.w-e.w),t}static slerp(t,e,s,i){let r=0,a=0,n=s.x,m=s.y,o=s.z,h=s.w,c=e.x*s.x+e.y*s.y+e.z*s.z+e.w*s.w;if(c<0&&(c=-c,n=-n,m=-m,o=-o,h=-h),1-c>1e-6){const t=Math.acos(c),e=Math.sin(t);r=Math.sin((1-i)*t)/e,a=Math.sin(i*t)/e}else r=1-i,a=i;return t.x=r*e.x+a*n,t.y=r*e.y+a*m,t.z=r*e.z+a*o,t.w=r*e.w+a*h,t}static sqlerp(t,e,s,i,r,a){return Quat.slerp(qt_1,e,r,a),Quat.slerp(qt_2,s,i,a),Quat.slerp(t,qt_1,qt_2,2*a*(1-a)),t}static invert(t,e){const s=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w,i=s?1/s:0;return t.x=-e.x*i,t.y=-e.y*i,t.z=-e.z*i,t.w=e.w*i,t}static conjugate(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w,t}static len(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w)}static lengthSqr(t){return t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w}static normalize(t,e){let s=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w;return s>0?(s=1/Math.sqrt(s),t.x=e.x*s,t.y=e.y*s,t.z=e.z*s,t.w=e.w*s):(t.x=0,t.y=0,t.z=0,t.w=0),t}static fromAxes(t,e,s,i){return Mat3.set(m3_1$1,e.x,e.y,e.z,s.x,s.y,s.z,i.x,i.y,i.z),Quat.normalize(t,Quat.fromMat3(t,m3_1$1))}static fromViewUp(t,e,s){return Mat3.fromViewUp(m3_1$1,e,s),Quat.normalize(t,Quat.fromMat3(t,m3_1$1))}static fromAxisAngle(t,e,s){s*=.5;const i=Math.sin(s);return t.x=i*e.x,t.y=i*e.y,t.z=i*e.z,t.w=Math.cos(s),t}static fromMat3(t,e){const{m00:s,m01:i,m02:r,m03:a,m04:n,m05:m,m06:o,m07:h,m08:c}=e,l=s-n-c,u=n-s-c,d=c-s-n;let y=0,p=s+n+c;l>p&&(p=l,y=1),u>p&&(p=u,y=2),d>p&&(p=d,y=3);const _=.5*Math.sqrt(p+1),g=.25/_;switch(y){case 0:t.w=_,t.x=(m-h)*g,t.y=(o-r)*g,t.z=(i-a)*g;break;case 1:t.w=(m-h)*g,t.x=_,t.y=(i+a)*g,t.z=(o+r)*g;break;case 2:t.w=(o-r)*g,t.x=(i+a)*g,t.y=_,t.z=(m+h)*g;break;case 3:t.w=(i-a)*g,t.x=(o+r)*g,t.y=(m+h)*g,t.z=_;break;default:t.w=1,t.x=0,t.y=0,t.z=0}return t}static fromEuler(t,e,s,i){e*=halfToRad,s*=halfToRad,i*=halfToRad;const r=Math.sin(e),a=Math.cos(e),n=Math.sin(s),m=Math.cos(s),o=Math.sin(i),h=Math.cos(i);return t.x=r*m*h+a*n*o,t.y=a*n*h+r*m*o,t.z=a*m*o-r*n*h,t.w=a*m*h-r*n*o,t}static fromAngleZ(t,e){return e*=halfToRad,t.x=t.y=0,t.z=Math.sin(e),t.w=Math.cos(e),t}static toAxisX(t,e){const s=2*e.y,i=2*e.z;return t.x=1-s*e.y-i*e.z,t.y=s*e.x+i*e.w,t.z=i*e.x-s*e.w,t}static toAxisY(t,e){const s=2*e.x,i=2*e.y,r=2*e.z;return t.x=i*e.x-r*e.w,t.y=1-s*e.x-r*e.z,t.z=r*e.y+s*e.w,t}static toAxisZ(t,e){const s=2*e.x,i=2*e.y,r=2*e.z;return t.x=r*e.x+i*e.w,t.y=r*e.y-s*e.w,t.z=1-s*e.x-i*e.y,t}static toEuler(t,e,s){const{x:i,y:r,z:a,w:n}=e;let m=0,o=0,h=0;const c=i*r+a*n;if(c>.499999)m=0,o=toDegree(2*Math.atan2(i,n)),h=90;else if(c<-.499999)m=0,o=-toDegree(2*Math.atan2(i,n)),h=-90;else{const t=i*i,e=r*r,l=a*a;m=toDegree(Math.atan2(2*i*n-2*r*a,1-2*t-2*l)),o=toDegree(Math.atan2(2*r*n-2*i*a,1-2*e-2*l)),h=toDegree(Math.asin(2*c)),s&&(m=-180*Math.sign(m+1e-6)+m,o=-180*Math.sign(o+1e-6)+o,h=180*Math.sign(h+1e-6)-h)}return t.x=m,t.y=o,t.z=h,t}static toEulerInYXZOrder(t,e){Mat3.fromQuat(m3_1$1,e),Mat3.toEuler(m3_1$1,t),t.x=toDegree(t.x),t.y=toDegree(t.y),t.z=toDegree(t.z)}static toArray(t,e,s=0){return t[s+0]=e.x,t[s+1]=e.y,t[s+2]=e.z,t[s+3]=e.w,t}static fromArray(t,e,s=0){return t.x=e[s+0],t.y=e[s+1],t.z=e[s+2],t.w=e[s+3],t}static strictEquals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}static equals(t,e,s=EPSILON){return Math.abs(t.x-e.x)<=s*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=s*Math.max(1,Math.abs(t.y),Math.abs(e.y))&&Math.abs(t.z-e.z)<=s*Math.max(1,Math.abs(t.z),Math.abs(e.z))&&Math.abs(t.w-e.w)<=s*Math.max(1,Math.abs(t.w),Math.abs(e.w))}static angle(t,e){const s=Math.min(Math.abs(Quat.dot(t,e)),1);return 2*Math.acos(s)}static rotateTowards(t,e,s,i){const r=Quat.angle(e,s);if(0===r)return t.x=s.x,t.y=s.y,t.z=s.z,t.w=s.w,t;const a=Math.min(i/toDegree(r),1);return Quat.slerp(t,e,s,a)}constructor(t,e,s,i){"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=s||0,this.w=i??1)}clone(){return new Quat(this.x,this.y,this.z,this.w)}set(t,e,s,i){return"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=s||0,this.w=i??1),this}equals(t,e=EPSILON){return Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))&&Math.abs(this.z-t.z)<=e*Math.max(1,Math.abs(this.z),Math.abs(t.z))&&Math.abs(this.w-t.w)<=e*Math.max(1,Math.abs(this.w),Math.abs(t.w))}strictEquals(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}getEulerAngles(t){return Quat.toEuler(t,this)}lerp(t,e){return this.x+=e*(t.x-this.x),this.y+=e*(t.y-this.y),this.z+=e*(t.z-this.z),this.w+=e*(t.w-this.w),this}slerp(t,e){return Quat.slerp(this,this,t,e)}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSqr(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}}Quat.IDENTITY=Object.freeze(new Quat);const qt_1=new Quat,qt_2=new Quat,v3_1$1=new Vec3,m3_1$1=new Mat3,halfToRad=.5*Math.PI/180;function quat(t=0,e=0,s=0,i=1){return new Quat(t,e,s,i)}const preTransforms=Object.freeze([Object.freeze([1,0,0,1]),Object.freeze([0,1,-1,0]),Object.freeze([-1,0,0,-1]),Object.freeze([0,-1,1,0])]);class Mat4{static clone(t){return new Mat4(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08,t.m09,t.m10,t.m11,t.m12,t.m13,t.m14,t.m15)}static copy(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15,t}static set(t,e,s,i,r,a,n,m,o,h,c,l,u,d,y,p,_){return t.m00=e,t.m01=s,t.m02=i,t.m03=r,t.m04=a,t.m05=n,t.m06=m,t.m07=o,t.m08=h,t.m09=c,t.m10=l,t.m11=u,t.m12=d,t.m13=y,t.m14=p,t.m15=_,t}static identity(t){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t}static transpose(t,e){if(t===e){const s=e.m01,i=e.m02,r=e.m03,a=e.m06,n=e.m07,m=e.m11;t.m01=e.m04,t.m02=e.m08,t.m03=e.m12,t.m04=s,t.m06=e.m09,t.m07=e.m13,t.m08=i,t.m09=a,t.m11=e.m14,t.m12=r,t.m13=n,t.m14=m}else t.m00=e.m00,t.m01=e.m04,t.m02=e.m08,t.m03=e.m12,t.m04=e.m01,t.m05=e.m05,t.m06=e.m09,t.m07=e.m13,t.m08=e.m02,t.m09=e.m06,t.m10=e.m10,t.m11=e.m14,t.m12=e.m03,t.m13=e.m07,t.m14=e.m11,t.m15=e.m15;return t}static invert(t,e){const s=e.m00,i=e.m01,r=e.m02,a=e.m03,n=e.m04,m=e.m05,o=e.m06,h=e.m07,c=e.m08,l=e.m09,u=e.m10,d=e.m11,y=e.m12,p=e.m13,_=e.m14,g=e.m15,x=s*m-i*n,M=s*o-r*n,f=s*h-a*n,w=i*o-r*m,T=i*h-a*m,b=r*h-a*o,z=c*p-l*y,E=c*_-u*y,S=c*g-d*y,v=l*_-u*p,C=l*g-d*p,I=u*g-d*_;let O=x*I-M*C+f*v+w*S-T*E+b*z;return 0===O?(t.m00=0,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=0,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=0,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=0,t):(O=1/O,t.m00=(m*I-o*C+h*v)*O,t.m01=(r*C-i*I-a*v)*O,t.m02=(p*b-_*T+g*w)*O,t.m03=(u*T-l*b-d*w)*O,t.m04=(o*S-n*I-h*E)*O,t.m05=(s*I-r*S+a*E)*O,t.m06=(_*f-y*b-g*M)*O,t.m07=(c*b-u*f+d*M)*O,t.m08=(n*C-m*S+h*z)*O,t.m09=(i*S-s*C-a*z)*O,t.m10=(y*T-p*f+g*x)*O,t.m11=(l*f-c*T-d*x)*O,t.m12=(m*E-n*v-o*z)*O,t.m13=(s*v-i*E+r*z)*O,t.m14=(p*M-y*w-_*x)*O,t.m15=(c*w-l*M+u*x)*O,t)}static determinant(t){const e=t.m00,s=t.m01,i=t.m02,r=t.m03,a=t.m04,n=t.m05,m=t.m06,o=t.m07,h=t.m08,c=t.m09,l=t.m10,u=t.m11,d=t.m12,y=t.m13,p=t.m14,_=t.m15;return(e*n-s*a)*(l*_-u*p)-(e*m-i*a)*(c*_-u*y)+(e*o-r*a)*(c*p-l*y)+(s*m-i*n)*(h*_-u*d)-(s*o-r*n)*(h*p-l*d)+(i*o-r*m)*(h*y-c*d)}static multiply(t,e,s){const i=e.m00,r=e.m01,a=e.m02,n=e.m03,m=e.m04,o=e.m05,h=e.m06,c=e.m07,l=e.m08,u=e.m09,d=e.m10,y=e.m11,p=e.m12,_=e.m13,g=e.m14,x=e.m15;let M=s.m00,f=s.m01,w=s.m02,T=s.m03;return t.m00=M*i+f*m+w*l+T*p,t.m01=M*r+f*o+w*u+T*_,t.m02=M*a+f*h+w*d+T*g,t.m03=M*n+f*c+w*y+T*x,M=s.m04,f=s.m05,w=s.m06,T=s.m07,t.m04=M*i+f*m+w*l+T*p,t.m05=M*r+f*o+w*u+T*_,t.m06=M*a+f*h+w*d+T*g,t.m07=M*n+f*c+w*y+T*x,M=s.m08,f=s.m09,w=s.m10,T=s.m11,t.m08=M*i+f*m+w*l+T*p,t.m09=M*r+f*o+w*u+T*_,t.m10=M*a+f*h+w*d+T*g,t.m11=M*n+f*c+w*y+T*x,M=s.m12,f=s.m13,w=s.m14,T=s.m15,t.m12=M*i+f*m+w*l+T*p,t.m13=M*r+f*o+w*u+T*_,t.m14=M*a+f*h+w*d+T*g,t.m15=M*n+f*c+w*y+T*x,t}static transform(t,e,s){const i=s.x,r=s.y,a=s.z;if(e===t)t.m12=e.m00*i+e.m04*r+e.m08*a+e.m12,t.m13=e.m01*i+e.m05*r+e.m09*a+e.m13,t.m14=e.m02*i+e.m06*r+e.m10*a+e.m14,t.m15=e.m03*i+e.m07*r+e.m11*a+e.m15;else{const s=e.m00,n=e.m01,m=e.m02,o=e.m03,h=e.m04,c=e.m05,l=e.m06,u=e.m07,d=e.m08,y=e.m09,p=e.m10,_=e.m11;t.m00=s,t.m01=n,t.m02=m,t.m03=o,t.m04=h,t.m05=c,t.m06=l,t.m07=u,t.m08=d,t.m09=y,t.m10=p,t.m11=_,t.m12=s*i+h*r+d*a+e.m12,t.m13=n*i+c*r+y*a+e.m13,t.m14=m*i+l*r+p*a+e.m14,t.m15=o*i+u*r+_*a+e.m15}return t}static translate(t,e,s){return e===t?(t.m12+=s.x,t.m13+=s.y,t.m14+=s.z):(t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12=e.m12+s.x,t.m13=e.m13+s.y,t.m14=e.m14+s.z,t.m15=e.m15),t}static scale(t,e,s){const i=s.x,r=s.y,a=s.z;return t.m00=e.m00*i,t.m01=e.m01*i,t.m02=e.m02*i,t.m03=e.m03*i,t.m04=e.m04*r,t.m05=e.m05*r,t.m06=e.m06*r,t.m07=e.m07*r,t.m08=e.m08*a,t.m09=e.m09*a,t.m10=e.m10*a,t.m11=e.m11*a,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15,t}static rotate(t,e,s,i){let r=i.x,a=i.y,n=i.z,m=Math.sqrt(r*r+a*a+n*n);if(Math.abs(m)<EPSILON)return null;m=1/m,r*=m,a*=m,n*=m;const o=Math.sin(s),h=Math.cos(s),c=1-h,l=e.m00,u=e.m01,d=e.m02,y=e.m03,p=e.m04,_=e.m05,g=e.m06,x=e.m07,M=e.m08,f=e.m09,w=e.m10,T=e.m11,b=r*r*c+h,z=a*r*c+n*o,E=n*r*c-a*o,S=r*a*c-n*o,v=a*a*c+h,C=n*a*c+r*o,I=r*n*c+a*o,O=a*n*c-r*o,D=n*n*c+h;return t.m00=l*b+p*z+M*E,t.m01=u*b+_*z+f*E,t.m02=d*b+g*z+w*E,t.m03=y*b+x*z+T*E,t.m04=l*S+p*v+M*C,t.m05=u*S+_*v+f*C,t.m06=d*S+g*v+w*C,t.m07=y*S+x*v+T*C,t.m08=l*I+p*O+M*D,t.m09=u*I+_*O+f*D,t.m10=d*I+g*O+w*D,t.m11=y*I+x*O+T*D,e!==t&&(t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t}static rotateX(t,e,s){const i=Math.sin(s),r=Math.cos(s),a=e.m04,n=e.m05,m=e.m06,o=e.m07,h=e.m08,c=e.m09,l=e.m10,u=e.m11;return e!==t&&(t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m04=a*r+h*i,t.m05=n*r+c*i,t.m06=m*r+l*i,t.m07=o*r+u*i,t.m08=h*r-a*i,t.m09=c*r-n*i,t.m10=l*r-m*i,t.m11=u*r-o*i,t}static rotateY(t,e,s){const i=Math.sin(s),r=Math.cos(s),a=e.m00,n=e.m01,m=e.m02,o=e.m03,h=e.m08,c=e.m09,l=e.m10,u=e.m11;return e!==t&&(t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m00=a*r-h*i,t.m01=n*r-c*i,t.m02=m*r-l*i,t.m03=o*r-u*i,t.m08=a*i+h*r,t.m09=n*i+c*r,t.m10=m*i+l*r,t.m11=o*i+u*r,t}static rotateZ(t,e,s){const i=Math.sin(s),r=Math.cos(s),a=e.m00,n=e.m01,m=e.m02,o=e.m03,h=e.m04,c=e.m05,l=e.m06,u=e.m07;return e!==t&&(t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m00=a*r+h*i,t.m01=n*r+c*i,t.m02=m*r+l*i,t.m03=o*r+u*i,t.m04=h*r-a*i,t.m05=c*r-n*i,t.m06=l*r-m*i,t.m07=u*r-o*i,t}static fromTranslation(t,e){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=e.x,t.m13=e.y,t.m14=e.z,t.m15=1,t}static fromScaling(t,e){return t.m00=e.x,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=e.y,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=e.z,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t}static fromRotation(t,e,s){let i=s.x,r=s.y,a=s.z,n=Math.sqrt(i*i+r*r+a*a);if(Math.abs(n)<EPSILON)return null;n=1/n,i*=n,r*=n,a*=n;const m=Math.sin(e),o=Math.cos(e),h=1-o;return t.m00=i*i*h+o,t.m01=r*i*h+a*m,t.m02=a*i*h-r*m,t.m03=0,t.m04=i*r*h-a*m,t.m05=r*r*h+o,t.m06=a*r*h+i*m,t.m07=0,t.m08=i*a*h+r*m,t.m09=r*a*h-i*m,t.m10=a*a*h+o,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t}static fromXRotation(t,e){const s=Math.sin(e),i=Math.cos(e);return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=i,t.m06=s,t.m07=0,t.m08=0,t.m09=-s,t.m10=i,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t}static fromYRotation(t,e){const s=Math.sin(e),i=Math.cos(e);return t.m00=i,t.m01=0,t.m02=-s,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=s,t.m09=0,t.m10=i,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t}static fromZRotation(t,e){const s=Math.sin(e),i=Math.cos(e);return t.m00=i,t.m01=s,t.m02=0,t.m03=0,t.m04=-s,t.m05=i,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t}static fromRT(t,e,s){const i=e.x,r=e.y,a=e.z,n=e.w,m=i+i,o=r+r,h=a+a,c=i*m,l=i*o,u=i*h,d=r*o,y=r*h,p=a*h,_=n*m,g=n*o,x=n*h;return t.m00=1-(d+p),t.m01=l+x,t.m02=u-g,t.m03=0,t.m04=l-x,t.m05=1-(c+p),t.m06=y+_,t.m07=0,t.m08=u+g,t.m09=y-_,t.m10=1-(c+d),t.m11=0,t.m12=s.x,t.m13=s.y,t.m14=s.z,t.m15=1,t}static getTranslation(t,e){return t.x=e.m12,t.y=e.m13,t.z=e.m14,t}static getScaling(t,e){const s=m3_1.m00=e.m00,i=m3_1.m01=e.m01,r=m3_1.m02=e.m02,a=m3_1.m03=e.m04,n=m3_1.m04=e.m05,m=m3_1.m05=e.m06,o=m3_1.m06=e.m08,h=m3_1.m07=e.m09,c=m3_1.m08=e.m10;return t.x=Math.sqrt(s*s+i*i+r*r),t.y=Math.sqrt(a*a+n*n+m*m),t.z=Math.sqrt(o*o+h*h+c*c),Mat3.determinant(m3_1)<0&&(t.x*=-1),t}static getRotation(t,e){const s=e.m00+e.m05+e.m10;let i=0;return s>0?(i=2*Math.sqrt(s+1),t.w=.25*i,t.x=(e.m06-e.m09)/i,t.y=(e.m08-e.m02)/i,t.z=(e.m01-e.m04)/i):e.m00>e.m05&&e.m00>e.m10?(i=2*Math.sqrt(1+e.m00-e.m05-e.m10),t.w=(e.m06-e.m09)/i,t.x=.25*i,t.y=(e.m01+e.m04)/i,t.z=(e.m08+e.m02)/i):e.m05>e.m10?(i=2*Math.sqrt(1+e.m05-e.m00-e.m10),t.w=(e.m08-e.m02)/i,t.x=(e.m01+e.m04)/i,t.y=.25*i,t.z=(e.m06+e.m09)/i):(i=2*Math.sqrt(1+e.m10-e.m00-e.m05),t.w=(e.m01-e.m04)/i,t.x=(e.m08+e.m02)/i,t.y=(e.m06+e.m09)/i,t.z=.25*i),t}static toRTS(t,e,s,i){const r=Vec3.set(v3_1,t.m00,t.m01,t.m02).length(),a=Vec3.set(v3_1,t.m04,t.m05,t.m06).length(),n=Vec3.set(v3_1,t.m08,t.m09,t.m10).length();m3_1.m00=t.m00/r,m3_1.m01=t.m01/r,m3_1.m02=t.m02/r,m3_1.m03=t.m04/a,m3_1.m04=t.m05/a,m3_1.m05=t.m06/a,m3_1.m06=t.m08/n,m3_1.m07=t.m09/n,m3_1.m08=t.m10/n;const m=Mat3.determinant(m3_1);i&&(Vec3.set(i,r,a,n),m<0&&(i.x*=-1)),s&&Vec3.set(s,t.m12,t.m13,t.m14),e&&(m<0&&(m3_1.m00*=-1,m3_1.m01*=-1,m3_1.m02*=-1),Quat.fromMat3(e,m3_1))}static toSRT(t,e,s,i){const r=Vec3.set(v3_1,t.m00,t.m01,t.m02).length(),a=Vec3.set(v3_1,t.m04,t.m05,t.m06).length(),n=Vec3.set(v3_1,t.m08,t.m09,t.m10).length();if(i&&(i.x=r,i.y=a,i.z=n),s&&Vec3.set(s,t.m12,t.m13,t.m14),e){m3_1.m00=t.m00/r,m3_1.m01=t.m01/r,m3_1.m02=t.m02/r,m3_1.m03=t.m04/a,m3_1.m04=t.m05/a,m3_1.m05=t.m06/a,m3_1.m06=t.m08/n,m3_1.m07=t.m09/n,m3_1.m08=t.m10/n;Mat3.determinant(m3_1)<0&&(i&&(i.x*=-1),m3_1.m00*=-1,m3_1.m01*=-1,m3_1.m02*=-1),Quat.fromMat3(e,m3_1)}}static toEuler(t,e){return Mat3.set(m3_1,t.m00,t.m01,t.m02,t.m04,t.m05,t.m06,t.m08,t.m09,t.m10),Mat3.toEuler(m3_1,e)}static fromRTS(t,e,s,i){const r=e.x,a=e.y,n=e.z,m=e.w,o=r+r,h=a+a,c=n+n,l=r*o,u=r*h,d=r*c,y=a*h,p=a*c,_=n*c,g=m*o,x=m*h,M=m*c,f=i.x,w=i.y,T=i.z;return t.m00=(1-(y+_))*f,t.m01=(u+M)*f,t.m02=(d-x)*f,t.m03=0,t.m04=(u-M)*w,t.m05=(1-(l+_))*w,t.m06=(p+g)*w,t.m07=0,t.m08=(d+x)*T,t.m09=(p-g)*T,t.m10=(1-(l+y))*T,t.m11=0,t.m12=s.x,t.m13=s.y,t.m14=s.z,t.m15=1,t}static fromSRT(t,e,s,i){const r=e.x,a=e.y,n=e.z,m=e.w,o=r+r,h=a+a,c=n+n,l=r*o,u=r*h,d=r*c,y=a*h,p=a*c,_=n*c,g=m*o,x=m*h,M=m*c,f=i.x,w=i.y,T=i.z;return t.m00=(1-(y+_))*f,t.m01=(u+M)*f,t.m02=(d-x)*f,t.m03=0,t.m04=(u-M)*w,t.m05=(1-(l+_))*w,t.m06=(p+g)*w,t.m07=0,t.m08=(d+x)*T,t.m09=(p-g)*T,t.m10=(1-(l+y))*T,t.m11=0,t.m12=s.x,t.m13=s.y,t.m14=s.z,t.m15=1,t}static fromRTSOrigin(t,e,s,i,r){const a=e.x,n=e.y,m=e.z,o=e.w,h=a+a,c=n+n,l=m+m,u=a*h,d=a*c,y=a*l,p=n*c,_=n*l,g=m*l,x=o*h,M=o*c,f=o*l,w=i.x,T=i.y,b=i.z,z=r.x,E=r.y,S=r.z;return t.m00=(1-(p+g))*w,t.m01=(d+f)*w,t.m02=(y-M)*w,t.m03=0,t.m04=(d-f)*T,t.m05=(1-(u+g))*T,t.m06=(_+x)*T,t.m07=0,t.m08=(y+M)*b,t.m09=(_-x)*b,t.m10=(1-(u+p))*b,t.m11=0,t.m12=s.x+z-(t.m00*z+t.m04*E+t.m08*S),t.m13=s.y+E-(t.m01*z+t.m05*E+t.m09*S),t.m14=s.z+S-(t.m02*z+t.m06*E+t.m10*S),t.m15=1,t}static fromSRTOrigin(t,e,s,i,r){const a=e.x,n=e.y,m=e.z,o=e.w,h=a+a,c=n+n,l=m+m,u=a*h,d=a*c,y=a*l,p=n*c,_=n*l,g=m*l,x=o*h,M=o*c,f=o*l,w=i.x,T=i.y,b=i.z,z=r.x,E=r.y,S=r.z;return t.m00=(1-(p+g))*w,t.m01=(d+f)*w,t.m02=(y-M)*w,t.m03=0,t.m04=(d-f)*T,t.m05=(1-(u+g))*T,t.m06=(_+x)*T,t.m07=0,t.m08=(y+M)*b,t.m09=(_-x)*b,t.m10=(1-(u+p))*b,t.m11=0,t.m12=s.x+z-(t.m00*z+t.m04*E+t.m08*S),t.m13=s.y+E-(t.m01*z+t.m05*E+t.m09*S),t.m14=s.z+S-(t.m02*z+t.m06*E+t.m10*S),t.m15=1,t}static fromQuat(t,e){const s=e.x,i=e.y,r=e.z,a=e.w,n=s+s,m=i+i,o=r+r,h=s*n,c=i*n,l=i*m,u=r*n,d=r*m,y=r*o,p=a*n,_=a*m,g=a*o;return t.m00=1-l-y,t.m01=c+g,t.m02=u-_,t.m03=0,t.m04=c-g,t.m05=1-h-y,t.m06=d+p,t.m07=0,t.m08=u+_,t.m09=d-p,t.m10=1-h-l,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t}static frustum(t,e,s,i,r,a,n){const m=1/(s-e),o=1/(r-i),h=1/(a-n);return t.m00=2*a*m,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=2*a*o,t.m06=0,t.m07=0,t.m08=(s+e)*m,t.m09=(r+i)*o,t.m10=(n+a)*h,t.m11=-1,t.m12=0,t.m13=0,t.m14=n*a*2*h,t.m15=0,t}static perspective(t,e,s,i,r,a=!0,n=-1,m=1,o=0){const h=1/Math.tan(e/2),c=1/(i-r),l=a?h/s:h,u=(a?h:h*s)*m,d=preTransforms[o];return t.m00=l*d[0],t.m01=l*d[1],t.m02=0,t.m03=0,t.m04=u*d[2],t.m05=u*d[3],t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=(r-n*i)*c,t.m11=-1,t.m12=0,t.m13=0,t.m14=r*i*c*(1-n),t.m15=0,t}static ortho(t,e,s,i,r,a,n,m=-1,o=1,h=0){const c=1/(e-s),l=1/(i-r)*o,u=1/(a-n),d=-2*c,y=-2*l,p=(e+s)*c,_=(r+i)*l,g=preTransforms[h];return t.m00=d*g[0],t.m01=d*g[1],t.m02=0,t.m03=0,t.m04=y*g[2],t.m05=y*g[3],t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=u*(1-m),t.m11=0,t.m12=p*g[0]+_*g[2],t.m13=p*g[1]+_*g[3],t.m14=(a-m*n)*u,t.m15=1,t}static lookAt(t,e,s,i){const r=e.x,a=e.y,n=e.z,m=i.x,o=i.y,h=i.z;let c=r-s.x,l=a-s.y,u=n-s.z,d=1/Math.sqrt(c*c+l*l+u*u);c*=d,l*=d,u*=d;let y=o*u-h*l,p=h*c-m*u,_=m*l-o*c;d=1/Math.sqrt(y*y+p*p+_*_),y*=d,p*=d,_*=d;const g=l*_-u*p,x=u*y-c*_,M=c*p-l*y;return t.m00=y,t.m01=g,t.m02=c,t.m03=0,t.m04=p,t.m05=x,t.m06=l,t.m07=0,t.m08=_,t.m09=M,t.m10=u,t.m11=0,t.m12=-(y*r+p*a+_*n),t.m13=-(g*r+x*a+M*n),t.m14=-(c*r+l*a+u*n),t.m15=1,t}static inverseTranspose(t,e){const s=e.m00,i=e.m01,r=e.m02,a=e.m03,n=e.m04,m=e.m05,o=e.m06,h=e.m07,c=e.m08,l=e.m09,u=e.m10,d=e.m11,y=e.m12,p=e.m13,_=e.m14,g=e.m15,x=s*m-i*n,M=s*o-r*n,f=s*h-a*n,w=i*o-r*m,T=i*h-a*m,b=r*h-a*o,z=c*p-l*y,E=c*_-u*y,S=c*g-d*y,v=l*_-u*p,C=l*g-d*p,I=u*g-d*_;let O=x*I-M*C+f*v+w*S-T*E+b*z;return O?(O=1/O,t.m00=(m*I-o*C+h*v)*O,t.m01=(o*S-n*I-h*E)*O,t.m02=(n*C-m*S+h*z)*O,t.m03=0,t.m04=(r*C-i*I-a*v)*O,t.m05=(s*I-r*S+a*E)*O,t.m06=(i*S-s*C-a*z)*O,t.m07=0,t.m08=(p*b-_*T+g*w)*O,t.m09=(_*f-y*b-g*M)*O,t.m10=(y*T-p*f+g*x)*O,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t):null}static toArray(t,e,s=0){return t[s+0]=e.m00,t[s+1]=e.m01,t[s+2]=e.m02,t[s+3]=e.m03,t[s+4]=e.m04,t[s+5]=e.m05,t[s+6]=e.m06,t[s+7]=e.m07,t[s+8]=e.m08,t[s+9]=e.m09,t[s+10]=e.m10,t[s+11]=e.m11,t[s+12]=e.m12,t[s+13]=e.m13,t[s+14]=e.m14,t[s+15]=e.m15,t}static fromArray(t,e,s=0){return t.m00=e[s+0],t.m01=e[s+1],t.m02=e[s+2],t.m03=e[s+3],t.m04=e[s+4],t.m05=e[s+5],t.m06=e[s+6],t.m07=e[s+7],t.m08=e[s+8],t.m09=e[s+9],t.m10=e[s+10],t.m11=e[s+11],t.m12=e[s+12],t.m13=e[s+13],t.m14=e[s+14],t.m15=e[s+15],t}static add(t,e,s){return t.m00=e.m00+s.m00,t.m01=e.m01+s.m01,t.m02=e.m02+s.m02,t.m03=e.m03+s.m03,t.m04=e.m04+s.m04,t.m05=e.m05+s.m05,t.m06=e.m06+s.m06,t.m07=e.m07+s.m07,t.m08=e.m08+s.m08,t.m09=e.m09+s.m09,t.m10=e.m10+s.m10,t.m11=e.m11+s.m11,t.m12=e.m12+s.m12,t.m13=e.m13+s.m13,t.m14=e.m14+s.m14,t.m15=e.m15+s.m15,t}static subtract(t,e,s){return t.m00=e.m00-s.m00,t.m01=e.m01-s.m01,t.m02=e.m02-s.m02,t.m03=e.m03-s.m03,t.m04=e.m04-s.m04,t.m05=e.m05-s.m05,t.m06=e.m06-s.m06,t.m07=e.m07-s.m07,t.m08=e.m08-s.m08,t.m09=e.m09-s.m09,t.m10=e.m10-s.m10,t.m11=e.m11-s.m11,t.m12=e.m12-s.m12,t.m13=e.m13-s.m13,t.m14=e.m14-s.m14,t.m15=e.m15-s.m15,t}static multiplyScalar(t,e,s){return t.m00=e.m00*s,t.m01=e.m01*s,t.m02=e.m02*s,t.m03=e.m03*s,t.m04=e.m04*s,t.m05=e.m05*s,t.m06=e.m06*s,t.m07=e.m07*s,t.m08=e.m08*s,t.m09=e.m09*s,t.m10=e.m10*s,t.m11=e.m11*s,t.m12=e.m12*s,t.m13=e.m13*s,t.m14=e.m14*s,t.m15=e.m15*s,t}static multiplyScalarAndAdd(t,e,s,i){return t.m00=e.m00+s.m00*i,t.m01=e.m01+s.m01*i,t.m02=e.m02+s.m02*i,t.m03=e.m03+s.m03*i,t.m04=e.m04+s.m04*i,t.m05=e.m05+s.m05*i,t.m06=e.m06+s.m06*i,t.m07=e.m07+s.m07*i,t.m08=e.m08+s.m08*i,t.m09=e.m09+s.m09*i,t.m10=e.m10+s.m10*i,t.m11=e.m11+s.m11*i,t.m12=e.m12+s.m12*i,t.m13=e.m13+s.m13*i,t.m14=e.m14+s.m14*i,t.m15=e.m15+s.m15*i,t}static strictEquals(t,e){return t.m00===e.m00&&t.m01===e.m01&&t.m02===e.m02&&t.m03===e.m03&&t.m04===e.m04&&t.m05===e.m05&&t.m06===e.m06&&t.m07===e.m07&&t.m08===e.m08&&t.m09===e.m09&&t.m10===e.m10&&t.m11===e.m11&&t.m12===e.m12&&t.m13===e.m13&&t.m14===e.m14&&t.m15===e.m15}static equals(t,e,s=EPSILON){return Math.abs(t.m00-e.m00)<=s*Math.max(1,Math.abs(t.m00),Math.abs(e.m00))&&Math.abs(t.m01-e.m01)<=s*Math.max(1,Math.abs(t.m01),Math.abs(e.m01))&&Math.abs(t.m02-e.m02)<=s*Math.max(1,Math.abs(t.m02),Math.abs(e.m02))&&Math.abs(t.m03-e.m03)<=s*Math.max(1,Math.abs(t.m03),Math.abs(e.m03))&&Math.abs(t.m04-e.m04)<=s*Math.max(1,Math.abs(t.m04),Math.abs(e.m04))&&Math.abs(t.m05-e.m05)<=s*Math.max(1,Math.abs(t.m05),Math.abs(e.m05))&&Math.abs(t.m06-e.m06)<=s*Math.max(1,Math.abs(t.m06),Math.abs(e.m06))&&Math.abs(t.m07-e.m07)<=s*Math.max(1,Math.abs(t.m07),Math.abs(e.m07))&&Math.abs(t.m08-e.m08)<=s*Math.max(1,Math.abs(t.m08),Math.abs(e.m08))&&Math.abs(t.m09-e.m09)<=s*Math.max(1,Math.abs(t.m09),Math.abs(e.m09))&&Math.abs(t.m10-e.m10)<=s*Math.max(1,Math.abs(t.m10),Math.abs(e.m10))&&Math.abs(t.m11-e.m11)<=s*Math.max(1,Math.abs(t.m11),Math.abs(e.m11))&&Math.abs(t.m12-e.m12)<=s*Math.max(1,Math.abs(t.m12),Math.abs(e.m12))&&Math.abs(t.m13-e.m13)<=s*Math.max(1,Math.abs(t.m13),Math.abs(e.m13))&&Math.abs(t.m14-e.m14)<=s*Math.max(1,Math.abs(t.m14),Math.abs(e.m14))&&Math.abs(t.m15-e.m15)<=s*Math.max(1,Math.abs(t.m15),Math.abs(e.m15))}constructor(t=1,e=0,s=0,i=0,r=0,a=1,n=0,m=0,o=0,h=0,c=1,l=0,u=0,d=0,y=0,p=1){"object"==typeof t?(this.m00=t.m00,this.m01=t.m01,this.m02=t.m02,this.m03=t.m03,this.m04=t.m04,this.m05=t.m05,this.m06=t.m06,this.m07=t.m07,this.m08=t.m08,this.m09=t.m09,this.m10=t.m10,this.m11=t.m11,this.m12=t.m12,this.m13=t.m13,this.m14=t.m14,this.m15=t.m15):(this.m00=t,this.m01=e,this.m02=s,this.m03=i,this.m04=r,this.m05=a,this.m06=n,this.m07=m,this.m08=o,this.m09=h,this.m10=c,this.m11=l,this.m12=u,this.m13=d,this.m14=y,this.m15=p)}clone(){return new Mat4(this.m00,this.m01,this.m02,this.m03,this.m04,this.m05,this.m06,this.m07,this.m08,this.m09,this.m10,this.m11,this.m12,this.m13,this.m14,this.m15)}set(t=1,e=0,s=0,i=0,r=0,a=1,n=0,m=0,o=0,h=0,c=1,l=0,u=0,d=0,y=0,p=1){return"object"==typeof t?(this.m01=t.m01,this.m02=t.m02,this.m03=t.m03,this.m04=t.m04,this.m05=t.m05,this.m06=t.m06,this.m07=t.m07,this.m08=t.m08,this.m09=t.m09,this.m10=t.m10,this.m11=t.m11,this.m12=t.m12,this.m13=t.m13,this.m14=t.m14,this.m15=t.m15,this.m00=t.m00):(this.m01=e,this.m02=s,this.m03=i,this.m04=r,this.m05=a,this.m06=n,this.m07=m,this.m08=o,this.m09=h,this.m10=c,this.m11=l,this.m12=u,this.m13=d,this.m14=y,this.m15=p,this.m00=t),this}equals(t,e=EPSILON){return!(Math.abs(this.m00)===1/0||Math.abs(this.m01)===1/0||Math.abs(this.m02)===1/0||Math.abs(this.m03)===1/0||Math.abs(this.m04)===1/0||Math.abs(this.m05)===1/0||Math.abs(this.m06)===1/0||Math.abs(this.m07)===1/0||Math.abs(this.m08)===1/0||Math.abs(this.m09)===1/0||Math.abs(this.m10)===1/0||Math.abs(this.m11)===1/0||Math.abs(this.m12)===1/0||Math.abs(this.m13)===1/0||Math.abs(this.m14)===1/0||Math.abs(this.m15)===1/0)&&Math.abs(this.m00-t.m00)<=e*Math.max(1,Math.abs(this.m00),Math.abs(t.m00))&&Math.abs(this.m01-t.m01)<=e*Math.max(1,Math.abs(this.m01),Math.abs(t.m01))&&Math.abs(this.m02-t.m02)<=e*Math.max(1,Math.abs(this.m02),Math.abs(t.m02))&&Math.abs(this.m03-t.m03)<=e*Math.max(1,Math.abs(this.m03),Math.abs(t.m03))&&Math.abs(this.m04-t.m04)<=e*Math.max(1,Math.abs(this.m04),Math.abs(t.m04))&&Math.abs(this.m05-t.m05)<=e*Math.max(1,Math.abs(this.m05),Math.abs(t.m05))&&Math.abs(this.m06-t.m06)<=e*Math.max(1,Math.abs(this.m06),Math.abs(t.m06))&&Math.abs(this.m07-t.m07)<=e*Math.max(1,Math.abs(this.m07),Math.abs(t.m07))&&Math.abs(this.m08-t.m08)<=e*Math.max(1,Math.abs(this.m08),Math.abs(t.m08))&&Math.abs(this.m09-t.m09)<=e*Math.max(1,Math.abs(this.m09),Math.abs(t.m09))&&Math.abs(this.m10-t.m10)<=e*Math.max(1,Math.abs(this.m10),Math.abs(t.m10))&&Math.abs(this.m11-t.m11)<=e*Math.max(1,Math.abs(this.m11),Math.abs(t.m11))&&Math.abs(this.m12-t.m12)<=e*Math.max(1,Math.abs(this.m12),Math.abs(t.m12))&&Math.abs(this.m13-t.m13)<=e*Math.max(1,Math.abs(this.m13),Math.abs(t.m13))&&Math.abs(this.m14-t.m14)<=e*Math.max(1,Math.abs(this.m14),Math.abs(t.m14))&&Math.abs(this.m15-t.m15)<=e*Math.max(1,Math.abs(this.m15),Math.abs(t.m15))}strictEquals(t){return this.m00===t.m00&&this.m01===t.m01&&this.m02===t.m02&&this.m03===t.m03&&this.m04===t.m04&&this.m05===t.m05&&this.m06===t.m06&&this.m07===t.m07&&this.m08===t.m08&&this.m09===t.m09&&this.m10===t.m10&&this.m11===t.m11&&this.m12===t.m12&&this.m13===t.m13&&this.m14===t.m14&&this.m15===t.m15}toString(){return`[\n${this.m00}, ${this.m01}, ${this.m02}, ${this.m03},\n${this.m04}, ${this.m05}, ${this.m06}, ${this.m07},\n${this.m08}, ${this.m09}, ${this.m10}, ${this.m11},\n${this.m12}, ${this.m13}, ${this.m14}, ${this.m15}\n]`}identity(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=1,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=1,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this}zero(){return this.m00=0,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=0,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=0,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=0,this}transpose(){const t=this.m01,e=this.m02,s=this.m03,i=this.m06,r=this.m07,a=this.m11;return this.m01=this.m04,this.m02=this.m08,this.m03=this.m12,this.m04=t,this.m06=this.m09,this.m07=this.m13,this.m08=e,this.m09=i,this.m11=this.m14,this.m12=s,this.m13=r,this.m14=a,this}invert(){const t=this.m00,e=this.m01,s=this.m02,i=this.m03,r=this.m04,a=this.m05,n=this.m06,m=this.m07,o=this.m08,h=this.m09,c=this.m10,l=this.m11,u=this.m12,d=this.m13,y=this.m14,p=this.m15,_=t*a-e*r,g=t*n-s*r,x=t*m-i*r,M=e*n-s*a,f=e*m-i*a,w=s*m-i*n,T=o*d-h*u,b=o*y-c*u,z=o*p-l*u,E=h*y-c*d,S=h*p-l*d,v=c*p-l*y;let C=_*v-g*S+x*E+M*z-f*b+w*T;return 0===C?(this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this):(C=1/C,this.m00=(a*v-n*S+m*E)*C,this.m01=(s*S-e*v-i*E)*C,this.m02=(d*w-y*f+p*M)*C,this.m03=(c*f-h*w-l*M)*C,this.m04=(n*z-r*v-m*b)*C,this.m05=(t*v-s*z+i*b)*C,this.m06=(y*x-u*w-p*g)*C,this.m07=(o*w-c*x+l*g)*C,this.m08=(r*S-a*z+m*T)*C,this.m09=(e*z-t*S-i*T)*C,this.m10=(u*f-d*x+p*_)*C,this.m11=(h*x-o*f-l*_)*C,this.m12=(a*b-r*E-n*T)*C,this.m13=(t*E-e*b+s*T)*C,this.m14=(d*g-u*M-y*_)*C,this.m15=(o*M-h*g+c*_)*C,this)}determinant(){const t=this.m00,e=this.m01,s=this.m02,i=this.m03,r=this.m04,a=this.m05,n=this.m06,m=this.m07,o=this.m08,h=this.m09,c=this.m10,l=this.m11,u=this.m12,d=this.m13,y=this.m14,p=this.m15;return(t*a-e*r)*(c*p-l*y)-(t*n-s*r)*(h*p-l*d)+(t*m-i*r)*(h*y-c*d)+(e*n-s*a)*(o*p-l*u)-(e*m-i*a)*(o*y-c*u)+(s*m-i*n)*(o*d-h*u)}add(t){return this.m00+=t.m00,this.m01+=t.m01,this.m02+=t.m02,this.m03+=t.m03,this.m04+=t.m04,this.m05+=t.m05,this.m06+=t.m06,this.m07+=t.m07,this.m08+=t.m08,this.m09+=t.m09,this.m10+=t.m10,this.m11+=t.m11,this.m12+=t.m12,this.m13+=t.m13,this.m14+=t.m14,this.m15+=t.m15,this}subtract(t){return this.m00-=t.m00,this.m01-=t.m01,this.m02-=t.m02,this.m03-=t.m03,this.m04-=t.m04,this.m05-=t.m05,this.m06-=t.m06,this.m07-=t.m07,this.m08-=t.m08,this.m09-=t.m09,this.m10-=t.m10,this.m11-=t.m11,this.m12-=t.m12,this.m13-=t.m13,this.m14-=t.m14,this.m15-=t.m15,this}multiply(t){const e=this.m00,s=this.m01,i=this.m02,r=this.m03,a=this.m04,n=this.m05,m=this.m06,o=this.m07,h=this.m08,c=this.m09,l=this.m10,u=this.m11,d=this.m12,y=this.m13,p=this.m14,_=this.m15;let g=t.m00,x=t.m01,M=t.m02,f=t.m03;return this.m00=g*e+x*a+M*h+f*d,this.m01=g*s+x*n+M*c+f*y,this.m02=g*i+x*m+M*l+f*p,this.m03=g*r+x*o+M*u+f*_,g=t.m04,x=t.m05,M=t.m06,f=t.m07,this.m04=g*e+x*a+M*h+f*d,this.m05=g*s+x*n+M*c+f*y,this.m06=g*i+x*m+M*l+f*p,this.m07=g*r+x*o+M*u+f*_,g=t.m08,x=t.m09,M=t.m10,f=t.m11,this.m08=g*e+x*a+M*h+f*d,this.m09=g*s+x*n+M*c+f*y,this.m10=g*i+x*m+M*l+f*p,this.m11=g*r+x*o+M*u+f*_,g=t.m12,x=t.m13,M=t.m14,f=t.m15,this.m12=g*e+x*a+M*h+f*d,this.m13=g*s+x*n+M*c+f*y,this.m14=g*i+x*m+M*l+f*p,this.m15=g*r+x*o+M*u+f*_,this}multiplyScalar(t){return this.m00*=t,this.m01*=t,this.m02*=t,this.m03*=t,this.m04*=t,this.m05*=t,this.m06*=t,this.m07*=t,this.m08*=t,this.m09*=t,this.m10*=t,this.m11*=t,this.m12*=t,this.m13*=t,this.m14*=t,this.m15*=t,this}translate(t){return this.m12+=t.x,this.m13+=t.y,this.m14+=t.z,this}transform(t){const{x:e,y:s,z:i}=t,r=this.m00,a=this.m01,n=this.m02,m=this.m03,o=this.m04,h=this.m05,c=this.m06,l=this.m07,u=this.m08,d=this.m09,y=this.m10,p=this.m11;return this.m12=r*e+o*s+u*i+this.m12,this.m13=a*e+h*s+d*i+this.m13,this.m14=n*e+c*s+y*i+this.m14,this.m15=m*e+l*s+p*i+this.m15,this}scale(t){const e=t.x,s=t.y,i=t.z;return this.m00*=e,this.m01*=e,this.m02*=e,this.m03*=e,this.m04*=s,this.m05*=s,this.m06*=s,this.m07*=s,this.m08*=i,this.m09*=i,this.m10*=i,this.m11*=i,this}rotate(t,e){let s=e.x,i=e.y,r=e.z,a=Math.sqrt(s*s+i*i+r*r);if(Math.abs(a)<EPSILON)return null;a=1/a,s*=a,i*=a,r*=a;const n=Math.sin(t),m=Math.cos(t),o=1-m,h=this.m00,c=this.m01,l=this.m02,u=this.m03,d=this.m04,y=this.m05,p=this.m06,_=this.m07,g=this.m08,x=this.m09,M=this.m10,f=this.m11,w=s*s*o+m,T=i*s*o+r*n,b=r*s*o-i*n,z=s*i*o-r*n,E=i*i*o+m,S=r*i*o+s*n,v=s*r*o+i*n,C=i*r*o-s*n,I=r*r*o+m;return this.m00=h*w+d*T+g*b,this.m01=c*w+y*T+x*b,this.m02=l*w+p*T+M*b,this.m03=u*w+_*T+f*b,this.m04=h*z+d*E+g*S,this.m05=c*z+y*E+x*S,this.m06=l*z+p*E+M*S,this.m07=u*z+_*E+f*S,this.m08=h*v+d*C+g*I,this.m09=c*v+y*C+x*I,this.m10=l*v+p*C+M*I,this.m11=u*v+_*C+f*I,this}getTranslation(t){return t.x=this.m12,t.y=this.m13,t.z=this.m14,t}getScale(t){const e=m3_1.m00=this.m00,s=m3_1.m01=this.m01,i=m3_1.m02=this.m02,r=m3_1.m03=this.m04,a=m3_1.m04=this.m05,n=m3_1.m05=this.m06,m=m3_1.m06=this.m08,o=m3_1.m07=this.m09,h=m3_1.m08=this.m10;return t.x=Math.sqrt(e*e+s*s+i*i),t.y=Math.sqrt(r*r+a*a+n*n),t.z=Math.sqrt(m*m+o*o+h*h),Mat3.determinant(m3_1)<0&&(t.x*=-1),t}getRotation(t){const e=Vec3.set(v3_1,this.m00,this.m01,this.m02).length(),s=Vec3.set(v3_1,this.m04,this.m05,this.m06).length(),i=Vec3.set(v3_1,this.m08,this.m09,this.m10).length();m3_1.m00=this.m00/e,m3_1.m01=this.m01/e,m3_1.m02=this.m02/e,m3_1.m03=this.m04/s,m3_1.m04=this.m05/s,m3_1.m05=this.m06/s,m3_1.m06=this.m08/i,m3_1.m07=this.m09/i,m3_1.m08=this.m10/i;return Mat3.determinant(m3_1)<0&&(m3_1.m00*=-1,m3_1.m01*=-1,m3_1.m02*=-1),Quat.fromMat3(t,m3_1)}fromRTS(t,e,s){const i=t.x,r=t.y,a=t.z,n=t.w,m=i+i,o=r+r,h=a+a,c=i*m,l=i*o,u=i*h,d=r*o,y=r*h,p=a*h,_=n*m,g=n*o,x=n*h,M=s.x,f=s.y,w=s.z;return this.m00=(1-(d+p))*M,this.m01=(l+x)*M,this.m02=(u-g)*M,this.m03=0,this.m04=(l-x)*f,this.m05=(1-(c+p))*f,this.m06=(y+_)*f,this.m07=0,this.m08=(u+g)*w,this.m09=(y-_)*w,this.m10=(1-(c+d))*w,this.m11=0,this.m12=e.x,this.m13=e.y,this.m14=e.z,this.m15=1,this}fromSRT(t,e,s){const i=t.x,r=t.y,a=t.z,n=t.w,m=i+i,o=r+r,h=a+a,c=i*m,l=i*o,u=i*h,d=r*o,y=r*h,p=a*h,_=n*m,g=n*o,x=n*h,M=s.x,f=s.y,w=s.z;return this.m00=(1-(d+p))*M,this.m01=(l+x)*M,this.m02=(u-g)*M,this.m03=0,this.m04=(l-x)*f,this.m05=(1-(c+p))*f,this.m06=(y+_)*f,this.m07=0,this.m08=(u+g)*w,this.m09=(y-_)*w,this.m10=(1-(c+d))*w,this.m11=0,this.m12=e.x,this.m13=e.y,this.m14=e.z,this.m15=1,this}fromQuat(t){const e=t.x,s=t.y,i=t.z,r=t.w,a=e+e,n=s+s,m=i+i,o=e*a,h=s*a,c=s*n,l=i*a,u=i*n,d=i*m,y=r*a,p=r*n,_=r*m;return this.m00=1-c-d,this.m01=h+_,this.m02=l-p,this.m03=0,this.m04=h-_,this.m05=1-o-d,this.m06=u+y,this.m07=0,this.m08=l+p,this.m09=u-y,this.m10=1-o-c,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this}}Mat4.IDENTITY=Object.freeze(new Mat4);const v3_1=new Vec3,m3_1=new Mat3;function mat4(t,e,s,i,r,a,n,m,o,h,c,l,u,d,y,p){return new Mat4(t,e,s,i,r,a,n,m,o,h,c,l,u,d,y,p)}class AffineTransform{static identity(){return new AffineTransform}static clone(t){return new AffineTransform(t.a,t.b,t.c,t.d,t.tx,t.ty)}static concat(t,e,s){const i=e.a,r=e.b,a=e.c,n=e.d,m=e.tx,o=e.ty;t.a=i*s.a+r*s.c,t.b=i*s.b+r*s.d,t.c=a*s.a+n*s.c,t.d=a*s.b+n*s.d,t.tx=m*s.a+o*s.c+s.tx,t.ty=m*s.b+o*s.d+s.ty}static invert(t,e){const s=1/(e.a*e.d-e.b*e.c);t.a=s*e.d,t.b=-s*e.b,t.c=-s*e.c,t.d=s*e.a,t.tx=s*(e.c*e.ty-e.d*e.tx),t.ty=s*(e.b*e.tx-e.a*e.ty)}static fromMat4(t,e){t.a=e.m00,t.b=e.m01,t.c=e.m04,t.d=e.m05,t.tx=e.m12,t.ty=e.m13}static transformVec2(t,e,s,i){let r,a;i?(r=e,a=s):(i=s,r=e.x,a=e.y),t.x=i.a*r+i.c*a+i.tx,t.y=i.b*r+i.d*a+i.ty}static transformSize(t,e,s){t.width=s.a*e.width+s.c*e.height,t.height=s.b*e.width+s.d*e.height}static transformRect(t,e,s){const i=e.x+e.width,r=e.y+e.height,a=s.a*e.x+s.c*e.y+s.tx,n=s.b*e.x+s.d*e.y+s.ty,m=s.a*i+s.c*e.y+s.tx,o=s.b*i+s.d*e.y+s.ty,h=s.a*e.x+s.c*r+s.tx,c=s.b*e.x+s.d*r+s.ty,l=s.a*i+s.c*r+s.tx,u=s.b*i+s.d*r+s.ty,d=Math.min(a,m,h,l),y=Math.max(a,m,h,l),p=Math.min(n,o,c,u),_=Math.max(n,o,c,u);t.x=d,t.y=p,t.width=y-d,t.height=_-p}static transformObb(t,e,s,i,r,a,n=!0){const m=a.a*r.x+a.c*r.y+a.tx,o=a.b*r.x+a.d*r.y+a.ty,h=a.a*r.width,c=a.b*r.width,l=a.c*r.height,u=a.d*r.height;n?(e.x=m,e.y=o,s.x=h+m,s.y=c+o,t.x=l+m,t.y=u+o,i.x=h+l+m,i.y=c+u+o):(t.x=m,t.y=o,i.x=h+m,i.y=c+o,e.x=l+m,e.y=u+o,s.x=h+l+m,s.y=c+u+o)}constructor(t=1,e=0,s=0,i=1,r=0,a=0){this.a=t,this.b=e,this.c=s,this.d=i,this.tx=r,this.ty=a}}class Size{static lerp(t,e,s,i){return t.width=e.width+(s.width-e.width)*i,t.height=e.height+(s.height-e.height)*i,t}static equals(t,e){return t.width===e.width&&t.height===e.height}set x(t){this.width=t}get x(){return this.width}set y(t){this.height=t}get y(){return this.height}constructor(t,e){"object"==typeof t?(this.width=t.width,this.height=t.height):(this.width=t||0,this.height=e||0)}clone(){return new Size(this.width,this.height)}set(t,e){return"object"==typeof t?(this.height=t.height,this.width=t.width):(this.width=t||0,this.height=e||0),this}equals(t){return this.width===t.width&&this.height===t.height}lerp(t,e){return this.width+=(t.width-this.width)*e,this.height+=(t.height-this.height)*e,this}toString(){return`(${this.width.toFixed(2)}, ${this.height.toFixed(2)})`}}function size(t=0,e=0){return new Size(t,e)}Size.ZERO=Object.freeze(new Size(0,0)),Size.ONE=Object.freeze(new Size(1,1));class Rect{static fromMinMax(t,e,s){const i=Math.min(e.x,s.x),r=Math.min(e.y,s.y),a=Math.max(e.x,s.x),n=Math.max(e.y,s.y);return t.x=i,t.y=r,t.width=a-i,t.height=n-r,t}static lerp(t,e,s,i){const r=e.x,a=e.y,n=e.width,m=e.height;return t.x=r+(s.x-r)*i,t.y=a+(s.y-a)*i,t.width=n+(s.width-n)*i,t.height=m+(s.height-m)*i,t}static intersection(t,e,s){const i=e.x,r=e.y,a=e.x+e.width,n=e.y+e.height,m=s.x,o=s.y,h=s.x+s.width,c=s.y+s.height;return t.x=Math.max(i,m),t.y=Math.max(r,o),t.width=Math.min(a,h)-t.x,t.height=Math.min(n,c)-t.y,t}static union(t,e,s){const i=e.x,r=e.y,a=e.width,n=e.height,m=s.x,o=s.y,h=s.width,c=s.height;return t.x=Math.min(i,m),t.y=Math.min(r,o),t.width=Math.max(i+a,m+h)-t.x,t.height=Math.max(r+n,o+c)-t.y,t}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}get xMin(){return this.x}set xMin(t){this.width+=this.x-t,this.x=t}get yMin(){return this.y}set yMin(t){this.height+=this.y-t,this.y=t}get xMax(){return this.x+this.width}set xMax(t){this.width=t-this.x}get yMax(){return this.y+this.height}set yMax(t){this.height=t-this.y}get center(){return new Vec2(this.x+.5*this.width,this.y+.5*this.height)}set center(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height}get origin(){return new Vec2(this.x,this.y)}set origin(t){this.x=t.x,this.y=t.y}get size(){return new Size(this.width,this.height)}set size(t){this.width=t.width,this.height=t.height}set z(t){this.width=t}get z(){return this.width}set w(t){this.height=t}get w(){return this.height}constructor(t,e,s,i){"object"==typeof t?(this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height):(this.x=t||0,this.y=e||0,this.width=s||0,this.height=i||0)}clone(){return new Rect(this.x,this.y,this.width,this.height)}set(t,e,s,i){return"object"==typeof t?(this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height):(this.x=t||0,this.y=e||0,this.width=s||0,this.height=i||0),this}equals(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height}lerp(t,e){const s=this.x,i=this.y,r=this.width,a=this.height;return this.x=s+(t.x-s)*e,this.y=i+(t.y-i)*e,this.width=r+(t.width-r)*e,this.height=a+(t.height-a)*e,this}toString(){return`(${this.x.toFixed(2)}, ${this.y.toFixed(2)}, ${this.width.toFixed(2)}, ${this.height.toFixed(2)})`}intersects(t){const e=this.x+this.width,s=this.y+this.height,i=t.x+t.width,r=t.y+t.height;return!(e<t.x||i<this.x||s<t.y||r<this.y)}contains(t){return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y}containsRect(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height}transformMat4(t){const e=this.x,s=this.y,i=e+this.width,r=s+this.height,a=t.m00*e+t.m04*s+t.m12,n=t.m01*e+t.m05*s+t.m13,m=t.m00*i+t.m04*s+t.m12,o=t.m01*i+t.m05*s+t.m13,h=t.m00*e+t.m04*r+t.m12,c=t.m01*e+t.m05*r+t.m13,l=t.m00*i+t.m04*r+t.m12,u=t.m01*i+t.m05*r+t.m13,d=Math.min(a,m,h,l),y=Math.max(a,m,h,l),p=Math.min(n,o,c,u),_=Math.max(n,o,c,u);return this.x=d,this.y=p,this.width=y-d,this.height=_-p,this}transformMat4ToPoints(t,e,s,i,r){const a=this.x,n=this.y,m=a+this.width,o=n+this.height;e.x=t.m00*a+t.m04*n+t.m12,e.y=t.m01*a+t.m05*n+t.m13,r.x=t.m00*m+t.m04*n+t.m12,r.y=t.m01*m+t.m05*n+t.m13,s.x=t.m00*a+t.m04*o+t.m12,s.y=t.m01*a+t.m05*o+t.m13,i.x=t.m00*m+t.m04*o+t.m12,i.y=t.m01*m+t.m05*o+t.m13}}function rect(t=0,e=0,s=0,i=0){return new Rect(t,e,s,i)}const toFloat=1/255;class Color{static clone(t){const e=new Color;return t._val?e._val=t._val:e._val=(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r,e}static copy(t,e){return t.r=e.r,t.g=e.g,t.b=e.b,t.a=e.a,t}static set(t,e,s,i,r){return t.r=e,t.g=s,t.b=i,t.a=r,t}static toVec4(t,e){return(e=void 0!==e?e:new Vec4).x=t.r*toFloat,e.y=t.g*toFloat,e.z=t.b*toFloat,e.w=t.a*toFloat,e}static fromVec4(t,e){return(e=void 0===e?new Color:e).r=Math.floor(t.x/toFloat),e.g=Math.floor(t.y/toFloat),e.b=Math.floor(t.z/toFloat),e.a=Math.floor(t.w/toFloat),e}static fromHEX(t,e){e=0===e.indexOf("#")?e.substring(1):e,t.r=parseInt(e.substr(0,2),16)||0,t.g=parseInt(e.substr(2,2),16)||0,t.b=parseInt(e.substr(4,2),16)||0;const s=parseInt(e.substr(6,2),16);return t.a=Number.isNaN(s)?255:s,t._val=(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r,t}static add(t,e,s){return t.r=e.r+s.r,t.g=e.g+s.g,t.b=e.b+s.b,t.a=e.a+s.a,t}static subtract(t,e,s){return t.r=e.r-s.r,t.g=e.g-s.g,t.b=e.b-s.b,t.a=e.a-s.a,t}static multiply(t,e,s){return t.r=e.r*s.r,t.g=e.g*s.g,t.b=e.b*s.b,t.a=e.a*s.a,t}static divide(t,e,s){return t.r=e.r/s.r,t.g=e.g/s.g,t.b=e.b/s.b,t.a=e.a/s.a,t}static scale(t,e,s){return t.r=e.r*s,t.g=e.g*s,t.b=e.b*s,t.a=e.a*s,t}static lerp(t,e,s,i){let r=e.r,a=e.g,n=e.b,m=e.a;return r+=(s.r-r)*i,a+=(s.g-a)*i,n+=(s.b-n)*i,m+=(s.a-m)*i,t._val=Math.floor((m<<24>>>0)+(n<<16)+(a<<8)+r),t}static toArray(t,e,s=0){const i=e instanceof Color||e.a>1?1/255:1;return t[s+0]=e.r*i,t[s+1]=e.g*i,t[s+2]=e.b*i,t[s+3]=e.a*i,t}static fromArray(t,e,s=0){return e.r=255*t[s+0],e.g=255*t[s+1],e.b=255*t[s+2],e.a=255*t[s+3],e}static fromUint32(t,e){return t._val=e,t}static toUint32(t){return t._val}static strictEquals(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a}static equals(t,e,s=EPSILON){return!(Math.abs(t.r)===1/0||Math.abs(t.g)===1/0||Math.abs(t.b)===1/0||Math.abs(t.a)===1/0)&&Math.abs(t.r-e.r)<=s*Math.max(1,Math.abs(t.r),Math.abs(e.r))&&Math.abs(t.g-e.g)<=s*Math.max(1,Math.abs(t.g),Math.abs(e.g))&&Math.abs(t.b-e.b)<=s*Math.max(1,Math.abs(t.b),Math.abs(e.b))&&Math.abs(t.a-e.a)<=s*Math.max(1,Math.abs(t.a),Math.abs(e.a))}static hex(t){return(255*t.r<<24|255*t.g<<16|255*t.b<<8|255*t.a)>>>0}get r(){return 255&this._val}set r(t){t=~~clamp(t,0,255),this._val=(4294967040&this._val|t)>>>0}get g(){return(65280&this._val)>>8}set g(t){t=~~clamp(t,0,255),this._val=(4294902015&this._val|t<<8)>>>0}get b(){return(16711680&this._val)>>16}set b(t){t=~~clamp(t,0,255),this._val=(4278255615&this._val|t<<16)>>>0}get a(){return(4278190080&this._val)>>>24}set a(t){t=~~clamp(t,0,255),this._val=(16777215&this._val|t<<24)>>>0}get x(){return this.r*toFloat}set x(t){this.r=255*t}get y(){return this.g*toFloat}set y(t){this.g=255*t}get z(){return this.b*toFloat}set z(t){this.b=255*t}get w(){return this.a*toFloat}set w(t){this.a=255*t}constructor(t,e,s,i){this._val=0,"string"==typeof t?this.fromHEX(t):void 0!==e?this.set(t,e,s,i):this.set(t)}clone(){const t=new Color;return t._val=this._val,t}equals(t){return t&&this._val===t._val}lerp(t,e){let s=this.r,i=this.g,r=this.b,a=this.a;return s+=(t.r-s)*e,i+=(t.g-i)*e,r+=(t.b-r)*e,a+=(t.a-a)*e,this._val=Math.floor((a<<24>>>0)+(r<<16)+(i<<8)+s),this}toString(){return`rgba(${this.r.toFixed()}, ${this.g.toFixed()}, ${this.b.toFixed()}, ${this.a.toFixed()})`}toCSS(t="rgba"){return"rgba"===t?`rgba(${this.r},${this.g},${this.b},${(this.a*toFloat).toFixed(2)})`:"rgb"===t?`rgb(${this.r},${this.g},${this.b})`:`#${this.toHEX(t)}`}fromHEX(t){t=0===t.indexOf("#")?t.substring(1):t;const e=parseInt(t.substr(0,2),16)||0,s=parseInt(t.substr(2,2),16)||0,i=parseInt(t.substr(4,2),16)||0;let r=parseInt(t.substr(6,2),16);return r=Number.isNaN(r)?255:r,this._val=(r<<24>>>0)+(i<<16)+(s<<8)+(0|e),this}toHEX(t="#rrggbb"){const e="0",s=[(this.r<16?e:"")+this.r.toString(16),(this.g<16?e:"")+this.g.toString(16),(this.b<16?e:"")+this.b.toString(16)];return"#rgb"===t?(s[0]=s[0][0],s[1]=s[1][0],s[2]=s[2][0]):"#rrggbbaa"===t&&s.push((this.a<16?e:"")+this.a.toString(16)),s.join("")}toRGBValue(){return 16777215&this._val}fromHSV(t,e,s){let i=0,r=0,a=0;if(0===e)i=r=a=s;else if(0===s)i=r=a=0;else{1===t&&(t=0),t*=6;const n=Math.floor(t),m=t-n,o=s*(1-e),h=s*(1-e*m),c=s*(1-e*(1-m));switch(n){default:case 0:i=s,r=c,a=o;break;case 1:i=h,r=s,a=o;break;case 2:i=o,r=s,a=c;break;case 3:i=o,r=h,a=s;break;case 4:i=c,r=o,a=s;break;case 5:i=s,r=o,a=h}}return i*=255,r*=255,a*=255,this._val=(this.a<<24>>>0)+(a<<16)+(r<<8)+(0|i),this}toHSV(){const t=this.r*toFloat,e=this.g*toFloat,s=this.b*toFloat,i={h:0,s:0,v:0},r=Math.max(t,e,s),a=Math.min(t,e,s);let n=0;return i.v=r,i.s=r?(r-a)/r:0,i.s?(n=r-a,i.h=t===r?(e-s)/n:e===r?2+(s-t)/n:4+(t-e)/n,i.h/=6,i.h<0&&(i.h+=1)):i.h=0,i}set(t,e,s,i){return"object"==typeof t?null!=t._val?this._val=t._val:(e=t.g||0,s=t.b||0,i="number"==typeof t.a?t.a:255,t=t.r||0,this._val=(i<<24>>>0)+(s<<16)+(e<<8)+(0|t)):(t=t||0,e=e||0,s=s||0,i="number"==typeof i?i:255,this._val=(i<<24>>>0)+(s<<16)+(e<<8)+(0|t)),this}multiply(t){const e=(255&this._val)*t.r>>8,s=(65280&this._val)*t.g>>8,i=(16711680&this._val)*t.b>>8,r=((4278190080&this._val)>>>8)*t.a;return this._val=4278190080&r|16711680&i|65280&s|255&e,this}_set_r_unsafe(t){return this._val=(4294967040&this._val|t)>>>0,this}_set_g_unsafe(t){return this._val=(4294902015&this._val|t<<8)>>>0,this}_set_b_unsafe(t){return this._val=(4278255615&this._val|t<<16)>>>0,this}_set_a_unsafe(t){return this._val=(16777215&this._val|t<<24)>>>0,this}}function color(t,e,s,i){return new Color(t,e,s,i)}Color.WHITE=Object.freeze(new Color(255,255,255,255)),Color.GRAY=Object.freeze(new Color(127,127,127,255)),Color.BLACK=Object.freeze(new Color(0,0,0,255)),Color.TRANSPARENT=Object.freeze(new Color(0,0,0,0)),Color.RED=Object.freeze(new Color(255,0,0,255)),Color.GREEN=Object.freeze(new Color(0,255,0,255)),Color.BLUE=Object.freeze(new Color(0,0,255,255)),Color.CYAN=Object.freeze(new Color(0,255,255,255)),Color.MAGENTA=Object.freeze(new Color(255,0,255,255)),Color.YELLOW=Object.freeze(new Color(255,255,0,255));class AssetInfo{init(t,e){const s=(e=this.parseLocation(t,e)).split("/");let i="";for(let t=1;t<s.length;t++)i+=s[t],t!=s.length-1&&(i+="/");this.bundleName=s[0],this.assetPath=i,this.assetType=t,this.uuid=`${e}.${t.name}`}parseLocation(t,e){return t==SpriteFrame?e.endsWith("spriteFrame")||(e+="/spriteFrame"):t==Texture2D&&(e.endsWith("texture")||(e+="/texture")),e}}class AssetSystem{constructor(){this._waitLoads=[],this._loadingSet=new Set,this._frameAddCount=0}update(){this._frameAddCount=0,this.updateLoadingSet()}addProvider(t){this._waitLoads.push(t),this.updateLoadingSet()}updateLoadingSet(){if(this._frameAddCount>=AssetSystem._frameMaxAddQueueProvider)return;if(this._loadingSet.size>=AssetSystem._maxLoadingProvider)return;if(0==this._waitLoads.length)return;const t=this._waitLoads.shift();this._loadingSet.add(t),t.internalLoad()}removeProvider(t){this._loadingSet.delete(t),this.updateLoadingSet()}}AssetSystem._maxLoadingProvider=1,AssetSystem._frameMaxAddQueueProvider=1;const MoyeAssetTag="MoyeAsset";class AssetOperationHandle{constructor(){this.isDisposed=!1}getAsset(t){return this.provider.asset}dispose(){this.isDisposed?coreError("MoyeAsset","重复销毁AssetOperationHandle"):(this.isDisposed=!0,this.provider.releaseHandle(this))}instantiateSync(){return instantiate(this.provider.asset)}async instantiateAsync(){return instantiate(this.provider.asset)}}class BundleAssetProvider{constructor(){this.refCount=0,this._handleSet=new Set}async internalLoad(){const t=this.assetInfo.assetPath,e=this.assetInfo.assetType;this.bundleAsset.bundle.load(t,e,((t,e)=>{t?coreError("MoyeAsset","加载资源错误:{0},{1}",this.assetInfo.uuid,t):this.asset=e,this._task.setResult(),this.assetSystem.removeProvider(this)}))}async load(){this._task=Task.create(),this.assetSystem.addProvider(this),await this._task}createHandle(){this.refCount++;const t=new AssetOperationHandle;return t.provider=this,this._handleSet.add(t),t}releaseHandle(t){this.refCount<=0&&coreWarn("MoyeAsset","Asset provider reference count is already zero. There may be resource leaks !"),0==this._handleSet.delete(t)&&coreError("MoyeAsset","Should never get here !"),this.refCount--}}var AssetLockType;!function(t){t.BUNDLE_ASSET_LOAD="bundle_asset_load",t.BUNDLE_LOAD="bundle_load"}(AssetLockType||(AssetLockType={}));class BundleAsset{constructor(){this.refCount=0,this.isAutoRelease=!0,this._providerMap=new Map}async loadAssetAsync(t){let e=this._providerMap.get(t.uuid);e||(e=await this.createProvider(t));return e.createHandle()}async createProvider(t){const e=await CoroutineLock.get().wait(AssetLockType.BUNDLE_ASSET_LOAD,t.uuid);try{let e=this._providerMap.get(t.uuid);return e||(e=new BundleAssetProvider,e.assetInfo=t,e.assetSystem=this.assetSystem,e.bundleAsset=this,this.refCount++,await e.load(),this._providerMap.set(t.uuid,e),e)}finally{e.dispose()}}unloadUnusedAssets(){for(const[t,e]of this._providerMap)0==e.refCount&&(this.bundle.release(e.assetInfo.assetPath,e.assetInfo.assetType),this._providerMap.delete(t),this.refCount--)}}class MoyeAssets extends Singleton{awake(){MoyeAssets.assetSystem=new AssetSystem}update(){MoyeAssets.assetSystem.update()}static async loadAssetAsync(t,e){try{const s=new AssetInfo;s.init(t,e);const i=s.bundleName;let r=MoyeAssets._bundleMap.get(i);r||(r=await this.loadBundleAsync(i));return await r.loadAssetAsync(s)}catch(t){coreError("MoyeAsset",t)}}static async loadBundleAsync(t){const e=await CoroutineLock.get().wait(AssetLockType.BUNDLE_LOAD,t);try{let e=MoyeAssets._bundleMap.get(t);if(e)return e;const s=Task.create();if(!this._bundlePathMap.has(t)&&(this._bundlePathMap.set(t,t),NATIVE)){const e=`${native.fileUtils.getWritablePath()}hot/${t}`;native.fileUtils.isDirectoryExist(e)&&this._bundlePathMap.set(t,e)}const i=this._bundlePathMap.get(t);coreLog("MoyeAsset","加载bundle: {0}",i),assetManager.loadBundle(i,((e,i)=>{e?coreLog("MoyeAsset","加载Bundle错误, bundle={0}, error={1}",t,e):coreLog("MoyeAsset","加载Bundle完成, bundle={0}",t),s.setResult(i)}));const r=await s;return e=new BundleAsset,e.bundle=r,e.bundleName=t,e.assetSystem=MoyeAssets.assetSystem,MoyeAssets._bundleMap.set(t,e),e}finally{e.dispose()}}static releaseBundle(t){0==t.refCount?(this._bundleMap.delete(t.bundleName),assetManager.removeBundle(t.bundle),coreLog("MoyeAsset","卸载bundle:{0}",t.bundleName)):coreError("MoyeAsset","释放的bundle:{0}, 引用计数不为0",t.bundleName)}static unloadUnusedAssets(){for(const[t,e]of this._bundleMap)e.unloadUnusedAssets(),0==e.refCount&&e.isAutoRelease&&MoyeAssets.releaseBundle(e)}}MoyeAssets._bundleMap=new Map,MoyeAssets._bundlePathMap=new Map;var __decorate$5=function(t,e,s,i){var r,a=arguments.length,n=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,s,i);else for(var m=t.length-1;m>=0;m--)(r=t[m])&&(n=(a<3?r(n):a>3?r(e,s,n):r(e,s))||n);return a>3&&n&&Object.defineProperty(e,s,n),n};let AfterProgramInitHandler=class extends AEventHandler{run(t,e){Game.addSingleton(MoyeAssets)}};AfterProgramInitHandler=__decorate$5([EventDecorator(AfterProgramInit,SceneType.NONE)],AfterProgramInitHandler);class AsyncButtonListener{constructor(t){this._callback=t}async invoke(...t){this._isClick||(this._isClick=!0,await this._callback(...t),this._isClick=!1)}static create(t){const e=new AsyncButtonListener(t);return e.invoke.bind(e)}}const ViewDecoratorType="ViewDecorator";function ViewDecorator(t,e,s){return function(i){DecoratorCollector.inst.add("ViewDecorator",i,t,e,s)}}var ViewLayer;!function(t){t[t.SCENE=1]="SCENE",t[t.BACKGROUND=2]="BACKGROUND",t[t.NORMAL=3]="NORMAL",t[t.INFO=4]="INFO",t[t.TIPS=5]="TIPS",t[t.TOP=6]="TOP"}(ViewLayer||(ViewLayer={}));class ViewCleanCom extends Entity{constructor(){super(...arguments),this._views=new Set}init(t){return this._viewMgr=t,this}add(t){this._views.add(t)}remove(t){this._views.delete(t)}destroy(){for(const t of this._views)this._viewMgr.hide(t)}}const MoyeViewTag="MoyeView",viewLoadLock="MoyeViewLoadLock";class MoyeViewMgr extends Entity{constructor(){super(...arguments),this._views=new Map,this._type2Names=new Map,this._showingViews=new Set,this._hideViews=new Set,this._viewCfgs=new Map,this._layers=new Map,this._checkInterval=5e3}awake(){MoyeViewMgr.inst=this}destroy(){null!=this._checkTimerId&&(TimerMgr.get().remove(this._checkTimerId),this._checkTimerId=null),MoyeViewMgr.inst=null}init(t,e){return null!=this._uiRoot?coreError("MoyeView","MoyeViewMgr is already inited"):(this._uiRoot=t,this._globalViewCfgType=e,this.reload(),this._checkTimerId=TimerMgr.get().newRepeatedTimer(this._checkInterval,this.check.bind(this)),this)}async show(t,e){let s;if(s="string"==typeof t?t:this._type2Names.get(t),JsHelper.isNullOrEmpty(s))return void coreError("MoyeView","MoyeView name is null or empty, name={0}",s);const i=await CoroutineLock.get().wait(viewLoadLock,s);coreLog("MoyeView","show view, name={0}",s);try{if(null==this._uiRoot)throw new Error("MoyeViewMgr is not inited");if(this._showingViews.has(s)){return this._views.get(s)}if(this._views.has(s)){const t=this._views.get(s);return await this.enterViewShow(t,e),t}const t=this._viewCfgs.get(s),i=await t.load(s),r=this.getLayerNode(t.layer);i.parent=r;const a=this.addCom(t.viewType);return a.node=i,a.layer=t.layer,a.viewName=s,a.onLoad?.(),a._viewMgr=this,this._views.set(s,a),await this.enterViewShow(a,e),a}catch(t){coreError("MoyeView","show view errr, {0}",t)}finally{i.dispose()}}async hide(t){const e=await CoroutineLock.get().wait(viewLoadLock,t);coreLog("MoyeView","hide view, name={0}",t);try{if(!this._showingViews.has(t))return;const e=this._views.get(t);await this.enterViewHide(e)}catch(t){coreError("MoyeView","hide view errr, {0}",t)}finally{e.dispose()}}reload(){const t=DecoratorCollector.inst.get("ViewDecorator");for(const e of t){const t=e[0],s=e[1],i=e[2],r=e[3];if(this._viewCfgs.has(s))continue;let a;a=null!=r?new r:new this._globalViewCfgType,a.layer=i,a.name=s,a.viewType=t,a.cleanEntitys=new Set,this._type2Names.set(t,s),this._viewCfgs.set(s,a)}}check(){const t=TimeInfo.get().clientNow();for(const e of this._hideViews){t>=this._viewCfgs.get(e).expireTime&&this.enterViewDestroy(this._views.get(e))}}getLayerNode(t){let e=this._layers.get(t);if(null==e){e=new Node,e.name=ViewLayer[t],e.parent=this._uiRoot,e.setSiblingIndex(t),this._layers.set(t,e);const s=this._uiRoot.getComponent(UITransform).contentSize;e.addComponent(UITransform).setContentSize(s)}return e}addToCleanCom(t,e){if(null==t)return;let s=t.getCom(ViewCleanCom);const i=this._viewCfgs.get(e);null==s&&(s=t.addCom(ViewCleanCom).init(this)),i.cleanEntitys.add(s),s.add(e)}async enterViewShow(t,e){t.node.active=!0,t.bringToFront();const s=this._viewCfgs.get(t.viewName);if(null!=s.doShowAnimation){const e=Task.create();s.doShowAnimation(t,e),await e}this._showingViews.add(t.viewName),this._hideViews.delete(t.viewName),this.addToCleanCom(e,t.viewName),t.onShow?.()}async enterViewHide(t){const e=this._viewCfgs.get(t.viewName);if(null!=e.doHideAnimation){const s=Task.create();e.doHideAnimation(t,s),await s}t.onHide?.(),t.node.active=!1,this._hideViews.add(t.viewName),this._showingViews.delete(t.viewName);for(const s of e.cleanEntitys)s.remove(t.viewName);e.cleanEntitys.clear(),e.expireTime=TimeInfo.get().clientNow()+e.expire}enterViewDestroy(t){t._realDispose(),t.node.destroy(),this._views.delete(t.viewName),this._hideViews.delete(t.viewName);this._viewCfgs.get(t.viewName).destroy()}}class AMoyeView extends Entity{_realDispose(){super.dispose()}dispose(){this._viewMgr.hide(this.viewName)}bringToFront(){this.node.setSiblingIndex(-1)}}var __decorate$4=function(t,e,s,i){var r,a=arguments.length,n=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,s,i);else for(var m=t.length-1;m>=0;m--)(r=t[m])&&(n=(a<3?r(n):a>3?r(e,s,n):r(e,s))||n);return a>3&&n&&Object.defineProperty(e,s,n),n};const{ccclass:ccclass$4,property:property$4,menu:menu$4}=_decorator;let SizeFollow=class extends Component{constructor(){super(...arguments),this._heightFollow=!0,this._widthFollow=!0,this._heightOffset=0,this._widthOffset=0,this._changeSize=new Size$1}get target(){return this._target}set target(t){this._target=t,this.updateSizeOffset()}set heightFollow(t){this._heightFollow=t,this.updateSizeOffset()}get heightFollow(){return this._heightFollow}set widthFollow(t){this._widthFollow=t,this.updateSizeOffset()}get widthFollow(){return this._widthFollow}onLoad(){null!=this._target&&this._target.node.on(NodeEventType.SIZE_CHANGED,this.onTargetSizeChange,this)}onDestroy(){null!=this._target&&(this._target.isValid?(this._target.node.off(NodeEventType.SIZE_CHANGED,this.onTargetSizeChange,this),this._target=null):this._target=null)}onTargetSizeChange(){const t=this.node.getComponent(UITransform),e=this._target;this._changeSize.set(t.contentSize),this._widthFollow&&(this._changeSize.width=Math.max(0,e.width+this._widthOffset)),this._heightFollow&&(this._changeSize.height=Math.max(0,e.height+this._heightOffset)),t.setContentSize(this._changeSize)}updateSizeOffset(){if(null==this._target)return;const t=this.node.getComponent(UITransform),e=this._target;if(this._widthFollow){const s=t.width,i=e.width;this._widthOffset=s-i}if(this._heightFollow){const s=t.height,i=e.height;this._heightOffset=s-i}}};__decorate$4([property$4({type:UITransform})],SizeFollow.prototype,"target",null),__decorate$4([property$4({type:UITransform})],SizeFollow.prototype,"_target",void 0),__decorate$4([property$4],SizeFollow.prototype,"heightFollow",null),__decorate$4([property$4],SizeFollow.prototype,"_heightFollow",void 0),__decorate$4([property$4],SizeFollow.prototype,"widthFollow",null),__decorate$4([property$4],SizeFollow.prototype,"_widthFollow",void 0),__decorate$4([property$4({type:CCFloat})],SizeFollow.prototype,"_heightOffset",void 0),__decorate$4([property$4({type:CCFloat})],SizeFollow.prototype,"_widthOffset",void 0),SizeFollow=__decorate$4([ccclass$4("SizeFollow"),menu$4("moye/SizeFollow")],SizeFollow);var __decorate$3=function(t,e,s,i){var r,a=arguments.length,n=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,s,i);else for(var m=t.length-1;m>=0;m--)(r=t[m])&&(n=(a<3?r(n):a>3?r(e,s,n):r(e,s))||n);return a>3&&n&&Object.defineProperty(e,s,n),n};const{ccclass:ccclass$3,property:property$3,executeInEditMode:executeInEditMode,menu:menu$3}=_decorator;var WidgetBase,WidgetDirection;!function(t){t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM"}(WidgetBase||(WidgetBase={})),function(t){t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.LEFT_EXTEND=5]="LEFT_EXTEND",t[t.RIGHT_EXTEND=6]="RIGHT_EXTEND",t[t.TOP_EXTEND=7]="TOP_EXTEND",t[t.BOTTOM_EXTEND=8]="BOTTOM_EXTEND"}(WidgetDirection||(WidgetDirection={}));let CTWidget=class extends Component{constructor(){super(...arguments),this._targetDir=WidgetDirection.TOP,this._dir=WidgetDirection.TOP,this.visibleOffset=0,this._isVertical=!0,this._distance=0,this._changePos=new Vec3$1(0,0,0),this._targetOldPos=new Vec3$1(0,0,0),this._targetOldSize=0,this._selfOldPos=new Vec3$1(0,0,0),this._selfOldSize=0}get target(){return this._target}set target(t){this._target=t,this.unregisterEvt(),this.registerEvt(),this.updateData()}set targetDir(t){if(EDITOR){if(t==WidgetDirection.LEFT||t==WidgetDirection.RIGHT){switch(this._dir){case WidgetDirection.TOP:case WidgetDirection.TOP_EXTEND:case WidgetDirection.BOTTOM:case WidgetDirection.BOTTOM_EXTEND:this._dir=WidgetDirection.LEFT}this._isVertical=!1}else{switch(this._dir){case WidgetDirection.LEFT:case WidgetDirection.LEFT_EXTEND:case WidgetDirection.RIGHT:case WidgetDirection.RIGHT_EXTEND:this._dir=WidgetDirection.TOP}this._isVertical=!0}this._targetDir=t,this.updateData()}}get targetDir(){return this._targetDir}set dir(t){if(EDITOR){switch(t){case WidgetDirection.LEFT:case WidgetDirection.LEFT_EXTEND:case WidgetDirection.RIGHT:case WidgetDirection.RIGHT_EXTEND:switch(this._targetDir){case WidgetDirection.TOP:case WidgetDirection.BOTTOM:this._targetDir=WidgetDirection.LEFT}this._isVertical=!1;break;case WidgetDirection.TOP:case WidgetDirection.TOP_EXTEND:case WidgetDirection.BOTTOM:case WidgetDirection.BOTTOM_EXTEND:switch(this._targetDir){case WidgetDirection.LEFT:case WidgetDirection.RIGHT:this._targetDir=WidgetDirection.TOP}this._isVertical=!0}this._dir=t,this.updateData()}}get dir(){return this._dir}onEnable(){EDITOR&&(this.registerEvt(),this.updateData())}onDisable(){EDITOR&&this.unregisterEvt()}onLoad(){this._trans=this.node.getComponent(UITransform),EDITOR||this.registerEvt()}onDestroy(){EDITOR||(this.unregisterEvt(),this._trans=null,this._target=null,this._changePos=null)}registerEvt(){this._target&&(EDITOR&&(this._target.node.on(NodeEventType.ANCHOR_CHANGED,this.updateData,this),this.node.on(NodeEventType.TRANSFORM_CHANGED,this.updateData,this),this.node.on(NodeEventType.SIZE_CHANGED,this.updateData,this)),this._target.node.on(NodeEventType.SIZE_CHANGED,this.onTargetChange,this),this._target.node.on(NodeEventType.TRANSFORM_CHANGED,this.onTargetChange,this),this._target.node.on(NodeEventType.ACTIVE_IN_HIERARCHY_CHANGED,this.onTargetChange,this))}unregisterEvt(){this._target&&this._target.isValid&&(EDITOR&&(this._target.node.off(NodeEventType.ANCHOR_CHANGED,this.updateData,this),this.node.off(NodeEventType.TRANSFORM_CHANGED,this.updateData,this),this.node.off(NodeEventType.SIZE_CHANGED,this.updateData,this)),this._target.node.off(NodeEventType.SIZE_CHANGED,this.onTargetChange,this),this._target.node.off(NodeEventType.TRANSFORM_CHANGED,this.onTargetChange,this),this._target.node.off(NodeEventType.ACTIVE_IN_HIERARCHY_CHANGED,this.onTargetChange,this))}updateData(){if(null!=this._target)switch(this._dir){case WidgetDirection.TOP:case WidgetDirection.BOTTOM:case WidgetDirection.LEFT:case WidgetDirection.RIGHT:this.updateDistance();break;case WidgetDirection.TOP_EXTEND:case WidgetDirection.BOTTOM_EXTEND:case WidgetDirection.LEFT_EXTEND:case WidgetDirection.RIGHT_EXTEND:this.updateTargetPos()}}onTargetChange(){if(null!=this._target)switch(this._dir){case WidgetDirection.TOP:case WidgetDirection.BOTTOM:case WidgetDirection.LEFT:case WidgetDirection.RIGHT:this.updatePos();break;case WidgetDirection.TOP_EXTEND:case WidgetDirection.BOTTOM_EXTEND:case WidgetDirection.LEFT_EXTEND:case WidgetDirection.RIGHT_EXTEND:this.updateSize()}}updateSize(){if(this._isVertical){const t=this._targetOldPos.y-this._target.node.position.y;let e=this._target.height-this._targetOldSize;const s=this._trans.anchorY;this._changePos.set(this._selfOldPos),this._target.getComponent(Label)&&!this._target.node.active&&(e=this._targetOldSize);const i=t+e;this._trans.height=this._selfOldSize+i,this._dir==WidgetDirection.TOP_EXTEND?this.node.setPosition(this._changePos):this._dir==WidgetDirection.BOTTOM_EXTEND&&(this._changePos.y-=i*(1-s),this.node.setPosition(v3$1(this._changePos)))}}updatePos(){const t=this._trans,e=this._target;let s=this.getPos(e,this._targetDir)-this._distance;if(this._changePos.set(this.node.worldPosition),this._isVertical){switch(this._dir){case WidgetDirection.TOP:s-=t.height*(1-t.anchorY);break;case WidgetDirection.BOTTOM:s+=t.height*t.anchorY;break}this._changePos.y=s}else this._changePos.x=s;this.node.worldPosition=this._changePos}updateTargetPos(){EDITOR&&null==this._changePos&&(console.error("编辑器数据错乱, 请重新添加本组件"),this._changePos=v3$1()),this.target.node.getPosition(this._targetOldPos),this.node.getPosition(this._selfOldPos),this._isVertical?(this._selfOldSize=this._trans.height,this._targetOldSize=this._target.height):(this._selfOldSize=this._trans.width,this._targetOldSize=this._target.height)}updateDistance(){if(!EDITOR)return;if(null==this._target)return;const t=this.node.getComponent(UITransform),e=this._target,s=this.getPos(t,this._dir),i=this.getPos(e,this._targetDir);this._distance=i-s}getPos(t,e){if(this._isVertical){let s=t.node.worldPosition.y;const i=t.height,r=t.anchorY;switch(e){case WidgetDirection.TOP:case WidgetDirection.TOP_EXTEND:return t.node.active||(s=s-i-this.visibleOffset),s+i*(1-r);case WidgetDirection.BOTTOM:case WidgetDirection.BOTTOM_EXTEND:return t.node.active||(s=s+i+this.visibleOffset),s-i*r}}else{const s=t.node.worldPosition.x,i=t.width,r=t.anchorX;switch(e){case WidgetDirection.LEFT:return s-i*r;case WidgetDirection.RIGHT:return s+i*(1-r)}}}};__decorate$3([property$3({type:UITransform})],CTWidget.prototype,"target",null),__decorate$3([property$3({type:UITransform})],CTWidget.prototype,"_target",void 0),__decorate$3([property$3({type:Enum(WidgetBase)})],CTWidget.prototype,"targetDir",null),__decorate$3([property$3],CTWidget.prototype,"_targetDir",void 0),__decorate$3([property$3({type:Enum(WidgetDirection)})],CTWidget.prototype,"dir",null),__decorate$3([property$3],CTWidget.prototype,"_dir",void 0),__decorate$3([property$3({type:CCFloat})],CTWidget.prototype,"visibleOffset",void 0),__decorate$3([property$3],CTWidget.prototype,"_isVertical",void 0),__decorate$3([property$3],CTWidget.prototype,"_distance",void 0),__decorate$3([property$3],CTWidget.prototype,"_changePos",void 0),__decorate$3([property$3],CTWidget.prototype,"_targetOldPos",void 0),__decorate$3([property$3],CTWidget.prototype,"_targetOldSize",void 0),__decorate$3([property$3],CTWidget.prototype,"_selfOldPos",void 0),__decorate$3([property$3],CTWidget.prototype,"_selfOldSize",void 0),CTWidget=__decorate$3([ccclass$3("CTWidget"),menu$3("moye/CTWidget"),executeInEditMode],CTWidget);const RoundBoxAssembler={GetIndexBuffer(t){const e=[0,1,2,2,3,0,4,5,6,6,7,4,8,9,10,10,11,8];let s=12;const i=function(i,r,a){let n=r;for(let r=0;r<t.segments-1;r++){const t=s;s++,e.push(i,n,t),n=t}e.push(i,n,a)};return t.leftBottom&&i(3,4,0),t.leftTop&&i(2,1,5),t.rightTop&&i(9,6,10),t.rightBottom&&i(8,11,7),e},createData(t){const e=t.requestRenderData();let s=0;s+=t.leftBottom?1:0,s+=t.leftTop?1:0,s+=t.rightTop?1:0,s+=t.rightBottom?1:0;const i=12+(t.segments-1)*s;e.dataLength=i,e.resize(i,18+3*t.segments*s);const r=RoundBoxAssembler.GetIndexBuffer(t);return e.chunk.setIndexBuffer(r),e},updateRenderData(t){const e=t.spriteFrame;dynamicAtlasManager.packToDynamicAtlas(t,e),this.updateUVs(t);const s=t.renderData;s&&e&&(s.vertDirty&&this.updateVertexData(t),s.updateRenderData(t,e))},updateWorldVerts(t,e){const s=t.renderData,i=e.vb,r=s.data,a=t.node.worldMatrix,n=s.floatStride;let m=0;const o=r.length;for(let t=0;t<o;t++){const e=r[t],s=e.x,o=e.y;let h=a.m03*s+a.m07*o+a.m15;h=h?1/h:1,m=t*n,i[m+0]=(a.m00*s+a.m04*o+a.m12)*h,i[m+1]=(a.m01*s+a.m05*o+a.m13)*h,i[m+2]=(a.m02*s+a.m06*o+a.m14)*h}},fillBuffers(t){if(null===t)return;const e=t.renderData,s=e.chunk;(t.node.hasChangedFlags||e.vertDirty)&&(this.updateWorldVerts(t,s),e.vertDirty=!1),s.bufferId;const i=s.vertexOffset,r=s.meshBuffer,a=s.meshBuffer.iData;let n=r.indexOffset;const m=i,o=RoundBoxAssembler.GetIndexBuffer(t);for(let t=0;t<e.indexCount;t++)a[n++]=m+o[t];r.indexOffset+=e.indexCount},updateVertexData(t){const e=t.renderData;if(!e)return;const s=t.node._uiProps.uiTransformComp,i=e.data,r=s.width,a=s.height,n=s.anchorX*r,m=s.anchorY*a,o=0-n,h=r-n,c=a-m,l=0-m,u=o+t.radius,d=l+t.radius,y=c-t.radius,p=h-t.radius;i[0].x=o,i[0].y=t.leftBottom?d:l,i[1].x=o,i[1].y=t.leftTop?y:c,i[2].x=u,i[2].y=t.leftTop?y:c,i[3].x=u,i[3].y=t.leftBottom?d:l,i[4].x=u,i[4].y=l,i[5].x=u,i[5].y=c,i[6].x=p,i[6].y=c,i[7].x=p,i[7].y=l,i[8].x=p,i[8].y=t.rightBottom?d:l,i[9].x=p,i[9].y=t.rightTop?y:c,i[10].x=h,i[10].y=t.rightTop?y:c,i[11].x=h,i[11].y=t.rightBottom?d:l;let _=12;const g=function(e,s){for(let r=1;r<t.segments;r++){const a=s*Math.PI/180-r/t.segments*.5*Math.PI;i[_].x=e.x+Math.cos(a)*t.radius,i[_].y=e.y+Math.sin(a)*t.radius,_++}};t.leftBottom&&g(i[3],270),t.leftTop&&g(i[2],180),t.rightTop&&g(i[9],90),t.rightBottom&&g(i[8],0),e.vertDirty=!0},updateUVs(t){if(!t.spriteFrame)return;const e=t.renderData,s=e.chunk.vb,i=t.spriteFrame.uv,r=i[0],a=i[1],n=i[2],m=i[5],o=Math.abs(n-r),h=m-a,c=t.node._uiProps.uiTransformComp,l=e.data,u=c.width,d=c.height,y=c.anchorX*u,p=c.anchorY*d;for(let t=0;t<e.dataLength;t++)s[t*e.floatStride+3]=r+(l[t].x+y)/u*o,s[t*e.floatStride+4]=a+(l[t].y+p)/d*h},updateColor(t){const e=t.renderData,s=e.chunk.vb;let i=5;const r=t.color,a=r.r/255,n=r.g/255,m=r.b/255,o=r.a/255;for(let t=0;t<e.dataLength;t++,i+=e.floatStride)s[i]=a,s[i+1]=n,s[i+2]=m,s[i+3]=o}};var __decorate$2=function(t,e,s,i){var r,a=arguments.length,n=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,s,i);else for(var m=t.length-1;m>=0;m--)(r=t[m])&&(n=(a<3?r(n):a>3?r(e,s,n):r(e,s))||n);return a>3&&n&&Object.defineProperty(e,s,n),n};const{ccclass:ccclass$2,property:property$2,type:type,menu:menu$2}=_decorator;var EventType;!function(t){t.SPRITE_FRAME_CHANGED="spriteframe-changed"}(EventType||(EventType={}));let RoundBoxSprite=class extends UIRenderer{constructor(){super(...arguments),this._sizeMode=Sprite.SizeMode.TRIMMED,this._atlas=null,this._segments=10,this._radius=20,this._spriteFrame=null,this._leftTop=!0,this._rightTop=!0,this._leftBottom=!0,this._rightBottom=!0}get sizeMode(){return this._sizeMode}set sizeMode(t){this._sizeMode!==t&&(this._sizeMode=t,t!==Sprite.SizeMode.CUSTOM&&this._applySpriteSize())}get spriteAtlas(){return this._atlas}set spriteAtlas(t){this._atlas!==t&&(this._atlas=t)}get segments(){return this._segments}set segments(t){this._segments=t,this._renderData=null,this._flushAssembler()}get radius(){return this._radius}set radius(t){this._radius=t,this._updateUVs(),this.markForUpdateRenderData(!0)}get spriteFrame(){return this._spriteFrame}set spriteFrame(t){if(this._spriteFrame===t)return;const e=this._spriteFrame;this._spriteFrame=t,this.markForUpdateRenderData(),this._applySpriteFrame(e),EDITOR&&this.node.emit(EventType.SPRITE_FRAME_CHANGED,this)}get leftTop(){return this._leftTop}set leftTop(t){this._leftTop=t,this.resetAssembler()}get rightTop(){return this._rightTop}set rightTop(t){this._rightTop=t,this.resetAssembler()}get leftBottom(){return this._leftBottom}set leftBottom(t){this._leftBottom=t,this.resetAssembler()}get rightBottom(){return this._rightBottom}set rightBottom(t){this._rightBottom=t,this.resetAssembler()}onLoad(){this._flushAssembler()}__preload(){this.changeMaterialForDefine(),super.__preload(),EDITOR&&(this._resized(),this.node.on(NodeEventType.SIZE_CHANGED,this._resized,this))}onEnable(){super.onEnable(),this._activateMaterial();this._spriteFrame&&this._updateUVs()}onDestroy(){EDITOR&&this.node.off(NodeEventType.SIZE_CHANGED,this._resized,this),super.onDestroy()}changeSpriteFrameFromAtlas(t){if(!this._atlas)return void console.warn("SpriteAtlas is null.");const e=this._atlas.getSpriteFrame(t);this.spriteFrame=e}changeMaterialForDefine(){let t;const e=this._instanceMaterialType;this._spriteFrame&&(t=this._spriteFrame.texture);let s=!1;if(t instanceof cclegacy.TextureBase){const e=t.getPixelFormat();s=e===cclegacy.TextureBase.PixelFormat.RGBA_ETC1||e===cclegacy.TextureBase.PixelFormat.RGB_A_PVRTC_4BPPV1||e===cclegacy.TextureBase.PixelFormat.RGB_A_PVRTC_2BPPV1}this._instanceMaterialType=s?InstanceMaterialType.USE_ALPHA_SEPARATED:InstanceMaterialType.ADD_COLOR_AND_TEXTURE,e!==this._instanceMaterialType&&this.updateMaterial()}_updateBuiltinMaterial(){let t=super._updateBuiltinMaterial();if(this.spriteFrame&&this.spriteFrame.texture instanceof RenderTexture){const e={SAMPLE_FROM_RT:!0,...t.passes[0].defines},s=new Material;s.initialize({effectAsset:t.effectAsset,defines:e}),t=s}return t}_render(t){t.commitComp(this,this.renderData,this._spriteFrame,this._assembler,null)}_canRender(){if(!super._canRender())return!1;const t=this._spriteFrame;return!(!t||!t.texture)}resetAssembler(){this._assembler=null,this._flushAssembler()}_flushAssembler(){const t=RoundBoxAssembler;this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.getRenderMaterial(0),this.markForUpdateRenderData(),this.spriteFrame&&this._assembler.updateRenderData(this),this._updateColor())}_applySpriteSize(){if(this._spriteFrame){if(BUILD||!this._spriteFrame)if(Sprite.SizeMode.RAW===this._sizeMode){const t=this._spriteFrame.originalSize;this.node._uiProps.uiTransformComp.setContentSize(t)}else if(Sprite.SizeMode.TRIMMED===this._sizeMode){const t=this._spriteFrame.rect;this.node._uiProps.uiTransformComp.setContentSize(t.width,t.height)}this.markForUpdateRenderData(!0),this._assembler.updateRenderData(this)}}_resized(){if(EDITOR&&this._spriteFrame){const t=this.node._uiProps.uiTransformComp.contentSize;let e=t.width,s=t.height;if(this._sizeMode===Sprite.SizeMode.RAW){const t=this._spriteFrame.originalSize;e=t.width,s=t.height}else if(this._sizeMode===Sprite.SizeMode.TRIMMED){const t=this._spriteFrame.rect;e=t.width,s=t.height}e===t.width&&s===t.height||(this._sizeMode=Sprite.SizeMode.CUSTOM)}}_activateMaterial(){const t=this._spriteFrame,e=this.getRenderMaterial(0);t&&e&&this.markForUpdateRenderData(),this.renderData&&(this.renderData.material=e)}_updateUVs(){this._assembler&&this._assembler.updateUVs(this)}_applySpriteFrame(t){const e=this._spriteFrame;let s=!1;e&&(t&&t.texture===e.texture||(s=!0),s&&(this.renderData&&(this.renderData.textureDirty=!0),this.changeMaterialForDefine()),this._applySpriteSize())}};__decorate$2([property$2({serializable:!0})],RoundBoxSprite.prototype,"_sizeMode",void 0),__decorate$2([type(Sprite.SizeMode)],RoundBoxSprite.prototype,"sizeMode",null),__decorate$2([property$2({serializable:!0})],RoundBoxSprite.prototype,"_atlas",void 0),__decorate$2([type(SpriteAtlas)],RoundBoxSprite.prototype,"spriteAtlas",null),__decorate$2([property$2({type:CCInteger,serializable:!0})],RoundBoxSprite.prototype,"_segments",void 0),__decorate$2([property$2({type:CCInteger,serializable:!0,min:1})],RoundBoxSprite.prototype,"segments",null),__decorate$2([property$2({type:CCFloat,serializable:!0})],RoundBoxSprite.prototype,"_radius",void 0),__decorate$2([property$2({type:CCFloat,serializable:!0,min:0})],RoundBoxSprite.prototype,"radius",null),__decorate$2([property$2({serializable:!0})],RoundBoxSprite.prototype,"_spriteFrame",void 0),__decorate$2([type(SpriteFrame)],RoundBoxSprite.prototype,"spriteFrame",null),__decorate$2([property$2({serializable:!0})],RoundBoxSprite.prototype,"_leftTop",void 0),__decorate$2([property$2({serializable:!0})],RoundBoxSprite.prototype,"leftTop",null),__decorate$2([property$2({serializable:!0})],RoundBoxSprite.prototype,"_rightTop",void 0),__decorate$2([property$2({serializable:!0})],RoundBoxSprite.prototype,"rightTop",null),__decorate$2([property$2({serializable:!0})],RoundBoxSprite.prototype,"_leftBottom",void 0),__decorate$2([property$2({serializable:!0})],RoundBoxSprite.prototype,"leftBottom",null),__decorate$2([property$2({serializable:!0})],RoundBoxSprite.prototype,"_rightBottom",void 0),__decorate$2([property$2({serializable:!0})],RoundBoxSprite.prototype,"rightBottom",null),RoundBoxSprite=__decorate$2([ccclass$2("RoundBoxSprite"),menu$2("moye/RoundBoxSprite")],RoundBoxSprite);var __decorate$1=function(t,e,s,i){var r,a=arguments.length,n=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,s,i);else for(var m=t.length-1;m>=0;m--)(r=t[m])&&(n=(a<3?r(n):a>3?r(e,s,n):r(e,s))||n);return a>3&&n&&Object.defineProperty(e,s,n),n};const{ccclass:ccclass$1,property:property$1,menu:menu$1}=_decorator,instance=new EventTarget,SET_JOYSTICK_TYPE="SET_JOYSTICK_TYPE";var DirectionType,SpeedType,JoystickType;!function(t){t[t.FOUR=0]="FOUR",t[t.EIGHT=1]="EIGHT",t[t.ALL=2]="ALL"}(DirectionType||(DirectionType={})),function(t){t[t.STOP=0]="STOP",t[t.NORMAL=1]="NORMAL",t[t.FAST=2]="FAST"}(SpeedType||(SpeedType={})),function(t){t[t.FIXED=0]="FIXED",t[t.FOLLOW=1]="FOLLOW"}(JoystickType||(JoystickType={}));let YYJJoystick=class extends Component{constructor(){super(...arguments),this.dot=null,this.ring=null,this.joystickType=JoystickType.FIXED,this.directionType=DirectionType.ALL,this._stickPos=new Vec3$1,this._touchLocation=new Vec2$1,this.radius=50}onLoad(){if(!this.dot)return void console.warn("Joystick Dot is null!");if(!this.ring)return void console.warn("Joystick Ring is null!");const t=this.ring.getComponent(UITransform),e=2*this.radius,s=new Size$1(e,e);t?.setContentSize(s),this.ring.getChildByName("bg").getComponent(UITransform)?.setContentSize(s),this._initTouchEvent();const i=this.node.getComponent(UIOpacity);this.joystickType===JoystickType.FOLLOW&&i&&(i.opacity=0)}onEnable(){instance.on(SET_JOYSTICK_TYPE,this._onSetJoystickType,this)}onDisable(){instance.off(SET_JOYSTICK_TYPE,this._onSetJoystickType,this)}_onSetJoystickType(t){this.joystickType=t;const e=this.node.getComponent(UIOpacity);e&&(e.opacity=t===JoystickType.FIXED?255:0)}_initTouchEvent(){this.node.on(Input.EventType.TOUCH_START,this._touchStartEvent,this),this.node.on(Input.EventType.TOUCH_MOVE,this._touchMoveEvent,this),this.node.on(Input.EventType.TOUCH_END,this._touchEndEvent,this),this.node.on(Input.EventType.TOUCH_CANCEL,this._touchEndEvent,this)}_touchStartEvent(t){if(!this.ring||!this.dot)return;instance.emit(Input.EventType.TOUCH_START,t);const e=t.getUILocation(),s=new Vec3$1(e.x,e.y);if(this.joystickType===JoystickType.FIXED){this._stickPos=this.ring.getPosition();const t=s.subtract(this.ring.getPosition()),e=t.length();this.radius>e&&this.dot.setPosition(t)}else this.joystickType===JoystickType.FOLLOW&&(this._stickPos=s,this.node.getComponent(UIOpacity).opacity=255,this._touchLocation=t.getUILocation(),this.ring.setPosition(s),this.dot.setPosition(new Vec3$1))}_touchMoveEvent(t){if(!this.dot||!this.ring)return;if(this.joystickType===JoystickType.FOLLOW&&this._touchLocation===t.getUILocation())return!1;const e=t.getUILocation(),s=new Vec3$1(e.x,e.y).subtract(this.ring.getPosition()),i=s.length();let r=SpeedType.NORMAL;this.radius>i?(this.dot.setPosition(s),r=SpeedType.NORMAL):(this.dot.setPosition(s.normalize().multiplyScalar(this.radius)),r=SpeedType.FAST),instance.emit(Input.EventType.TOUCH_MOVE,t,{speedType:r,moveVec:s.normalize()})}_touchEndEvent(t){this.dot&&this.ring&&(this.dot.setPosition(new Vec3$1),this.joystickType===JoystickType.FOLLOW&&(this.node.getComponent(UIOpacity).opacity=0),instance.emit(Input.EventType.TOUCH_END,t,{speedType:SpeedType.STOP}))}};__decorate$1([property$1({type:Node,displayName:"Dot",tooltip:"摇杆操纵点"})],YYJJoystick.prototype,"dot",void 0),__decorate$1([property$1({type:Node,displayName:"Ring",tooltip:"摇杆背景节点"})],YYJJoystick.prototype,"ring",void 0),__decorate$1([property$1({type:Enum(JoystickType),displayName:"Touch Type",tooltip:"触摸类型"})],YYJJoystick.prototype,"joystickType",void 0),__decorate$1([property$1({type:Enum(DirectionType),displayName:"Direction Type",tooltip:"方向类型"})],YYJJoystick.prototype,"directionType",void 0),__decorate$1([property$1({type:Vec3$1,tooltip:"摇杆所在位置"})],YYJJoystick.prototype,"_stickPos",void 0),__decorate$1([property$1({type:Vec2$1,tooltip:"触摸位置"})],YYJJoystick.prototype,"_touchLocation",void 0),__decorate$1([property$1({type:CCInteger,displayName:"Ring Radius",tooltip:"半径"})],YYJJoystick.prototype,"radius",void 0),YYJJoystick=__decorate$1([ccclass$1("YYJJoystick"),menu$1("moye/YYJJoystick")],YYJJoystick);class YYJJoystickCom extends Entity{constructor(){super(...arguments),this.moveDir=new Vec3$1(0,1,0),this._speedType=SpeedType.STOP,this._moveSpeed=0,this.stopSpeed=0,this.normalSpeed=100,this.fastSpeed=200,this.isRotation=!0}init(t){return this._entity=t,instance.on(Input.EventType.TOUCH_START,this.onTouchStart,this),instance.on(Input.EventType.TOUCH_MOVE,this.onTouchMove,this),instance.on(Input.EventType.TOUCH_END,this.onTouchEnd,this),this}destroy(){instance.off(Input.EventType.TOUCH_START,this.onTouchStart,this),instance.off(Input.EventType.TOUCH_MOVE,this.onTouchMove,this),instance.off(Input.EventType.TOUCH_END,this.onTouchEnd,this)}onTouchStart(){}onTouchMove(t,e){const s=this._speedType;this._speedType=e.speedType,this.moveDir=e.moveVec,this.onSetMoveSpeed(this._speedType),s!==this._speedType&&this._entity.speedChange(this._speedType,this._moveSpeed)}onTouchEnd(t,e){const s=this._speedType;this._speedType=e.speedType,this.onSetMoveSpeed(this._speedType),s!==this._speedType&&this._entity.speedChange(this._speedType,this._moveSpeed)}onSetMoveSpeed(t){switch(t){case SpeedType.STOP:this._moveSpeed=this.stopSpeed;break;case SpeedType.NORMAL:this._moveSpeed=this.normalSpeed;break;case SpeedType.FAST:this._moveSpeed=this.fastSpeed}}move(){this.isRotation&&this._entity.setAngle(misc.radiansToDegrees(Math.atan2(this.moveDir.y,this.moveDir.x))-90);const t=this._entity.getPos().add(this.moveDir.clone().multiplyScalar(this._moveSpeed/60));this._entity.setPos(t)}update(){this._speedType!==SpeedType.STOP&&this.move()}}var __decorate=function(t,e,s,i){var r,a=arguments.length,n=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,s,i);else for(var m=t.length-1;m>=0;m--)(r=t[m])&&(n=(a<3?r(n):a>3?r(e,s,n):r(e,s))||n);return a>3&&n&&Object.defineProperty(e,s,n),n};const{ccclass:ccclass,property:property,menu:menu}=_decorator;let YYJJoystickPlayer=class extends Component{constructor(){super(...arguments),this.rigidbody=!1,this.moveDir=new Vec3$1(0,1,0),this._speedType=SpeedType.STOP,this._moveSpeed=0,this.stopSpeed=0,this.normalSpeed=100,this.fastSpeed=200,this.isRotation=!0,this._body=null}onLoad(){this.rigidbody&&(this._body=this.node.getComponent(RigidBody2D)),instance.on(Input.EventType.TOUCH_START,this.onTouchStart,this),instance.on(Input.EventType.TOUCH_MOVE,this.onTouchMove,this),instance.on(Input.EventType.TOUCH_END,this.onTouchEnd,this)}onTouchStart(){}onTouchMove(t,e){this._speedType=e.speedType,this.moveDir=e.moveVec,this.onSetMoveSpeed(this._speedType)}onTouchEnd(t,e){this._speedType=e.speedType,this.onSetMoveSpeed(this._speedType)}onSetMoveSpeed(t){switch(t){case SpeedType.STOP:this._moveSpeed=this.stopSpeed;break;case SpeedType.NORMAL:this._moveSpeed=this.normalSpeed;break;case SpeedType.FAST:this._moveSpeed=this.fastSpeed}}move(){if(this.isRotation&&(this.node.angle=misc.radiansToDegrees(Math.atan2(this.moveDir.y,this.moveDir.x))-90),this.rigidbody&&this._body){const t=this.moveDir.clone().multiplyScalar(this._moveSpeed/20),e=new Vec2$1(t.x,t.y);this._body.applyForceToCenter(e,!0)}else{const t=this.node.getPosition().add(this.moveDir.clone().multiplyScalar(this._moveSpeed/60));this.node.setPosition(t)}}update(t){this._speedType!==SpeedType.STOP&&this.move()}};__decorate([property({displayName:"刚体模式",tooltip:"不会立即停止"})],YYJJoystickPlayer.prototype,"rigidbody",void 0),__decorate([property({displayName:"Move Dir",tooltip:"移动方向"})],YYJJoystickPlayer.prototype,"moveDir",void 0),__decorate([property({tooltip:"速度级别"})],YYJJoystickPlayer.prototype,"_speedType",void 0),__decorate([property({type:CCInteger,tooltip:"移动速度"})],YYJJoystickPlayer.prototype,"_moveSpeed",void 0),__decorate([property({type:CCInteger,tooltip:"停止时速度"})],YYJJoystickPlayer.prototype,"stopSpeed",void 0),__decorate([property({type:CCInteger,tooltip:"正常速度"})],YYJJoystickPlayer.prototype,"normalSpeed",void 0),__decorate([property({type:CCInteger,tooltip:"最快速度"})],YYJJoystickPlayer.prototype,"fastSpeed",void 0),__decorate([property({type:CCBoolean,tooltip:"最快速度"})],YYJJoystickPlayer.prototype,"isRotation",void 0),YYJJoystickPlayer=__decorate([ccclass("YYJJoystickPlayer"),menu("moye/YYJJoystickPlayer")],YYJJoystickPlayer);export{AEvent,AEventHandler,AMoyeView,AffineTransform,AfterCreateClientScene,AfterCreateCurrentScene,AfterProgramInit,AfterProgramStart,AfterSingletonAdd,AssetOperationHandle,AsyncButtonListener,BeforeProgramInit,BeforeProgramStart,BeforeSingletonAdd,BundleAsset,CTWidget,CancellationToken,CancellationTokenTag,Color,CoroutineLock,CoroutineLockItem,CoroutineLockTag,DecoratorCollector,DirectionType,EPSILON,Entity,EntityCenter,EventCom,EventDecorator,EventDecoratorType,EventHandlerTag,EventSystem,Game,HALF_PI,IdGenerator,IdStruct,InstanceIdStruct,JoystickType,JsHelper,Logger,Mat3,Mat4,MoyeAssets,MoyeViewMgr,ObjectPool,Options,Program,Quat,Rect,RecycleObj,Root,RoundBoxSprite,SET_JOYSTICK_TYPE,Scene,SceneFactory,SceneRefCom,SceneType,Singleton,Size,SizeFollow,SpeedType,TWO_PI,Task,TimeHelper,TimeInfo,TimerMgr,Vec2,Vec3,Vec4,ViewDecorator,ViewDecoratorType,ViewLayer,YYJJoystick,YYJJoystickCom,absMax,absMaxComponent,approx,bits,clamp,clamp01,color,enumerableProps,equals,error,floatToHalf,halfToFloat,instance,inverseLerp,lerp,log,mat4,nextPow2,pingPong,preTransforms,pseudoRandom,pseudoRandomRange,pseudoRandomRangeInt,quat,random,randomRange,randomRangeInt,rect,repeat,safeCall,setRandGenerator,size,toDegree,toRadian,v2,v3,v4,warn};