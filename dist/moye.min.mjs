import{_decorator,Component,director,UITransform,CCFloat,Size,NodeEventType,Enum,Vec3,Label,v3,dynamicAtlasManager,Sprite,SpriteAtlas,CCInteger,SpriteFrame,UIRenderer,cclegacy,InstanceMaterialType,RenderTexture,Material}from"cc";import{EDITOR,BUILD}from"cc/env";class Singleton{constructor(){this._isDisposed=!1}static getInst(){const t=this;if(null==t._inst)throw new Error(`Singleton is not initialized or destroyed, name is ${t.name}`);return t._inst}get isDisposed(){return this._isDisposed}dispose(){this._onPreDestroy()}_onPreDestroy(){this._isDisposed||(this.destroy&&this.destroy(),Singleton._inst=null,this._isDisposed=!0)}}class ObjectPool extends Singleton{constructor(){super(...arguments),this._pool=new Map}fetch(t){const e=this._pool.get(t);return e?0===e.length?new t:e.shift():new t}recycle(t){const e=t.constructor;let i=this._pool.get(e);i||(i=[],this._pool.set(e,i)),i.length>1e3?console.warn(`pool ${e.name} is too large`):i.push(t)}}class RecycleObj{constructor(){this._isRecycle=!1}static create(t){const e=ObjectPool.getInst().fetch(this);return t&&Object.assign(e,t),e._isRecycle=!0,e}dispose(){this._isRecycle&&ObjectPool.getInst().recycle(this)}}class JsHelper{static getMethodName(){const t=(new Error).stack.split("at ")[2],e=t.indexOf(" ");return t.substring(0,e)}static getRootDirName(t){return t.split("/")[0]}static sleep(t){return new Promise((e=>setTimeout(e,t)))}static isNullOrEmpty(t){return null==t||(0==t.length||void 0)}static getStringHashCode(t){let e=5381,i=t.length;for(;i;)e=33*e^t.charCodeAt(--i);return e>>>0}static modeString(t,e){return this.getStringHashCode(t)%e}static formatStr(t,...e){if("string"!=typeof t){const t=new Error("formatStr args[0] is not string");return t.name+t.stack}if(0==e.length)return t;return t.replace(/\{\{|\}\}|\{(\d+)\}/g,(function(t,i){return"{{"==t?"{":"}}"==t?"}":e[i]}))}}class Options extends Singleton{constructor(){super(...arguments),this.isServer=!1,this.logLevel=1,this.develop=!0}}class LoggerDefault{log(t){console.log(t)}warn(t){console.warn(t)}error(t){console.error(t)}}class Logger extends Singleton{set iLog(t){this._logInst=t}get _iLog(){return this._logInst||(this._logInst=new LoggerDefault,this._logInst.warn("not set iLog, use default logger")),this._logInst}log(t,...e){if(this.checkLogLevel(Logger.LOG_LEVEL)){const i=JsHelper.formatStr(t,...e);this._iLog.log(i)}}warn(t,...e){if(this.checkLogLevel(Logger.WARN_LEVEL)){const i=JsHelper.formatStr(t,...e);this._iLog.warn(i)}}error(t,...e){const i=JsHelper.formatStr(t,...e),r=new Error,s=JsHelper.formatStr("{0}, stack: {1}",i,r.stack);this._iLog.error(s)}checkLogLevel(t){return Options.getInst().logLevel<=t}coreLog(t,...e){const i=JsHelper.formatStr(t,...e);this._iLog.log(i)}coreWarn(t,...e){const i=JsHelper.formatStr(t,...e);this._iLog.warn(i)}coreError(t,...e){const i=JsHelper.formatStr(t,...e),r=new Error,s=JsHelper.formatStr("{0}, stack: {1}",i,r.stack);this._iLog.error(s)}}function log(t,...e){Logger.getInst().log(t,...e)}function warn(t,...e){Logger.getInst().warn(t,...e)}function error(t,...e){Logger.getInst().error(t,...e)}Logger.LOG_LEVEL=1,Logger.WARN_LEVEL=2;class TimeInfo extends Singleton{awake(){this.serverMinusClientTime=0}clientNow(){return Date.now()}serverNow(){return this.clientNow()+this.serverMinusClientTime}}function coreWarn(t,...e){const i=`[core]: ${JsHelper.formatStr(t,...e)}`;try{Logger.getInst().coreWarn(i)}catch(t){console.warn(i)}}function coreError(t,...e){const i=`[core]: ${JsHelper.formatStr(t,...e)}`;try{Logger.getInst().coreError(i)}catch(t){console.error(i)}}const timeBit$1=30n,processBit=14n,valueBit$1=20n,powTimeBit$1=2n**timeBit$1-1n,powProcessBit=2n**processBit-1n,powValueBit$1=2n**valueBit$1-1n,epoch$1=new Date(2023,4,1).getTime();class IdStruct{static get inst(){return null==IdStruct._inst&&(IdStruct._inst=new IdStruct),IdStruct._inst}static generate(){0==this._lastTime&&(this._lastTime=this.timeSinceEpoch(),this._lastTime<=0&&(coreWarn(`${(new this).constructor.name}: lastTime less than 0: ${this._lastTime}`),this._lastTime=1));const t=this.timeSinceEpoch();t>this._lastTime?(this._lastTime=t,this._idCount=0):(++this._idCount,this._idCount>powValueBit$1&&(++this._lastTime,this._idCount=0,coreError(`${(new this).constructor.name}: idCount per sec overflow: ${t} ${this._lastTime}`)));const e=IdStruct.inst;return e.init(this._lastTime,1,this._idCount),e.result}static convertToId(t,e,i){return IdStruct.inst.init(t,e,i).result}static parseId(t){return IdStruct.inst.initById(t)}static timeSinceEpoch(){const t=(TimeInfo.getInst().clientNow()-epoch$1)/1e3;return Math.floor(t)}initById(t){return this.result=t,this.time=t&powTimeBit$1,t>>=timeBit$1,this.process=t&powProcessBit,t>>=processBit,this.value=t&powValueBit$1,this}init(t,e,i){return this.time=BigInt(t),this.process=BigInt(e),this.value=BigInt(i),this.updateResult(),this}updateResult(){this.result=this.value,this.result<<=processBit,this.result|=this.process,this.result<<=timeBit$1,this.result|=this.time}}IdStruct._lastTime=0,IdStruct._idCount=0;const timeBit=32n,valueBit=32n,powTimeBit=2n**timeBit-1n,powValueBit=2n**valueBit-1n,epoch=new Date(2023,4,1).getTime();class InstanceIdStruct{static get inst(){return null==InstanceIdStruct._inst&&(InstanceIdStruct._inst=new InstanceIdStruct),InstanceIdStruct._inst}static generate(){0==this._lastTime&&(this._lastTime=this.timeSinceEpoch(),this._lastTime<=0&&(coreWarn(`${(new this).constructor.name}: lastTime less than 0: ${this._lastTime}`),this._lastTime=1));const t=this.timeSinceEpoch();t>this._lastTime?(this._lastTime=t,this._idCount=0):(++this._idCount,this._idCount>powValueBit&&(++this._lastTime,this._idCount=0,coreError(`${(new this).constructor.name}: idCount per sec overflow: ${t} ${this._lastTime}`)));const e=InstanceIdStruct.inst;return e.init(this._lastTime,this._idCount),e.result}static convertToId(t,e){return InstanceIdStruct.inst.init(t,e).result}static parseId(t){return InstanceIdStruct.inst.initById(t)}static timeSinceEpoch(){const t=(TimeInfo.getInst().clientNow()-epoch)/1e3;return Math.floor(t)}initById(t){return this.result=t,this.time=t&powTimeBit,t>>=timeBit,this.value=t&powValueBit,this}init(t,e){return this.time=BigInt(t),this.value=BigInt(e),this.updateResult(),this}updateResult(){this.result=this.value,this.result<<=timeBit,this.result|=this.time}}InstanceIdStruct._lastTime=0,InstanceIdStruct._idCount=0;class IdGenerator extends Singleton{generateInstanceId(){return InstanceIdStruct.generate()}generateId(){return IdStruct.generate()}}class AEvent extends RecycleObj{}class BeforeSingletonAdd extends AEvent{}class AfterSingletonAdd extends AEvent{}class BeforeProgramInit extends AEvent{}class AfterProgramInit extends AEvent{}class BeforeProgramStart extends AEvent{}class AfterProgramStart extends AEvent{}class DecoratorCollector{constructor(){this._decorators=new Map}static get inst(){return null==DecoratorCollector._inst&&(DecoratorCollector._inst=new DecoratorCollector),DecoratorCollector._inst}add(t,...e){let i=this._decorators.get(t);i||(i=[],this._decorators.set(t,i)),i.push(e)}get(t){return this._decorators.get(t)||[]}}const EventDecoratorType="EventDecoratorType";function EventDecorator(t,e){return function(i){null==e&&console.error("EventDecorator必须要传 sceneType"),DecoratorCollector.inst.add(EventDecoratorType,t,i,e)}}class EventInfo{constructor(t,e){this.eventHandler=t,this.sceneType=e}}class MoyeEventCenter{constructor(){this.allEvents=new Map}static get inst(){return null==this._inst&&(this._inst=new MoyeEventCenter,this._inst.reloadEvent()),this._inst}reloadEvent(){const t=DecoratorCollector.inst.get(EventDecoratorType);this.allEvents.clear();for(const e of t){const t=e[0],i=e[1],r=e[2];let s=this.allEvents.get(t);s||(s=[],this.allEvents.set(t,s)),s.push(new EventInfo(new i,r))}}publish(t){const e=this.allEvents.get(t.constructor);if(e){for(let i=0;i<e.length;i++){e[i].eventHandler.handle(null,t)}t.dispose()}}}class Task extends Promise{static create(t){let e;const i=new Task((t=>{e=t}));return i._resolve=e,i}setResult(t){if(!this._resolve)throw new Error("setResult but task has been disposed");this._resolve(t),this.dispose()}constructor(t){super(t)}dispose(){this._resolve=null}}class Game{static addSingleton(t,e=!0){if(Game._singletonMap.has(t))throw new Error(`already exist singleton: ${t.name}`);e&&MoyeEventCenter.inst.publish(BeforeSingletonAdd.create({singletonType:t}));const i=new t;t._inst=i,Game._singletonMap.set(t,i),Game._singletons.push(i);const r=i;return r.awake&&r.awake(),Game._destroys.push(r),r.update&&Game._updates.push(r),r.lateUpdate&&Game._lateUpdates.push(r),e&&MoyeEventCenter.inst.publish(AfterSingletonAdd.create({singletonType:t})),i}static async waitFrameFinish(){const t=Task.create();Game._frameFinishTaskQueue.push(t),await t}static update(){for(let t=0;t<Game._updates.length;t++){const e=Game._updates[t];e.isDisposed||e.update()}}static lateUpdate(){for(let t=0;t<Game._lateUpdates.length;t++){const e=Game._lateUpdates[t];e.isDisposed||e.lateUpdate()}}static frameFinishUpdate(){const t=Game._frameFinishTaskQueue.length;if(0!=t){for(let e=0;e<t;e++){Game._frameFinishTaskQueue[e].setResult()}Game._frameFinishTaskQueue=[]}}static dispose(){for(let t=Game._singletons.length-1;t>=0;t--){const e=Game._singletons[t];e.isDisposed||e._onPreDestroy()}}}Game._singletonMap=new Map,Game._singletons=[],Game._destroys=[],Game._updates=[],Game._lateUpdates=[],Game._frameFinishTaskQueue=[];class EventSystem extends Singleton{async publishAsync(t,e){const i=MoyeEventCenter.inst.allEvents.get(e.constructor);if(!i)return;const r=[];for(let s=0;s<i.length;s++){const o=i[s];o.sceneType!=t.sceneType&&"None"!=o.sceneType||r.push(o.eventHandler.handleAsync(t,e))}await Promise.all(r),e.dispose()}publish(t,e){const i=MoyeEventCenter.inst.allEvents.get(e.constructor);if(i){for(let r=0;r<i.length;r++){const s=i[r];s.sceneType!=t.sceneType&&"None"!=s.sceneType||s.eventHandler.handle(t,e)}e.dispose()}}}var __decorate$3=function(t,e,i,r){var s,o=arguments.length,n=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(n=(o<3?s(n):o>3?s(e,i,n):s(e,i))||n);return o>3&&n&&Object.defineProperty(e,i,n),n};const{ccclass:ccclass$3,property:property$3}=_decorator;let MoyeRuntime=class extends Component{start(){director.addPersistRootNode(this.node)}update(t){Game.update()}lateUpdate(t){Game.lateUpdate(),Game.frameFinishUpdate()}onDestroy(){Game.dispose()}};MoyeRuntime=__decorate$3([ccclass$3("MoyeRuntime")],MoyeRuntime);class EntityCenter extends Singleton{constructor(){super(...arguments),this._allEntities=new Map}add(t){this._allEntities.set(t.instanceId,t)}remove(t){this._allEntities.delete(t)}get(t){return this._allEntities.get(t)}}class Program{static init(t){MoyeEventCenter.inst.publish(new BeforeProgramInit),Game.addSingleton(ObjectPool,!1),Game.addSingleton(Options),Game.addSingleton(Logger),Game.addSingleton(EventSystem),Game.addSingleton(TimeInfo),Game.addSingleton(IdGenerator),Game.addSingleton(EntityCenter),t.addComponent(MoyeRuntime),MoyeEventCenter.inst.publish(new AfterProgramInit)}static start(){MoyeEventCenter.inst.reloadEvent(),MoyeEventCenter.inst.publish(new BeforeProgramStart),MoyeEventCenter.inst.publish(new AfterProgramStart)}}async function safeCall(t){try{return await t}catch(t){coreError(t?.stack)}}class AEventHandler{async handleAsync(t,e){try{await this.run(t,e)}catch(t){t instanceof Error?coreError(t.stack):coreError(t)}}handle(t,e){try{const i=this.run(t,e);i instanceof Promise&&(coreWarn("{0}的run方法是异步的, 请尽量不要用publish来通知",this.constructor.name),safeCall(i))}catch(t){t instanceof Error?coreError(t.stack):coreError(t)}}}var __decorate$2=function(t,e,i,r){var s,o=arguments.length,n=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(n=(o<3?s(n):o>3?s(e,i,n):s(e,i))||n);return o>3&&n&&Object.defineProperty(e,i,n),n};const{ccclass:ccclass$2,property:property$2,menu:menu$2}=_decorator;let SizeFollow=class extends Component{constructor(){super(...arguments),this._heightFollow=!0,this._widthFollow=!0,this._heightOffset=0,this._widthOffset=0,this._changeSize=new Size}get target(){return this._target}set target(t){this._target=t,this.updateSizeOffset()}set heightFollow(t){this._heightFollow=t,this.updateSizeOffset()}get heightFollow(){return this._heightFollow}set widthFollow(t){this._widthFollow=t,this.updateSizeOffset()}get widthFollow(){return this._widthFollow}onLoad(){null!=this._target&&this._target.node.on(NodeEventType.SIZE_CHANGED,this.onTargetSizeChange,this)}onDestroy(){null!=this._target&&(this._target.isValid?(this._target.node.off(NodeEventType.SIZE_CHANGED,this.onTargetSizeChange,this),this._target=null):this._target=null)}onTargetSizeChange(){const t=this.node.getComponent(UITransform),e=this._target;this._changeSize.set(t.contentSize),this._widthFollow&&(this._changeSize.width=Math.max(0,e.width+this._widthOffset)),this._heightFollow&&(this._changeSize.height=Math.max(0,e.height+this._heightOffset)),t.setContentSize(this._changeSize)}updateSizeOffset(){if(null==this._target)return;const t=this.node.getComponent(UITransform),e=this._target;if(this._widthFollow){const i=t.width,r=e.width;this._widthOffset=i-r}if(this._heightFollow){const i=t.height,r=e.height;this._heightOffset=i-r}}};__decorate$2([property$2({type:UITransform})],SizeFollow.prototype,"target",null),__decorate$2([property$2({type:UITransform})],SizeFollow.prototype,"_target",void 0),__decorate$2([property$2],SizeFollow.prototype,"heightFollow",null),__decorate$2([property$2],SizeFollow.prototype,"_heightFollow",void 0),__decorate$2([property$2],SizeFollow.prototype,"widthFollow",null),__decorate$2([property$2],SizeFollow.prototype,"_widthFollow",void 0),__decorate$2([property$2({type:CCFloat})],SizeFollow.prototype,"_heightOffset",void 0),__decorate$2([property$2({type:CCFloat})],SizeFollow.prototype,"_widthOffset",void 0),SizeFollow=__decorate$2([ccclass$2("SizeFollow"),menu$2("moye/SizeFollow")],SizeFollow);var __decorate$1=function(t,e,i,r){var s,o=arguments.length,n=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(n=(o<3?s(n):o>3?s(e,i,n):s(e,i))||n);return o>3&&n&&Object.defineProperty(e,i,n),n};const{ccclass:ccclass$1,property:property$1,executeInEditMode:executeInEditMode,menu:menu$1}=_decorator;var WidgetBase,WidgetDirection;!function(t){t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM"}(WidgetBase||(WidgetBase={})),function(t){t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.LEFT_EXTEND=5]="LEFT_EXTEND",t[t.RIGHT_EXTEND=6]="RIGHT_EXTEND",t[t.TOP_EXTEND=7]="TOP_EXTEND",t[t.BOTTOM_EXTEND=8]="BOTTOM_EXTEND"}(WidgetDirection||(WidgetDirection={}));let CTWidget=class extends Component{constructor(){super(...arguments),this._targetDir=WidgetDirection.TOP,this._dir=WidgetDirection.TOP,this.visibleOffset=0,this._isVertical=!0,this._distance=0,this._changePos=new Vec3(0,0,0),this._targetOldPos=new Vec3(0,0,0),this._targetOldSize=0,this._selfOldPos=new Vec3(0,0,0),this._selfOldSize=0}get target(){return this._target}set target(t){this._target=t,this.unregisterEvt(),this.registerEvt(),this.updateData()}set targetDir(t){if(EDITOR){if(t==WidgetDirection.LEFT||t==WidgetDirection.RIGHT){switch(this._dir){case WidgetDirection.TOP:case WidgetDirection.TOP_EXTEND:case WidgetDirection.BOTTOM:case WidgetDirection.BOTTOM_EXTEND:this._dir=WidgetDirection.LEFT}this._isVertical=!1}else{switch(this._dir){case WidgetDirection.LEFT:case WidgetDirection.LEFT_EXTEND:case WidgetDirection.RIGHT:case WidgetDirection.RIGHT_EXTEND:this._dir=WidgetDirection.TOP}this._isVertical=!0}this._targetDir=t,this.updateData()}}get targetDir(){return this._targetDir}set dir(t){if(EDITOR){switch(t){case WidgetDirection.LEFT:case WidgetDirection.LEFT_EXTEND:case WidgetDirection.RIGHT:case WidgetDirection.RIGHT_EXTEND:switch(this._targetDir){case WidgetDirection.TOP:case WidgetDirection.BOTTOM:this._targetDir=WidgetDirection.LEFT}this._isVertical=!1;break;case WidgetDirection.TOP:case WidgetDirection.TOP_EXTEND:case WidgetDirection.BOTTOM:case WidgetDirection.BOTTOM_EXTEND:switch(this._targetDir){case WidgetDirection.LEFT:case WidgetDirection.RIGHT:this._targetDir=WidgetDirection.TOP}this._isVertical=!0}this._dir=t,this.updateData()}}get dir(){return this._dir}onEnable(){EDITOR&&(this.registerEvt(),this.updateData())}onDisable(){EDITOR&&this.unregisterEvt()}onLoad(){this._trans=this.node.getComponent(UITransform),EDITOR||this.registerEvt()}onDestroy(){EDITOR||(this.unregisterEvt(),this._trans=null,this._target=null,this._changePos=null)}registerEvt(){this._target&&(EDITOR&&(this._target.node.on(NodeEventType.ANCHOR_CHANGED,this.updateData,this),this.node.on(NodeEventType.TRANSFORM_CHANGED,this.updateData,this),this.node.on(NodeEventType.SIZE_CHANGED,this.updateData,this)),this._target.node.on(NodeEventType.SIZE_CHANGED,this.onTargetChange,this),this._target.node.on(NodeEventType.TRANSFORM_CHANGED,this.onTargetChange,this),this._target.node.on(NodeEventType.ACTIVE_IN_HIERARCHY_CHANGED,this.onTargetChange,this))}unregisterEvt(){this._target&&this._target.isValid&&(EDITOR&&(this._target.node.off(NodeEventType.ANCHOR_CHANGED,this.updateData,this),this.node.off(NodeEventType.TRANSFORM_CHANGED,this.updateData,this),this.node.off(NodeEventType.SIZE_CHANGED,this.updateData,this)),this._target.node.off(NodeEventType.SIZE_CHANGED,this.onTargetChange,this),this._target.node.off(NodeEventType.TRANSFORM_CHANGED,this.onTargetChange,this),this._target.node.off(NodeEventType.ACTIVE_IN_HIERARCHY_CHANGED,this.onTargetChange,this))}updateData(){if(null!=this._target)switch(this._dir){case WidgetDirection.TOP:case WidgetDirection.BOTTOM:case WidgetDirection.LEFT:case WidgetDirection.RIGHT:this.updateDistance();break;case WidgetDirection.TOP_EXTEND:case WidgetDirection.BOTTOM_EXTEND:case WidgetDirection.LEFT_EXTEND:case WidgetDirection.RIGHT_EXTEND:this.updateTargetPos()}}onTargetChange(){if(null!=this._target)switch(this._dir){case WidgetDirection.TOP:case WidgetDirection.BOTTOM:case WidgetDirection.LEFT:case WidgetDirection.RIGHT:this.updatePos();break;case WidgetDirection.TOP_EXTEND:case WidgetDirection.BOTTOM_EXTEND:case WidgetDirection.LEFT_EXTEND:case WidgetDirection.RIGHT_EXTEND:this.updateSize()}}updateSize(){if(this._isVertical){const t=this._targetOldPos.y-this._target.node.position.y;let e=this._target.height-this._targetOldSize;const i=this._trans.anchorY;this._changePos.set(this._selfOldPos),this._target.getComponent(Label)&&!this._target.node.active&&(e=this._targetOldSize);const r=t+e;this._trans.height=this._selfOldSize+r,this._dir==WidgetDirection.TOP_EXTEND?this.node.setPosition(this._changePos):this._dir==WidgetDirection.BOTTOM_EXTEND&&(this._changePos.y-=r*(1-i),this.node.setPosition(v3(this._changePos)))}}updatePos(){const t=this._trans,e=this._target;let i=this.getPos(e,this._targetDir)-this._distance;if(this._changePos.set(this.node.worldPosition),this._isVertical){switch(this._dir){case WidgetDirection.TOP:i-=t.height*(1-t.anchorY);break;case WidgetDirection.BOTTOM:i+=t.height*t.anchorY;break}this._changePos.y=i}else this._changePos.x=i;this.node.worldPosition=this._changePos}updateTargetPos(){EDITOR&&null==this._changePos&&(console.error("编辑器数据错乱, 请重新添加本组件"),this._changePos=v3()),this.target.node.getPosition(this._targetOldPos),this.node.getPosition(this._selfOldPos),this._isVertical?(this._selfOldSize=this._trans.height,this._targetOldSize=this._target.height):(this._selfOldSize=this._trans.width,this._targetOldSize=this._target.height)}updateDistance(){if(!EDITOR)return;if(null==this._target)return;const t=this.node.getComponent(UITransform),e=this._target,i=this.getPos(t,this._dir),r=this.getPos(e,this._targetDir);this._distance=r-i}getPos(t,e){if(this._isVertical){let i=t.node.worldPosition.y;const r=t.height,s=t.anchorY;switch(e){case WidgetDirection.TOP:case WidgetDirection.TOP_EXTEND:return t.node.active||(i=i-r-this.visibleOffset),i+r*(1-s);case WidgetDirection.BOTTOM:case WidgetDirection.BOTTOM_EXTEND:return t.node.active||(i=i+r+this.visibleOffset),i-r*s}}else{const i=t.node.worldPosition.x,r=t.width,s=t.anchorX;switch(e){case WidgetDirection.LEFT:return i-r*s;case WidgetDirection.RIGHT:return i+r*(1-s)}}}};__decorate$1([property$1({type:UITransform})],CTWidget.prototype,"target",null),__decorate$1([property$1({type:UITransform})],CTWidget.prototype,"_target",void 0),__decorate$1([property$1({type:Enum(WidgetBase)})],CTWidget.prototype,"targetDir",null),__decorate$1([property$1],CTWidget.prototype,"_targetDir",void 0),__decorate$1([property$1({type:Enum(WidgetDirection)})],CTWidget.prototype,"dir",null),__decorate$1([property$1],CTWidget.prototype,"_dir",void 0),__decorate$1([property$1({type:CCFloat})],CTWidget.prototype,"visibleOffset",void 0),__decorate$1([property$1],CTWidget.prototype,"_isVertical",void 0),__decorate$1([property$1],CTWidget.prototype,"_distance",void 0),__decorate$1([property$1],CTWidget.prototype,"_changePos",void 0),__decorate$1([property$1],CTWidget.prototype,"_targetOldPos",void 0),__decorate$1([property$1],CTWidget.prototype,"_targetOldSize",void 0),__decorate$1([property$1],CTWidget.prototype,"_selfOldPos",void 0),__decorate$1([property$1],CTWidget.prototype,"_selfOldSize",void 0),CTWidget=__decorate$1([ccclass$1("CTWidget"),menu$1("moye/CTWidget"),executeInEditMode],CTWidget);const RoundBoxAssembler={GetIndexBuffer(t){const e=[0,1,2,2,3,0,4,5,6,6,7,4,8,9,10,10,11,8];let i=12;const r=function(r,s,o){let n=s;for(let s=0;s<t.segments-1;s++){const t=i;i++,e.push(r,n,t),n=t}e.push(r,n,o)};return t.leftBottom&&r(3,4,0),t.leftTop&&r(2,1,5),t.rightTop&&r(9,6,10),t.rightBottom&&r(8,11,7),e},createData(t){const e=t.requestRenderData();let i=0;i+=t.leftBottom?1:0,i+=t.leftTop?1:0,i+=t.rightTop?1:0,i+=t.rightBottom?1:0;const r=12+(t.segments-1)*i;e.dataLength=r,e.resize(r,18+3*t.segments*i);const s=RoundBoxAssembler.GetIndexBuffer(t);return e.chunk.setIndexBuffer(s),e},updateRenderData(t){const e=t.spriteFrame;dynamicAtlasManager.packToDynamicAtlas(t,e),this.updateUVs(t);const i=t.renderData;i&&e&&(i.vertDirty&&this.updateVertexData(t),i.updateRenderData(t,e))},updateWorldVerts(t,e){const i=t.renderData,r=e.vb,s=i.data,o=t.node.worldMatrix,n=i.floatStride;let a=0;const c=s.length;for(let t=0;t<c;t++){const e=s[t],i=e.x,c=e.y;let l=o.m03*i+o.m07*c+o.m15;l=l?1/l:1,a=t*n,r[a+0]=(o.m00*i+o.m04*c+o.m12)*l,r[a+1]=(o.m01*i+o.m05*c+o.m13)*l,r[a+2]=(o.m02*i+o.m06*c+o.m14)*l}},fillBuffers(t){if(null===t)return;const e=t.renderData,i=e.chunk;(t.node.hasChangedFlags||e.vertDirty)&&(this.updateWorldVerts(t,i),e.vertDirty=!1),i.bufferId;const r=i.vertexOffset,s=i.meshBuffer,o=i.meshBuffer.iData;let n=s.indexOffset;const a=r,c=RoundBoxAssembler.GetIndexBuffer(t);for(let t=0;t<e.indexCount;t++)o[n++]=a+c[t];s.indexOffset+=e.indexCount},updateVertexData(t){const e=t.renderData;if(!e)return;const i=t.node._uiProps.uiTransformComp,r=e.data,s=i.width,o=i.height,n=i.anchorX*s,a=i.anchorY*o,c=0-n,l=s-n,h=o-a,d=0-a,p=c+t.radius,_=d+t.radius,g=h-t.radius,u=l-t.radius;r[0].x=c,r[0].y=t.leftBottom?_:d,r[1].x=c,r[1].y=t.leftTop?g:h,r[2].x=p,r[2].y=t.leftTop?g:h,r[3].x=p,r[3].y=t.leftBottom?_:d,r[4].x=p,r[4].y=d,r[5].x=p,r[5].y=h,r[6].x=u,r[6].y=h,r[7].x=u,r[7].y=d,r[8].x=u,r[8].y=t.rightBottom?_:d,r[9].x=u,r[9].y=t.rightTop?g:h,r[10].x=l,r[10].y=t.rightTop?g:h,r[11].x=l,r[11].y=t.rightBottom?_:d;let m=12;const T=function(e,i){for(let s=1;s<t.segments;s++){const o=i*Math.PI/180-s/t.segments*.5*Math.PI;r[m].x=e.x+Math.cos(o)*t.radius,r[m].y=e.y+Math.sin(o)*t.radius,m++}};t.leftBottom&&T(r[3],270),t.leftTop&&T(r[2],180),t.rightTop&&T(r[9],90),t.rightBottom&&T(r[8],0),e.vertDirty=!0},updateUVs(t){if(!t.spriteFrame)return;const e=t.renderData,i=e.chunk.vb,r=t.spriteFrame.uv,s=r[0],o=r[1],n=r[2],a=r[5],c=Math.abs(n-s),l=a-o,h=t.node._uiProps.uiTransformComp,d=e.data,p=h.width,_=h.height,g=h.anchorX*p,u=h.anchorY*_;for(let t=0;t<e.dataLength;t++)i[t*e.floatStride+3]=s+(d[t].x+g)/p*c,i[t*e.floatStride+4]=o+(d[t].y+u)/_*l},updateColor(t){const e=t.renderData,i=e.chunk.vb;let r=5;const s=t.color,o=s.r/255,n=s.g/255,a=s.b/255,c=s.a/255;for(let t=0;t<e.dataLength;t++,r+=e.floatStride)i[r]=o,i[r+1]=n,i[r+2]=a,i[r+3]=c}};var __decorate=function(t,e,i,r){var s,o=arguments.length,n=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(n=(o<3?s(n):o>3?s(e,i,n):s(e,i))||n);return o>3&&n&&Object.defineProperty(e,i,n),n};const{ccclass:ccclass,property:property,type:type,menu:menu}=_decorator;var EventType;!function(t){t.SPRITE_FRAME_CHANGED="spriteframe-changed"}(EventType||(EventType={}));let RoundBoxSprite=class extends UIRenderer{constructor(){super(...arguments),this._sizeMode=Sprite.SizeMode.TRIMMED,this._atlas=null,this._segments=10,this._radius=20,this._spriteFrame=null,this._leftTop=!0,this._rightTop=!0,this._leftBottom=!0,this._rightBottom=!0}get sizeMode(){return this._sizeMode}set sizeMode(t){this._sizeMode!==t&&(this._sizeMode=t,t!==Sprite.SizeMode.CUSTOM&&this._applySpriteSize())}get spriteAtlas(){return this._atlas}set spriteAtlas(t){this._atlas!==t&&(this._atlas=t)}get segments(){return this._segments}set segments(t){this._segments=t,this._renderData=null,this._flushAssembler()}get radius(){return this._radius}set radius(t){this._radius=t,this._updateUVs(),this.markForUpdateRenderData(!0)}get spriteFrame(){return this._spriteFrame}set spriteFrame(t){if(this._spriteFrame===t)return;const e=this._spriteFrame;this._spriteFrame=t,this.markForUpdateRenderData(),this._applySpriteFrame(e),EDITOR&&this.node.emit(EventType.SPRITE_FRAME_CHANGED,this)}get leftTop(){return this._leftTop}set leftTop(t){this._leftTop=t,this.resetAssembler()}get rightTop(){return this._rightTop}set rightTop(t){this._rightTop=t,this.resetAssembler()}get leftBottom(){return this._leftBottom}set leftBottom(t){this._leftBottom=t,this.resetAssembler()}get rightBottom(){return this._rightBottom}set rightBottom(t){this._rightBottom=t,this.resetAssembler()}onLoad(){this._flushAssembler()}__preload(){this.changeMaterialForDefine(),super.__preload(),EDITOR&&(this._resized(),this.node.on(NodeEventType.SIZE_CHANGED,this._resized,this))}onEnable(){super.onEnable(),this._activateMaterial();this._spriteFrame&&this._updateUVs()}onDestroy(){EDITOR&&this.node.off(NodeEventType.SIZE_CHANGED,this._resized,this),super.onDestroy()}changeSpriteFrameFromAtlas(t){if(!this._atlas)return void console.warn("SpriteAtlas is null.");const e=this._atlas.getSpriteFrame(t);this.spriteFrame=e}changeMaterialForDefine(){let t;const e=this._instanceMaterialType;this._spriteFrame&&(t=this._spriteFrame.texture);let i=!1;if(t instanceof cclegacy.TextureBase){const e=t.getPixelFormat();i=e===cclegacy.TextureBase.PixelFormat.RGBA_ETC1||e===cclegacy.TextureBase.PixelFormat.RGB_A_PVRTC_4BPPV1||e===cclegacy.TextureBase.PixelFormat.RGB_A_PVRTC_2BPPV1}this._instanceMaterialType=i?InstanceMaterialType.USE_ALPHA_SEPARATED:InstanceMaterialType.ADD_COLOR_AND_TEXTURE,e!==this._instanceMaterialType&&this.updateMaterial()}_updateBuiltinMaterial(){let t=super._updateBuiltinMaterial();if(this.spriteFrame&&this.spriteFrame.texture instanceof RenderTexture){const e={SAMPLE_FROM_RT:!0,...t.passes[0].defines},i=new Material;i.initialize({effectAsset:t.effectAsset,defines:e}),t=i}return t}_render(t){t.commitComp(this,this.renderData,this._spriteFrame,this._assembler,null)}_canRender(){if(!super._canRender())return!1;const t=this._spriteFrame;return!(!t||!t.texture)}resetAssembler(){this._assembler=null,this._flushAssembler()}_flushAssembler(){const t=RoundBoxAssembler;this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.getRenderMaterial(0),this.markForUpdateRenderData(),this.spriteFrame&&this._assembler.updateRenderData(this),this._updateColor())}_applySpriteSize(){if(this._spriteFrame){if(BUILD||!this._spriteFrame)if(Sprite.SizeMode.RAW===this._sizeMode){const t=this._spriteFrame.originalSize;this.node._uiProps.uiTransformComp.setContentSize(t)}else if(Sprite.SizeMode.TRIMMED===this._sizeMode){const t=this._spriteFrame.rect;this.node._uiProps.uiTransformComp.setContentSize(t.width,t.height)}this.markForUpdateRenderData(!0),this._assembler.updateRenderData(this)}}_resized(){if(EDITOR&&this._spriteFrame){const t=this.node._uiProps.uiTransformComp.contentSize;let e=t.width,i=t.height;if(this._sizeMode===Sprite.SizeMode.RAW){const t=this._spriteFrame.originalSize;e=t.width,i=t.height}else if(this._sizeMode===Sprite.SizeMode.TRIMMED){const t=this._spriteFrame.rect;e=t.width,i=t.height}e===t.width&&i===t.height||(this._sizeMode=Sprite.SizeMode.CUSTOM)}}_activateMaterial(){const t=this._spriteFrame,e=this.getRenderMaterial(0);t&&e&&this.markForUpdateRenderData(),this.renderData&&(this.renderData.material=e)}_updateUVs(){this._assembler&&this._assembler.updateUVs(this)}_applySpriteFrame(t){const e=this._spriteFrame;let i=!1;e&&(t&&t.texture===e.texture||(i=!0),i&&(this.renderData&&(this.renderData.textureDirty=!0),this.changeMaterialForDefine()),this._applySpriteSize())}};__decorate([property({serializable:!0})],RoundBoxSprite.prototype,"_sizeMode",void 0),__decorate([type(Sprite.SizeMode)],RoundBoxSprite.prototype,"sizeMode",null),__decorate([property({serializable:!0})],RoundBoxSprite.prototype,"_atlas",void 0),__decorate([type(SpriteAtlas)],RoundBoxSprite.prototype,"spriteAtlas",null),__decorate([property({type:CCInteger,serializable:!0})],RoundBoxSprite.prototype,"_segments",void 0),__decorate([property({type:CCInteger,serializable:!0,min:1})],RoundBoxSprite.prototype,"segments",null),__decorate([property({type:CCFloat,serializable:!0})],RoundBoxSprite.prototype,"_radius",void 0),__decorate([property({type:CCFloat,serializable:!0,min:0})],RoundBoxSprite.prototype,"radius",null),__decorate([property({serializable:!0})],RoundBoxSprite.prototype,"_spriteFrame",void 0),__decorate([type(SpriteFrame)],RoundBoxSprite.prototype,"spriteFrame",null),__decorate([property({serializable:!0})],RoundBoxSprite.prototype,"_leftTop",void 0),__decorate([property({serializable:!0})],RoundBoxSprite.prototype,"leftTop",null),__decorate([property({serializable:!0})],RoundBoxSprite.prototype,"_rightTop",void 0),__decorate([property({serializable:!0})],RoundBoxSprite.prototype,"rightTop",null),__decorate([property({serializable:!0})],RoundBoxSprite.prototype,"_leftBottom",void 0),__decorate([property({serializable:!0})],RoundBoxSprite.prototype,"leftBottom",null),__decorate([property({serializable:!0})],RoundBoxSprite.prototype,"_rightBottom",void 0),__decorate([property({serializable:!0})],RoundBoxSprite.prototype,"rightBottom",null),RoundBoxSprite=__decorate([ccclass("RoundBoxSprite"),menu("moye/RoundBoxSprite")],RoundBoxSprite);export{AEvent,AEventHandler,AfterProgramInit,AfterProgramStart,AfterSingletonAdd,BeforeProgramInit,BeforeProgramStart,BeforeSingletonAdd,CTWidget,DecoratorCollector,EntityCenter,EventDecorator,EventDecoratorType,EventSystem,Game,IdGenerator,IdStruct,InstanceIdStruct,JsHelper,Logger,ObjectPool,Options,Program,RecycleObj,RoundBoxSprite,Singleton,SizeFollow,TimeInfo,error,log,safeCall,warn};