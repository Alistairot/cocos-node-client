import{_decorator,Component,director,SpriteFrame,Texture2D,instantiate,native,assetManager,UITransform,CCBoolean,Node,Enum,Layout,Vec3,Label,Widget,CCObject,CCFloat,Size,NodeEventType,v3,dynamicAtlasManager,Sprite,SpriteAtlas,CCInteger,UIRenderer,cclegacy,InstanceMaterialType,RenderTexture,Material,BitMask,CCString,EventTarget,Vec2,UIOpacity,Input,misc,RigidBody2D}from"cc";import{NATIVE,EDITOR,BUILD}from"cc/env";class Singleton{constructor(){this._isDisposed=!1}static get(){const e=this;if(null==e._inst)throw new Error(`Singleton is not initialized or destroyed, name is ${e.name}`);return e._inst}get isDisposed(){return this._isDisposed}dispose(){this._onPreDestroy()}_onPreDestroy(){this._isDisposed||(this.destroy&&this.destroy(),Singleton._inst=null,this._isDisposed=!0)}}class TimeInfo extends Singleton{constructor(){super(...arguments),this.deltaTime=0}awake(){this.serverMinusClientTime=0}clientNow(){return Date.now()}serverNow(){return this.clientNow()+this.serverMinusClientTime}update(e){this.deltaTime=e}}class JsHelper{static getMethodName(){const e=(new Error).stack.split("at ")[2],t=e.indexOf(" ");return e.substring(0,t)}static getRootDirName(e){return e.split("/")[0]}static sleep(e){return new Promise((t=>setTimeout(t,e)))}static isNullOrEmpty(e){return null==e||(0==e.length||void 0)}static getStringHashCode(e){let t=5381,s=e.length;for(;s;)t=33*t^e.charCodeAt(--s);return t>>>0}static modeString(e,t){return this.getStringHashCode(e)%t}static powBigInt(e,t){let s=BigInt(1);for(let i=0;i<t;i++)s*=e;return s}static formatStr(e,...t){if("string"!=typeof e){const e=new Error("formatStr args err");return e.name+e.stack}if(0==t.length)return e;return e.replace(/\{\{|\}\}|\{(\d+)\}/g,(function(e,s){return"{{"==e?"{":"}}"==e?"}":t[s]}))}}class Options extends Singleton{constructor(){super(...arguments),this.isServer=!1,this.logLevel=1,this.develop=!0}}class LoggerDefault{log(e){console.log(e)}warn(e){console.warn(e)}error(e){console.error(e)}}class Logger extends Singleton{set iLog(e){this._logInst=e}get _iLog(){return this._logInst||(this._logInst=new LoggerDefault,this._logInst.warn("not set iLog, use default logger")),this._logInst}log(e,...t){if(this.checkLogLevel(Logger.LOG_LEVEL)){const s=JsHelper.formatStr(e,...t);this._iLog.log(s)}}warn(e,...t){if(this.checkLogLevel(Logger.WARN_LEVEL)){const s=JsHelper.formatStr(e,...t);this._iLog.warn(s)}}error(e,...t){const s=JsHelper.formatStr(e,...t);this._iLog.error(s)}checkLogLevel(e){return Options.get().logLevel<=e}coreLog(e){this._iLog.log(e)}coreWarn(e){this._iLog.warn(e)}coreError(e){this._iLog.error(e)}}function log(e,...t){Logger.get().log(e,...t)}function warn(e,...t){Logger.get().warn(e,...t)}function error(e,...t){Logger.get().error(e,...t)}function coreLog(e,t,...s){const i=`[${e}]: ${JsHelper.formatStr(t,...s)}`;try{Logger.get().coreLog(i)}catch(e){console.log(i)}}function coreWarn(e,t,...s){const i=`[${e}]: ${JsHelper.formatStr(t,...s)}`;try{Logger.get().coreWarn(i)}catch(e){console.warn(i)}}function coreError(e,t,...s){const i=`[${e}]: ${JsHelper.formatStr(t,...s)}`;try{Logger.get().coreError(i)}catch(e){console.error(i)}}Logger.LOG_LEVEL=1,Logger.WARN_LEVEL=2;const IdGeneratorTag="IdGenerator",timeBit$1=30n,processBit=14n,valueBit$1=20n,powTimeBit$1=JsHelper.powBigInt(2n,timeBit$1)-1n,powProcessBit=JsHelper.powBigInt(2n,processBit)-1n,powValueBit$1=JsHelper.powBigInt(2n,valueBit$1)-1n,epoch$1=new Date(2023,4,1).getTime();class IdStruct{static get inst(){return null==IdStruct._inst&&(IdStruct._inst=new IdStruct),IdStruct._inst}static generate(){0==this._lastTime&&(this._lastTime=this.timeSinceEpoch(),this._lastTime<=0&&(coreWarn("IdGenerator","{0}: lastTime less than 0: {1}",(new this).constructor.name,this._lastTime),this._lastTime=1));const e=this.timeSinceEpoch();e>this._lastTime?(this._lastTime=e,this._idCount=0):(++this._idCount,this._idCount>powValueBit$1&&(++this._lastTime,this._idCount=0,coreError("IdGenerator","{0}: idCount per sec overflow: {1} {2}",(new this).constructor.name,e,this._lastTime)));const t=IdStruct.inst;return t.init(this._lastTime,1,this._idCount),t.result}static convertToId(e,t,s){return IdStruct.inst.init(e,t,s).result}static parseId(e){return IdStruct.inst.initById(e)}static timeSinceEpoch(){const e=(TimeInfo.get().clientNow()-epoch$1)/1e3;return Math.floor(e)}initById(e){return this.result=e,this.time=e&powTimeBit$1,e>>=timeBit$1,this.process=e&powProcessBit,e>>=processBit,this.value=e&powValueBit$1,this}init(e,t,s){return this.time=BigInt(e),this.process=BigInt(t),this.value=BigInt(s),this.updateResult(),this}updateResult(){this.result=this.value,this.result<<=processBit,this.result|=this.process,this.result<<=timeBit$1,this.result|=this.time}}IdStruct._lastTime=0,IdStruct._idCount=0;const timeBit=32n,valueBit=32n,powTimeBit=JsHelper.powBigInt(2n,timeBit)-1n,powValueBit=JsHelper.powBigInt(2n,valueBit)-1n,epoch=new Date(2023,4,1).getTime();class InstanceIdStruct{static get inst(){return null==InstanceIdStruct._inst&&(InstanceIdStruct._inst=new InstanceIdStruct),InstanceIdStruct._inst}static generate(){0==this._lastTime&&(this._lastTime=this.timeSinceEpoch(),this._lastTime<=0&&(coreWarn("IdGenerator","{0}: lastTime less than 0: {1}",(new this).constructor.name,this._lastTime),this._lastTime=1));const e=this.timeSinceEpoch();e>this._lastTime?(this._lastTime=e,this._idCount=0):(++this._idCount,this._idCount>powValueBit&&(++this._lastTime,this._idCount=0,coreError("IdGenerator","{0}: idCount per sec overflow: {1} {2}",(new this).constructor.name,e,this._lastTime)));const t=InstanceIdStruct.inst;return t.init(this._lastTime,this._idCount),t.result}static convertToId(e,t){return InstanceIdStruct.inst.init(e,t).result}static parseId(e){return InstanceIdStruct.inst.initById(e)}static timeSinceEpoch(){const e=(TimeInfo.get().clientNow()-epoch)/1e3;return Math.floor(e)}initById(e){return this.result=e,this.time=e&powTimeBit,e>>=timeBit,this.value=e&powValueBit,this}init(e,t){return this.time=BigInt(e),this.value=BigInt(t),this.updateResult(),this}updateResult(){this.result=this.value,this.result<<=timeBit,this.result|=this.time}}InstanceIdStruct._lastTime=0,InstanceIdStruct._idCount=0;class IdGenerator extends Singleton{generateInstanceId(){return InstanceIdStruct.generate()}generateId(){return IdStruct.generate()}}class ObjectPool extends Singleton{constructor(){super(...arguments),this._pool=new Map}fetch(e){const t=this._pool.get(e);return t?0===t.length?new e:t.shift():new e}recycle(e){const t=e.constructor;let s=this._pool.get(t);s||(s=[],this._pool.set(t,s)),s.length>1e3?console.warn(`pool ${t.name} is too large`):s.push(e)}}class EntityCenter extends Singleton{constructor(){super(...arguments),this._allEntities=new Map}add(e){this._allEntities.set(e.instanceId,e)}remove(e){this._allEntities.delete(e)}get(e){return this._allEntities.get(e)}}var InstanceQueueIndex,EntityStatus,SceneType;!function(e){e[e.NONE=-1]="NONE",e[e.UPDATE=0]="UPDATE",e[e.LATE_UPDATE=1]="LATE_UPDATE",e[e.MAX=2]="MAX"}(InstanceQueueIndex||(InstanceQueueIndex={}));class EntityLifiCycleMgr extends Singleton{constructor(){super(...arguments),this._queues=new Array(InstanceQueueIndex.MAX)}awake(){for(let e=0;e<this._queues.length;e++)this._queues[e]=[]}registerSystem(e){e.update&&this._queues[InstanceQueueIndex.UPDATE].push(e.instanceId),e.lateUpdate&&this._queues[InstanceQueueIndex.LATE_UPDATE].push(e.instanceId)}awakeComEvent(e){e.awake()}destroyComEvent(e){e.destroy()}update(){const e=this._queues[InstanceQueueIndex.UPDATE],t=EntityCenter.get();for(let s=e.length-1;s>=0;s--){const i=e[s],o=t.get(i);o?o.isDisposed?e.splice(s,1):o.update():e.splice(s,1)}}lateUpdate(){const e=this._queues[InstanceQueueIndex.LATE_UPDATE],t=EntityCenter.get();for(let s=e.length-1;s>=0;s--){const i=e[s],o=t.get(i);o?o.isDisposed?e.splice(s,1):o.lateUpdate():e.splice(s,1)}}}!function(e){e[e.NONE=0]="NONE",e[e.IS_FROM_POOL=1]="IS_FROM_POOL",e[e.IS_REGISTER=2]="IS_REGISTER",e[e.IS_COMPONENT=4]="IS_COMPONENT",e[e.IS_CREATED=8]="IS_CREATED",e[e.IS_NEW=16]="IS_NEW"}(EntityStatus||(EntityStatus={}));class Entity{constructor(){this._status=EntityStatus.NONE}get parent(){return this._parent}set parent(e){if(null==e)throw new Error(`cant set parent null: ${this.constructor.name}`);if(e==this)throw new Error(`cant set parent self: ${this.constructor.name}`);if(null==e.domain)throw new Error(`cant set parent because parent domain is null: ${this.constructor.name} ${e.constructor.name}`);if(null!=this._parent){if(this._parent==e)throw new Error(`重复设置了Parent: ${this.constructor.name} parent: ${this._parent.constructor.name}`);this._parent.removeFromChildren(this)}this._parent=e,this.isComponent=!1,this._parent.addToChildren(this),this.domain=this.parent.domain}get domain(){return this._domain}set domain(e){if(null==e)throw new Error(`domain cant set null: ${this.constructor.name}`);if(this._domain==e)return;const t=this._domain;if(this._domain=e,null==t&&(this.instanceId=IdGenerator.get().generateInstanceId(),this.isRegister=!0),null!=this._children)for(const[e,t]of this._children.entries())t.domain=this._domain;if(null!=this._components)for(const[e,t]of this._components.entries())t.domain=this._domain;this.isCreated||(this.isCreated=!0)}get isDisposed(){return 0n==this.instanceId}get children(){return this._children??(this._children=ObjectPool.get().fetch(Map))}get components(){return this._components??(this._components=ObjectPool.get().fetch(Map))}get isFromPool(){return(this._status&EntityStatus.IS_FROM_POOL)==EntityStatus.IS_FROM_POOL}set isFromPool(e){e?this._status|=EntityStatus.IS_FROM_POOL:this._status&=~EntityStatus.IS_FROM_POOL}get isComponent(){return(this._status&EntityStatus.IS_COMPONENT)==EntityStatus.IS_COMPONENT}set isComponent(e){e?this._status|=EntityStatus.IS_COMPONENT:this._status&=~EntityStatus.IS_COMPONENT}get isCreated(){return(this._status&EntityStatus.IS_CREATED)==EntityStatus.IS_CREATED}set isCreated(e){e?this._status|=EntityStatus.IS_CREATED:this._status&=~EntityStatus.IS_CREATED}get isNew(){return(this._status&EntityStatus.IS_NEW)==EntityStatus.IS_NEW}set isNew(e){e?this._status|=EntityStatus.IS_NEW:this._status&=~EntityStatus.IS_NEW}get isRegister(){return(this._status&EntityStatus.IS_REGISTER)==EntityStatus.IS_REGISTER}set isRegister(e){if(this.isRegister!=e)if(e?this._status|=EntityStatus.IS_REGISTER:this._status&=~EntityStatus.IS_REGISTER,e){const e=this;EntityCenter.get().add(e),EntityLifiCycleMgr.get().registerSystem(e)}else EntityCenter.get().remove(this.instanceId)}set componentParent(e){if(null==e)throw new Error(`cant set parent null: ${this.constructor.name}`);if(e==this)throw new Error(`cant set parent self: ${this.constructor.name}`);if(null==e.domain)throw new Error(`cant set parent because parent domain is null: ${this.constructor.name} ${e.constructor.name}`);if(null!=this.parent){if(this.parent==e)throw new Error(`重复设置了Parent: ${this.constructor.name} parent: ${this.parent.constructor.name}`);this.parent.removeFromComponents(this)}this._parent=e,this.isComponent=!0,this._parent.addToComponents(this),this.domain=this.parent.domain}addCom(e,t){return e instanceof Entity?this.addComByEntity(e):this.addComByType(e,t)}tryAddCom(e){let t=this.getCom(e);return null==t&&(t=this.addCom(e)),t}addComByEntity(e){const t=e.constructor;if(null!=this._components&&this._components.has(t))throw new Error(`entity already has component: ${t.name}`);return e.componentParent=this,e}addComByType(e,t=!1){if(null!=this._components&&this._components.has(e))throw new Error(`entity already has component: ${e.name}`);const s=this.createInst(e,t);return s.id=this.id,s.componentParent=this,s.awake&&EntityLifiCycleMgr.get().awakeComEvent(s),s}addChild(e,t){return e instanceof Entity?this.addChildByEntity(e):this.addChildByType(e,t)}addChildWithId(e,t,s=!1){const i=this.createInst(e,s);return i.id=t,i.parent=this,i.awake&&EntityLifiCycleMgr.get().awakeComEvent(i),i}addChildByEntity(e){return e.parent=this,e}addChildByType(e,t=!1){const s=this.createInst(e,t);return s.id=IdGenerator.get().generateId(),s.parent=this,s.awake&&EntityLifiCycleMgr.get().awakeComEvent(s),s}createInst(e,t){let s;return s=t?ObjectPool.get().fetch(e):new e,s.isFromPool=t,s.isCreated=!0,s.isNew=!0,s.id=0n,s}removeFromChildren(e){null!=this._children&&(this._children.delete(e.id),0==this._children.size&&(ObjectPool.get().recycle(this._children),this._children=null))}removeFromComponents(e){null!=this._components&&(this._components.delete(e.constructor),0==this._components.size&&(ObjectPool.get().recycle(this._components),this._components=null))}addToComponents(e){this.components.set(e.constructor,e)}addToChildren(e){if(this.children.has(e.id))throw new Error(`entity already has child: ${e.id}`);this.children.set(e.id,e)}getCom(e){if(null==this._components)return null;const t=this._components.get(e);return t||null}removeCom(e){if(this.isDisposed)return;if(null==this._components)return;const t=this.getCom(e);null!=t&&(this.removeFromComponents(t),t.dispose())}getParent(e){return this.parent}getChild(e,t){if(null==this._children)return null;return this._children.get(t)}removeChild(e){if(null==this._children)return;const t=this._children.get(e);t&&(this._children.delete(e),t.dispose())}dispose(){if(!this.isDisposed){if(this.isRegister=!1,this.instanceId=0n,null!=this._children){for(const[e,t]of this._children.entries())t.dispose();this._children.clear(),ObjectPool.get().recycle(this._children),this._children=null}if(null!=this._components){for(const[e,t]of this._components.entries())t.dispose();this._components.clear(),ObjectPool.get().recycle(this._components),this._components=null}this.destroy&&EntityLifiCycleMgr.get().destroyComEvent(this),this._domain=null,null==this._parent||this._parent.isDisposed||(this.isComponent?this._parent.removeCom(this.getType()):this._parent.removeFromChildren(this)),this._parent=null,this.isFromPool&&ObjectPool.get().recycle(this),this._status=EntityStatus.NONE}}domainScene(){return this.domain}getType(){return this.constructor}}class Scene extends Entity{set domain(e){this._domain=e}get domain(){return this._domain}set parent(e){null!=e&&(this._parent=e,this._parent.children.set(this.id,this))}get parent(){return this._parent}init(e){this.id=e.id,this.instanceId=e.instanceId,this.sceneType=e.sceneType,this.name=e.name,this.parent=e.parent,this.isCreated=!0,this.isNew=!0,this.domain=this,this.isRegister=!0,coreLog("scene","scene create sceneType = {0}, name = {1}, id = {2}",this.sceneType,this.name,this.id)}}!function(e){e.NONE="NONE",e.PROCESS="PROCESS",e.CLIENT="CLIENT",e.CURRENT="CURRENT"}(SceneType||(SceneType={}));class Root extends Singleton{get scene(){return this._scene}awake(){const e=new Scene;e.init({id:0n,sceneType:SceneType.PROCESS,name:"Process",instanceId:IdGenerator.get().generateInstanceId()}),this._scene=e}}class RecycleObj{static create(e){const t=ObjectPool.get().fetch(this);return e&&Object.assign(t,e),t._isRecycle=!0,t}dispose(){this._isRecycle&&ObjectPool.get().recycle(this)}}class AEvent extends RecycleObj{}class BeforeSingletonAdd extends AEvent{}class AfterSingletonAdd extends AEvent{}class BeforeProgramInit extends AEvent{}class AfterProgramInit extends AEvent{}class BeforeProgramStart extends AEvent{}class AfterProgramStart extends AEvent{}class AfterCreateClientScene extends AEvent{}class AfterCreateCurrentScene extends AEvent{}class DecoratorCollector{constructor(){this._decorators=new Map}static get inst(){return null==DecoratorCollector._inst&&(DecoratorCollector._inst=new DecoratorCollector),DecoratorCollector._inst}add(e,...t){let s=this._decorators.get(e);s||(s=[],this._decorators.set(e,s)),s.push(t)}get(e){return this._decorators.get(e)||[]}}const EventDecoratorType="EventDecoratorType";function EventDecorator(e,t){return function(s){null==t&&console.error("EventDecorator必须要传 sceneType"),DecoratorCollector.inst.add(EventDecoratorType,e,s,t)}}class EventInfo{constructor(e,t){this.eventHandler=e,this.sceneType=t}}class MoyeEventCenter{constructor(){this.allEvents=new Map}static get inst(){return null==this._inst&&(this._inst=new MoyeEventCenter,this._inst.reloadEvent()),this._inst}reloadEvent(){const e=DecoratorCollector.inst.get(EventDecoratorType);this.allEvents.clear();for(const t of e){const e=t[0],s=t[1],i=t[2];let o=this.allEvents.get(e);o||(o=[],this.allEvents.set(e,o)),o.push(new EventInfo(new s,i))}}publish(e){const t=this.allEvents.get(e.constructor);if(t){for(let s=0;s<t.length;s++){t[s].eventHandler.handle(null,e)}e.dispose()}}}class Task extends Promise{static create(e){let t;const s=new Task((e=>{t=e}));return s._resolve=t,s}setResult(e){if(!this._resolve)throw new Error("setResult but task has been disposed");this._resolve(e),this.dispose()}constructor(e){super(e)}dispose(){this._resolve=null}}class Game{static addSingleton(e,t=!0){if(Game._singletonMap.has(e))throw new Error(`already exist singleton: ${e.name}`);t&&MoyeEventCenter.inst.publish(BeforeSingletonAdd.create({singletonType:e}));const s=new e;e._inst=s,Game._singletonMap.set(e,s),Game._singletons.push(s);const i=s;return i.awake&&i.awake(),Game._destroys.push(i),i.update&&Game._updates.push(i),i.lateUpdate&&Game._lateUpdates.push(i),t&&MoyeEventCenter.inst.publish(AfterSingletonAdd.create({singletonType:e})),s}static async waitFrameFinish(){const e=Task.create();Game._frameFinishTaskQueue.push(e),await e}static update(e){for(let t=0;t<Game._updates.length;t++){const s=Game._updates[t];s.isDisposed||s.update(e)}}static lateUpdate(e){for(let t=0;t<Game._lateUpdates.length;t++){const s=Game._lateUpdates[t];s.isDisposed||s.lateUpdate(e)}}static frameFinishUpdate(){const e=Game._frameFinishTaskQueue.length;if(0!=e){for(let t=0;t<e;t++){Game._frameFinishTaskQueue[t].setResult()}Game._frameFinishTaskQueue=[]}}static dispose(){for(let e=Game._singletons.length-1;e>=0;e--){const t=Game._singletons[e];t.isDisposed||t._onPreDestroy()}}}Game._singletonMap=new Map,Game._singletons=[],Game._destroys=[],Game._updates=[],Game._lateUpdates=[],Game._frameFinishTaskQueue=[];class EventSystem extends Singleton{async publishAsync(e,t){const s=MoyeEventCenter.inst.allEvents.get(t.constructor);if(!s)return;const i=[];for(let o=0;o<s.length;o++){const r=s[o];r.sceneType!=e.sceneType&&"None"!=r.sceneType||i.push(r.eventHandler.handleAsync(e,t))}await Promise.all(i),t.dispose()}publish(e,t){const s=MoyeEventCenter.inst.allEvents.get(t.constructor);if(s){for(let i=0;i<s.length;i++){const o=s[i];o.sceneType!=e.sceneType&&"None"!=o.sceneType||o.eventHandler.handle(e,t)}t.dispose()}}}var __decorate$l=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};const{ccclass:ccclass$d,property:property$d}=_decorator;let MoyeRuntime=class extends Component{start(){director.addPersistRootNode(this.node)}update(e){Game.update(1e3*e)}lateUpdate(e){Game.lateUpdate(1e3*e),Game.frameFinishUpdate()}onDestroy(){Game.dispose()}};MoyeRuntime=__decorate$l([ccclass$d("MoyeRuntime")],MoyeRuntime);class TimeHelper{static clientNow(){return TimeInfo.get().clientNow()}static clientNowSeconds(){return Math.floor(TimeHelper.clientNow()/1e3)}static serverNow(){return TimeInfo.get().serverNow()}}var TimerType;TimeHelper.oneDay=864e5,TimeHelper.oneHour=36e5,TimeHelper.oneMinute=6e4,function(e){e[e.ONCE=0]="ONCE",e[e.REPEAT=1]="REPEAT"}(TimerType||(TimerType={}));class Timer{static create(){const e=ObjectPool.get().fetch(Timer);return e.reset(),e.id=Timer.getId(),e}static getId(){return++this._idGenerator}reset(){this.cb=null,this.tcs=null,this.id=0,this.expireTime=0,this.interval=0}dispose(){this.reset(),ObjectPool.get().recycle(this)}}Timer._idGenerator=1e3;class TimerMgr extends Singleton{constructor(){super(...arguments),this._timerMap=new Map,this._timers=[]}newRepeatedTimer(e,t,s=!1){const i=Timer.create();return i.type=TimerType.REPEAT,i.cb=t,i.interval=e,i.expireTime=e+TimeHelper.clientNow(),this._timerMap.set(i.id,i),this._timers.push(i),s&&t(),i.id}newOnceTimer(e,t){const s=Timer.create();return s.type=TimerType.ONCE,s.cb=t,s.expireTime=e+TimeHelper.clientNow(),this._timerMap.set(s.id,s),this._timers.push(s),s.id}newFrameTimer(e){const t=Timer.create();return t.type=TimerType.REPEAT,t.cb=e,t.interval=1,t.expireTime=t.interval+TimeHelper.clientNow(),this._timerMap.set(t.id,t),this._timers.push(t),t.id}remove(e){const t=this._timerMap.get(e);return!!t&&(t.id=0,this._timerMap.delete(e),!0)}update(){const e=TimeHelper.clientNow();for(let t=this._timers.length-1;t>=0;t--){const s=this._timers[t];0!=s.id?s.expireTime>e||(null!=s.cb&&s.cb(),null!=s.tcs&&s.tcs.setResult(),s.type==TimerType.REPEAT?s.expireTime+=s.interval:this.remove(s.id)):(this._timers.splice(t,1),s.dispose())}}async waitAsync(e,t){if(e<=0)return;const s=Task.create(),i=Timer.create();let o;i.type=TimerType.ONCE,i.tcs=s,i.expireTime=e+TimeHelper.clientNow(),this._timerMap.set(i.id,i),this._timers.push(i),t&&(o=()=>{this.remove(i.id)&&s.setResult()},t.add(o));try{await s}finally{t?.remove(o),o=null}}}const CoroutineLockTag="CoroutineLock";class CoroutineLockItem{init(e){this.key=e,this.task=Task.create(),Options.get().develop&&this.setTimeout(6e4,"CoroutineLock timeout")}setTimeout(e,t){this.deleteTimeout(),this._timerId=TimerMgr.get().newOnceTimer(e,this.timeout.bind(this)),this._timeoutInfo=t}deleteTimeout(){null!=this._timerId&&(TimerMgr.get().remove(this._timerId),this._timerId=null)}async timeout(){coreWarn("CoroutineLock","CoroutineLock timeout key: {0}, info: {1}",this.key,this._timeoutInfo)}dispose(){null!=this.key?(this.deleteTimeout(),CoroutineLock.get().runNextLock(this),this.key=null,this.task=null):coreWarn("CoroutineLock","repeat dispose CoroutineLockItem")}}class CoroutineLock extends Singleton{constructor(){super(...arguments),this._lockMap=new Map}async wait(e,t){const s=`${e}_${t}`;let i=this._lockMap.get(s);i||(i=new Set,this._lockMap.set(s,i));const o=ObjectPool.get().fetch(CoroutineLockItem);return o.init(s),i.add(o),i.size>1?await o.task:o.task.setResult(),o}runNextLock(e){const t=this._lockMap.get(e.key);t.delete(e),ObjectPool.get().recycle(e);for(const e of Array.from(t.values())){e.task.setResult();break}}}class SceneRefCom extends Entity{}class SceneFactory{static createClientScene(){const e=Root.get().scene.getCom(SceneRefCom);e.scene?.dispose();const t=new Scene;return t.init({id:1n,sceneType:SceneType.CLIENT,name:"Game",instanceId:IdGenerator.get().generateInstanceId(),parent:e}),t.addCom(SceneRefCom),e.scene=t,EventSystem.get().publish(t,AfterCreateClientScene.create()),t}static createCurrentScene(e,t){const s=Root.get().scene.getCom(SceneRefCom).scene.getCom(SceneRefCom);s.scene?.dispose();const i=new Scene;return i.init({id:e,sceneType:SceneType.CURRENT,name:t,instanceId:IdGenerator.get().generateInstanceId(),parent:s}),s.scene=i,EventSystem.get().publish(i,AfterCreateCurrentScene.create()),i}}class Program{static init(e){MoyeEventCenter.inst.publish(new BeforeProgramInit),Game.addSingleton(ObjectPool,!1),Game.addSingleton(Options),Game.addSingleton(Logger),Game.addSingleton(EventSystem),Game.addSingleton(TimeInfo),Game.addSingleton(TimerMgr),Game.addSingleton(CoroutineLock),Game.addSingleton(IdGenerator),Game.addSingleton(EntityCenter),Game.addSingleton(EntityLifiCycleMgr),Game.addSingleton(Root),e.addComponent(MoyeRuntime),MoyeEventCenter.inst.publish(new AfterProgramInit)}static start(){MoyeEventCenter.inst.reloadEvent(),MoyeEventCenter.inst.publish(new BeforeProgramStart),MoyeEventCenter.inst.publish(new AfterProgramStart),Root.get().scene.addCom(SceneRefCom),SceneFactory.createClientScene()}}async function safeCall(e){try{return await e}catch(e){coreError("safeCall",e)}}const EventHandlerTag="EventHandler";class AEventHandler{async handleAsync(e,t){try{await this.run(e,t)}catch(e){coreError("EventHandler","error:{0}",e.stack)}}handle(e,t){try{const s=this.run(e,t);s instanceof Promise&&(coreWarn("EventHandler","{0}的run方法是异步的, 请尽量不要用publish来通知",this.constructor.name),safeCall(s))}catch(e){coreError("EventHandler","error:{0}",e.stack)}}}const CancellationTokenTag="CancellationToken";class CancellationToken{constructor(){this._actions=new Set}add(e){null!=e?this._actions.add(e):coreError("CancellationToken","CancellationToken add error, callback is null")}remove(e){this._actions?.delete(e)}cancel(){null!=this._actions?this.invoke():coreError("CancellationToken","CancellationToken cancel error, repeat cancel")}isCancel(){return null==this._actions}invoke(){const e=this._actions;this._actions=null;try{for(const t of e)t();e.clear()}catch(e){coreError("CancellationToken",e)}}}class MultiMap{constructor(){this._empty=[],this._map=new Map}add(e,t){let s=this._map.get(e);void 0===s&&(s=[],this._map.set(e,s)),s.push(t)}remove(e,t){const s=this._map.get(e);if(void 0===s)return!1;const i=s.indexOf(t);return-1!==i&&(s.splice(i,1),0===s.length&&this._map.delete(e),!0)}getAll(e){const t=this._map.get(e);return void 0===t?[]:t}get(e){return this._map.get(e)??this._empty}getOne(e){const t=this._map.get(e);if(void 0!==t&&t.length>0)return t[0]}contains(e,t){const s=this._map.get(e);return void 0!==s&&s.includes(t)}}Entity.prototype.clientScene=function(){const e=this.domainScene();return e.sceneType==SceneType.CLIENT?e:e.sceneType==SceneType.CURRENT?e.parent.parent:e.sceneType==SceneType.PROCESS?e.getCom(SceneRefCom).scene:void 0},Entity.prototype.currentScene=function(){return this.clientScene().getCom(SceneRefCom).scene};class EventAutoReleaseCom extends Entity{constructor(){super(...arguments),this.events=[]}addItem(e){this.events.push(e)}destroy(){const e=this.eventCom.eventMap;for(const t of this.events){e.get(t.eventType).delete(t),t.entity=null,t.handler=null,t.eventType=null,t.dispose()}this.events=null,this.eventCom=null}}class EventItem extends RecycleObj{}class EventCom extends Entity{constructor(){super(...arguments),this._eventMap=new Map}destroy(){const e=this._eventMap;for(const t of e.values()){for(const e of t)e.entity=null,e.handler=null,e.eventType=null,e.dispose();t.clear()}e.clear()}subscribe(e,t,s){const i=EventItem.create({entity:s,handler:t,eventType:e});let o=this._eventMap.get(e);o||(o=new Set,this._eventMap.set(e,o)),o.add(i);let r=s.getCom(EventAutoReleaseCom);r||(r=s.addCom(EventAutoReleaseCom),r.eventCom=this),r.addItem(i)}publish(e,...t){const s=this._eventMap.get(e);if(s)for(const e of s)e.handler.apply(e.entity,t)}}class LocalStorageHelper{static getNumber(e,t){const s=localStorage.getItem(e);if(!s)return t;try{return Number(s)}catch(e){return t}}static setNumber(e,t){localStorage.setItem(e,t.toString())}static getString(e,t){const s=localStorage.getItem(e);return s||t}static setString(e,t){localStorage.setItem(e,t)}static setBoolean(e,t){localStorage.setItem(e,t?"1":"0")}static getBoolean(e,t){const s=localStorage.getItem(e);return s?"1"==s:t}static setObject(e){localStorage.setItem(e.constructor.name,JSON.stringify(e))}static getObject(e){const t=localStorage.getItem(e.name);if(!t)return null;try{return JSON.parse(t)}catch(e){return null}}}class LoginCom extends Entity{constructor(){super(...arguments),this._isLogin=!1,this._isReconnecting=!1,this._reLoginTryMaxCount=3}registerExecutor(e){this._loginExecutor=e}async login(e){const t=await this._loginExecutor.login(this.domainScene(),e);return 0==t&&(this._isLogin=!0,this._loginArgs=e),t}}class AfterAddLoginCom extends AEvent{}var __decorate$k=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};let AfterCreateClientSceneHandler$1=class extends AEventHandler{run(e,t){e.addCom(LoginCom),EventSystem.get().publish(e,new AfterAddLoginCom)}};AfterCreateClientSceneHandler$1=__decorate$k([EventDecorator(AfterCreateClientScene,SceneType.CLIENT)],AfterCreateClientSceneHandler$1);class MsgMgr extends Singleton{constructor(){super(...arguments),this._responseTypeMap=new Set,this._typeOpcodeMap=new Map,this._opcodeTypeMap=new Map}awake(){}register(e,t,s=!1){this._typeOpcodeMap.set(e,t),this._opcodeTypeMap.set(t,e),s&&this._responseTypeMap.add(t)}isResponse(e){return this._responseTypeMap.has(e)}getOpcode(e){return this._typeOpcodeMap.get(e)}getType(e){return this._opcodeTypeMap.get(e)}}class MsgSerializeMgr extends Singleton{register(e){this._serialize=e}serialize(e,t){return this._serialize.encode(e,t)}deserialize(e){return this._serialize.decode(e)}}var __decorate$j=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};let AfterSingletonAddHandler=class extends AEventHandler{run(e,t){if(t.singletonType===MsgMgr)Game.addSingleton(MsgSerializeMgr)}};AfterSingletonAddHandler=__decorate$j([EventDecorator(AfterSingletonAdd,SceneType.PROCESS)],AfterSingletonAddHandler);const MsgHandlerDecoratorType="MsgHandlerDecorator";function MsgHandlerDecorator(e){return function(t){DecoratorCollector.inst.add("MsgHandlerDecorator",t,e)}}class MessageDispatcherMgr extends Singleton{constructor(){super(...arguments),this._handlers=new Map}awake(){const e=DecoratorCollector.inst.get("MsgHandlerDecorator");for(const t of e){const e=t[0],s=t[1],i=new e;this._handlers.has(s)||this._handlers.set(s,[]),this._handlers.get(s).push(i)}}destroy(){this._handlers.clear()}handle(e,t){const s=t.constructor,i=this._handlers.get(s);if(i)for(const s of i)s.handle(e,t);else console.error("[MessageDispatcherMgr] msg not found handler",t)}}var __decorate$i=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};let BeforeProgramStartHandler=class extends AEventHandler{run(e,t){Game.addSingleton(MsgMgr),Game.addSingleton(MessageDispatcherMgr)}};BeforeProgramStartHandler=__decorate$i([EventDecorator(BeforeProgramStart,SceneType.PROCESS)],BeforeProgramStartHandler);class NetClientComponentOnRead extends AEvent{}var __decorate$h=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};let NetClientComponentOnReadEvent=class extends AEventHandler{run(e,t){t.session;t.data;Uint8Array}};NetClientComponentOnReadEvent=__decorate$h([EventDecorator(NetClientComponentOnRead,SceneType.CLIENT)],NetClientComponentOnReadEvent);const NetworkTag="Network";class NetServices extends Singleton{constructor(){super(...arguments),this._acceptIdGenerator=Number.MAX_SAFE_INTEGER-1,this._services=new Map,this._serviceIdGenerator=0,this._acceptCallback=new Map,this._readCallback=new Map,this._errorCallback=new Map}sendMessage(e,t,s){const i=this.get(e);null!=i&&i.send(t,s)}addService(e){return e.id=++this._serviceIdGenerator,this.add(e),e.id}removeService(e){this.remove(e)}createChannel(e,t,s){const i=this.get(e);null!=i&&i.create(t,s)}removeChannel(e,t,s){const i=this.get(e);null!=i&&i.remove(t,s)}registerAcceptCallback(e,t){this._acceptCallback.set(e,t)}registerReadCallback(e,t){this._readCallback.set(e,t)}registerErrorCallback(e,t){this._errorCallback.has(e)&&coreError("Network","重复注册servece的errorCallback, serviceId={0}",e),this._errorCallback.set(e,t)}onAccept(e,t,s){const i=this._acceptCallback.get(e);i&&i(t,s)}onRead(e,t,s){const i=this._readCallback.get(e);i&&i(t,s)}onError(e,t,s){const i=this._errorCallback.get(e);i&&i(t,s)}get(e){return this._services.get(e)}createAcceptChannelId(){return--this._acceptIdGenerator}add(e){this._services.set(e.id,e)}remove(e){const t=this._services.get(e);t&&t.dispose()}}var __decorate$g=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};let AfterProgramInitHandler$1=class extends AEventHandler{run(e,t){Game.addSingleton(NetServices)}};AfterProgramInitHandler$1=__decorate$g([EventDecorator(AfterProgramInit,SceneType.PROCESS)],AfterProgramInitHandler$1);class NetworkErrorCode{}NetworkErrorCode.ERR_SendMessageNotFoundChannel=1,NetworkErrorCode.ERR_ChannelReadError=2,NetworkErrorCode.ERR_WebSocketError=3;class IPEndPoint{constructor(e,t=0){if(0==t){const t=e.split(":");this.host=t[0],this.port=parseInt(t[1])}else this.host=e,this.port=t}toString(){return`${this.host}:${this.port}`}}var ServiceType;!function(e){e[e.Outer=0]="Outer",e[e.Inner=1]="Inner"}(ServiceType||(ServiceType={}));class AChannel{constructor(){this.id=0n}get isDisposed(){return 0n==this.id}}const NetworkWebsocketTag="WService";class WChannel extends AChannel{constructor(){super(...arguments),this._isConnected=!1,this._msgQueue=[]}initByAddress(e,t,s){this.wSocket=new WebSocket(`ws://${e}`),this.wSocket.binaryType="arraybuffer",this.id=t,this._service=s,this.remoteAddress=e,this.wSocket.onopen=this.onConnectComplete.bind(this),this.wSocket.onclose=this.onSocketClose.bind(this),this.wSocket.onerror=this.onWsSocketError.bind(this),this.wSocket.onmessage=this.onMessage.bind(this)}onConnectComplete(){this._isConnected=!0;for(const e of this._msgQueue)this.innerSend(e);this._msgQueue=[]}onMessage(e){try{const t=this.id;NetServices.get().onRead(this._service.id,t,e.data)}catch(e){coreError("WService","Channel onMessage, remoteAddress={1} error={0}",e.stack,this.remoteAddress.toString()),this.onError(NetworkErrorCode.ERR_ChannelReadError)}}dispose(){this.isDisposed||(this.id=0n,this.wSocket=null,this._msgQueue=null,this._service=null,this._isConnected=!1,this.remoteAddress=null)}onWsSocketError(e){this.onSocketClose(NetworkErrorCode.ERR_WebSocketError)}onSocketClose(e){this._service&&this._service.channelClose(this,e)}closeSocket(e){e<4e3?null!=this.wSocket&&this.wSocket.close():null!=this.wSocket&&this.wSocket.close(e)}onError(e){this._service.remove(this.id,e)}innerSend(e){this.wSocket.send(e)}send(e){this.isDisposed||(this._isConnected?this.innerSend(e):this._msgQueue.push(e))}}class AService{}class WService extends AService{constructor(){super(...arguments),this._idChannels=new Map}initSender(e){this.serviceType=e}send(e,t){const s=this._idChannels.get(e);null!=s?s.send(t):NetServices.get().onError(this.id,e,NetworkErrorCode.ERR_SendMessageNotFoundChannel)}create(e,t){this._idChannels.has(e)||this.innerCreate(e,t)}remove(e,t){const s=this._idChannels.get(e);s&&(s.closeSocket(t),this._idChannels.delete(e),s.dispose())}dispose(){}innerCreate(e,t){const s=new WChannel;s.initByAddress(t,e,this),this._idChannels.set(s.id,s)}channelClose(e,t){this._idChannels.delete(e.id),NetServices.get().onError(this.id,e.id,t),e.dispose()}}class NetComReadEvent extends AEvent{}const MessageTag="Message";class MessageErrorCode extends NetworkErrorCode{}MessageErrorCode.ERR_SessionDisposed=101;class RpcResponse{constructor(e){Object.assign(this,e)}}class Session extends Entity{constructor(){super(...arguments),this.requestCallbacks=new Map,this.error=0}init(e){this.serviceId=e;const t=TimeHelper.clientNow();this.lastRecvTime=t,this.lastSendTime=t}onResponse(e){const t=this.requestCallbacks.get(e.rpcId);t&&(this.requestCallbacks.delete(e.rpcId),t.setResult(e))}send(e){if(this.isDisposed)coreLog("Message","session已经销毁,不能发送消息, message={0}, sessionId={1}",e.constructor.name,this.id);else try{const t=MsgMgr.get().getOpcode(e.constructor),s=MsgSerializeMgr.get().serialize(t,e);this.lastSendTime=TimeHelper.clientNow(),NetServices.get().sendMessage(this.serviceId,this.id,s)}catch(e){coreError("Message","session send error={0}",e.stack)}}async call(e){if(this.isDisposed){coreLog("Message","session已经销毁,不能发送消息, message={0}, sessionId={1}",e.constructor.name,this.id);return new RpcResponse({error:MessageErrorCode.ERR_SessionDisposed})}const t=++Session._rpcId,s=Task.create();this.requestCallbacks.set(t,s),e.rpcId=t,this.send(e);return await s}destroy(){if(this.error>0&&NetServices.get().onError(this.serviceId,this.id,this.error),NetServices.get().removeChannel(this.serviceId,this.id,this.error),this.requestCallbacks.size>0){const e=new RpcResponse({error:MessageErrorCode.ERR_SessionDisposed});for(const[t,s]of this.requestCallbacks)s.setResult(e);this.requestCallbacks.clear()}}}Session._rpcId=0;class NetCom extends Entity{awake(){const e=new WService;e.initSender(ServiceType.Outer);const t=NetServices.get();this.serviceId=t.addService(e),t.registerReadCallback(this.serviceId,this.onRead.bind(this)),t.registerErrorCallback(this.serviceId,this.onError.bind(this))}destroy(){NetServices.get().removeService(this.serviceId)}onRead(e,t){const s=this.getChild(Session,e);if(null==s)return;s.lastRecvTime=TimeHelper.clientNow();const i=NetComReadEvent.create({data:t,session:s});EventSystem.get().publish(this.domainScene(),i)}onError(e,t){const s=this.getChild(Session,e);null!=s&&(s.error=t,s.dispose())}create(e){const t=this.addChild(Session);return t.init(this.serviceId),t.remoteAddress=e,NetServices.get().createChannel(this.serviceId,t.id,e),t}}class SessionCom extends Entity{destroy(){this.session?.dispose(),this.session=null}}var __decorate$f=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};let AfterCreateClientSceneHandler=class extends AEventHandler{run(e,t){e.addCom(NetCom),e.addCom(SessionCom)}};AfterCreateClientSceneHandler=__decorate$f([EventDecorator(AfterCreateClientScene,SceneType.CLIENT)],AfterCreateClientSceneHandler);var __decorate$e=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};let NetComReadEventHandler=class extends AEventHandler{run(e,t){const s=t.session,i=t.data,[o,r]=MsgSerializeMgr.get().deserialize(i);MsgMgr.get().isResponse(o)?s.onResponse(r):MessageDispatcherMgr.get().handle(s,r)}};NetComReadEventHandler=__decorate$e([EventDecorator(NetComReadEvent,SceneType.CLIENT)],NetComReadEventHandler);class AMHandler{handle(e,t){if(!e.isDisposed){const s=this.run(e,t);s instanceof Promise&&(coreWarn("AMHandler","{0}.run 请不要使用异步, 因为异步没办法保证消息接收后的处理顺序",this.constructor.name),safeCall(s))}}}class AssetInfo{init(e,t){const s=(t=this.parseLocation(e,t)).split("/");let i="";for(let e=1;e<s.length;e++)i+=s[e],e!=s.length-1&&(i+="/");this.bundleName=s[0],this.assetPath=i,this.assetType=e,this.uuid=`${t}.${e.name}`}parseLocation(e,t){return e==SpriteFrame?t.endsWith("spriteFrame")||(t+="/spriteFrame"):e==Texture2D&&(t.endsWith("texture")||(t+="/texture")),t}}class AssetSystem{constructor(){this._waitLoads=[],this._loadingSet=new Set,this._frameAddCount=0}update(){this._frameAddCount=0,this.updateLoadingSet()}addProvider(e){this._waitLoads.push(e),this.updateLoadingSet()}updateLoadingSet(){if(this._frameAddCount>=AssetSystem._frameMaxAddQueueProvider)return;if(this._loadingSet.size>=AssetSystem._maxLoadingProvider)return;if(0==this._waitLoads.length)return;const e=this._waitLoads.shift();this._loadingSet.add(e),e.internalLoad()}removeProvider(e){this._loadingSet.delete(e),this.updateLoadingSet()}}AssetSystem._maxLoadingProvider=1,AssetSystem._frameMaxAddQueueProvider=1;const MoyeAssetTag="MoyeAsset";class AssetOperationHandle{constructor(){this.isDisposed=!1}getAsset(e){return this.provider.asset}dispose(){this.isDisposed?coreError("MoyeAsset","重复销毁AssetOperationHandle"):(this.isDisposed=!0,this.provider.releaseHandle(this))}instantiateSync(){return instantiate(this.provider.asset)}async instantiateAsync(){return instantiate(this.provider.asset)}}class BundleAssetProvider{constructor(){this.refCount=0,this._handleSet=new Set}async internalLoad(){const e=this.assetInfo.assetPath,t=this.assetInfo.assetType;this.bundleAsset.bundle.load(e,t,((e,t)=>{e?coreError("MoyeAsset","加载资源错误:{0},{1}",this.assetInfo.uuid,e):this.asset=t,this._task.setResult(),this.assetSystem.removeProvider(this)}))}async load(){this._task=Task.create(),this.assetSystem.addProvider(this),await this._task}createHandle(){this.refCount++;const e=new AssetOperationHandle;return e.provider=this,this._handleSet.add(e),e}releaseHandle(e){this.refCount<=0&&coreWarn("MoyeAsset","Asset provider reference count is already zero. There may be resource leaks !"),0==this._handleSet.delete(e)&&coreError("MoyeAsset","Should never get here !"),this.refCount--}}var AssetLockType;!function(e){e.BUNDLE_ASSET_LOAD="bundle_asset_load",e.BUNDLE_LOAD="bundle_load"}(AssetLockType||(AssetLockType={}));class BundleAsset{constructor(){this.refCount=0,this.isAutoRelease=!0,this._providerMap=new Map}async loadAssetAsync(e){let t=this._providerMap.get(e.uuid);t||(t=await this.createProvider(e));return t.createHandle()}async createProvider(e){const t=await CoroutineLock.get().wait(AssetLockType.BUNDLE_ASSET_LOAD,e.uuid);try{let t=this._providerMap.get(e.uuid);return t||(t=new BundleAssetProvider,t.assetInfo=e,t.assetSystem=this.assetSystem,t.bundleAsset=this,this.refCount++,await t.load(),this._providerMap.set(e.uuid,t),t)}finally{t.dispose()}}unloadUnusedAssets(){for(const[e,t]of this._providerMap)0==t.refCount&&(this.bundle.release(t.assetInfo.assetPath,t.assetInfo.assetType),this._providerMap.delete(e),this.refCount--)}}class MoyeAssets extends Singleton{awake(){MoyeAssets.assetSystem=new AssetSystem}update(){MoyeAssets.assetSystem.update()}static async loadAssetAsync(e,t){try{const s=new AssetInfo;s.init(e,t);const i=s.bundleName;let o=MoyeAssets._bundleMap.get(i);o||(o=await this.loadBundleAsync(i));return await o.loadAssetAsync(s)}catch(e){coreError("MoyeAsset",e)}}static async loadBundleAsync(e){const t=await CoroutineLock.get().wait(AssetLockType.BUNDLE_LOAD,e);try{let t=MoyeAssets._bundleMap.get(e);if(t)return t;const s=Task.create();if(!this._bundlePathMap.has(e)&&(this._bundlePathMap.set(e,e),NATIVE)){const t=`${native.fileUtils.getWritablePath()}hot/${e}`;native.fileUtils.isDirectoryExist(t)&&this._bundlePathMap.set(e,t)}const i=this._bundlePathMap.get(e);coreLog("MoyeAsset","加载bundle: {0}",i),assetManager.loadBundle(i,((t,i)=>{t?coreLog("MoyeAsset","加载Bundle错误, bundle={0}, error={1}",e,t):coreLog("MoyeAsset","加载Bundle完成, bundle={0}",e),s.setResult(i)}));const o=await s;return t=new BundleAsset,t.bundle=o,t.bundleName=e,t.assetSystem=MoyeAssets.assetSystem,MoyeAssets._bundleMap.set(e,t),t}finally{t.dispose()}}static releaseBundle(e){0==e.refCount?(this._bundleMap.delete(e.bundleName),assetManager.removeBundle(e.bundle),coreLog("MoyeAsset","卸载bundle:{0}",e.bundleName)):coreError("MoyeAsset","释放的bundle:{0}, 引用计数不为0",e.bundleName)}static unloadUnusedAssets(){for(const[e,t]of this._bundleMap)0==t.refCount&&t.isAutoRelease&&(t.unloadUnusedAssets(),MoyeAssets.releaseBundle(t))}}MoyeAssets._bundleMap=new Map,MoyeAssets._bundlePathMap=new Map;var __decorate$d=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};let AfterProgramInitHandler=class extends AEventHandler{run(e,t){Game.addSingleton(MoyeAssets)}};var WaitError;AfterProgramInitHandler=__decorate$d([EventDecorator(AfterProgramInit,SceneType.NONE)],AfterProgramInitHandler),function(e){e[e.SUCCESS=0]="SUCCESS",e[e.DESTROY=1]="DESTROY",e[e.CANCEL=2]="CANCEL",e[e.TIMEOUT=3]="TIMEOUT"}(WaitError||(WaitError={}));class AWait extends RecycleObj{constructor(){super(...arguments),this.error=WaitError.SUCCESS}}class ObjectWait extends Entity{constructor(){super(...arguments),this._tasks=new Map}destroy(){for(const[e,t]of this._tasks){const t=this.createWaitInstance(e,WaitError.DESTROY);this.notify(t)}}async wait(e,t){this.cancelLastWait(e);const s=Task.create(e);let i,o;this._tasks.set(e,s),t&&(i=()=>{const t=this.createWaitInstance(e,WaitError.CANCEL);this.notify(t)},t.add(i));try{o=await s}finally{t?.remove(i),i=null}return o}async waitWithTimeout(e,t,s){this.cancelLastWait(e);const i=Task.create(e);let o,r;this._tasks.set(e,i),this.timeoutRun(e,t,s),s&&(o=()=>{const t=this.createWaitInstance(e,WaitError.CANCEL);this.notify(t)},s.add(o));try{r=await i}finally{s?.remove(o),o=null}return r}cancelLastWait(e){if(!this._tasks.has(e))return;coreWarn("上一个wait已经取消, {0}",e.name);const t=this.createWaitInstance(e,WaitError.CANCEL);this.notify(t)}async timeoutRun(e,t,s){if(await TimerMgr.get().waitAsync(t,s),s?.isCancel())return;if(!this._tasks.has(e))return;const i=this.createWaitInstance(e,WaitError.TIMEOUT);this.notify(i)}createWaitInstance(e,t){const s=e.create();return s.error=t,s}notify(e){const t=this._tasks.get(e.constructor);t&&(this._tasks.delete(e.constructor),t.setResult(e),e.dispose())}}class AsyncButtonListener{constructor(e){this._callback=e}async invoke(...e){this._isClick||(this._isClick=!0,await this._callback(...e),this._isClick=!1)}static create(e){const t=new AsyncButtonListener(e);return t.invoke.bind(t)}}var __decorate$c=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};const{ccclass:ccclass$c,property:property$c,menu:menu$b}=_decorator;let BgAdapter=class extends Component{constructor(){super(...arguments),this.coverNode=null,this.isShowMax=!0,this._selfTransform=null}start(){this._selfTransform=this.node.getComponent(UITransform),this.updateSize(),this.coverNode.node.on(Node.EventType.SIZE_CHANGED,this.updateSize,this)}onDestroy(){this.coverNode.node.off(Node.EventType.SIZE_CHANGED,this.updateSize,this),this.coverNode=null,this._selfTransform=null}updateSize(){let e=0;e=this.isShowMax?Math.max(this.coverNode.width/this._selfTransform.width,this.coverNode.height/this._selfTransform.height):Math.min(this.coverNode.width/this._selfTransform.width,this.coverNode.height/this._selfTransform.height);const t=this._selfTransform.width*e,s=this._selfTransform.height*e;this._selfTransform.width=t,this._selfTransform.height=s}};__decorate$c([property$c(UITransform)],BgAdapter.prototype,"coverNode",void 0),__decorate$c([property$c(CCBoolean)],BgAdapter.prototype,"isShowMax",void 0),BgAdapter=__decorate$c([ccclass$c("BgAdapter"),menu$b("moye/BgAdapter")],BgAdapter);var __decorate$b=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};const{ccclass:ccclass$b,inspector:inspector$1,property:property$b,disallowMultiple:disallowMultiple$1,menu:menu$a}=_decorator;var CenterHorizontalDirection;!function(e){e[e.LEFT_TO_RIGHT=0]="LEFT_TO_RIGHT",e[e.RIGHT_TO_LEFT=1]="RIGHT_TO_LEFT",e[e.CENTER_TO_SIDE=2]="CENTER_TO_SIDE"}(CenterHorizontalDirection||(CenterHorizontalDirection={}));let CenterLayout=class extends Layout{constructor(){super(...arguments),this.centerHorizontalDirection=CenterHorizontalDirection.CENTER_TO_SIDE}_doLayoutHorizontally(e,t,s,i){const o=this.node._uiProps.uiTransformComp.anchorPoint,r=this._getFixedBreakingNum();let n=1,a=this._paddingLeft;this._horizontalDirection===Layout.HorizontalDirection.RIGHT_TO_LEFT&&(n=-1,a=this._paddingRight);const c=(this._horizontalDirection-o.x)*e+n*a;let l=c-n*this._spacingX,h=0,d=0,p=0,_=0,u=!1;const g=this._usefulLayoutObj.length;let y=this._cellSize.width;const m=this._getPaddingH();this._layoutType!==Layout.Type.GRID&&this._resizeMode===Layout.ResizeMode.CHILDREN&&(y=(e-m-(g-1)*this._spacingX)/g);const T=this._usefulLayoutObj;for(let a=0;a<T.length;++a){const g=T[a],f=g.node,C=f.scale,E=this._getUsedScaleValue(C.x),S=this._getUsedScaleValue(C.y);this._resizeMode===Layout.ResizeMode.CHILDREN&&(g.width=y/E,this._layoutType===Layout.Type.GRID&&(g.height=this._cellSize.height/S));const v=Math.abs(this._horizontalDirection-g.anchorX),I=g.width*E,w=g.height*S;w>p&&(_=Math.max(p,_),d=p||w,p=w),l+=n*(v*I+this._spacingX);const D=n*(1-v)*I;if(t){if(r>0)u=a/r>0&&a%r==0,u&&(d=p>w?p:d);else if(I>e-m)l>c+n*(v*I)&&(u=!0);else{const t=(1-this._horizontalDirection-o.x)*e,s=l+D+n*(n>0?this._paddingRight:this._paddingLeft);u=Math.abs(s)>Math.abs(t)}u&&(l=c+n*(v*I),w!==p&&(d=p),h+=d+this._spacingY,d=p=w)}const M=s(f,g,h);i&&f.setPosition(l,M),l+=D}d=Math.max(d,p);const f=Math.max(_,h+d)+this._getPaddingV();if(T.length>0&&this.centerHorizontalDirection==CenterHorizontalDirection.CENTER_TO_SIDE){const t=(.5-o.x)*e;let s=0,i=-1,r=Number.MIN_SAFE_INTEGER;n=-1;for(let c=T.length-1;c>=0;c--){const l=T[c],h=this._getUsedScaleValue(l.node.scale.x),d=l.getComponent(UITransform).anchorX,p=l.getComponent(UITransform).width*h;if(Math.abs(l.node.position.y-r)>1){r=l.node.position.y,s=l.node.position.x+(1-d)*p+this.paddingRight,s=e*o.x+s;i=t+.5*s+n*a-n*this.spacingX}if(!l.node.activeInHierarchy)continue;i=i+n*d*p+n*this.spacingX,l.node.setPosition(new Vec3(i,l.node.position.y,0));i+=n*(1-d)*p}}return f}_getUsedScaleValue(e){return this.affectedByScale?Math.abs(e):1}};__decorate$b([property$b({type:Enum(CenterHorizontalDirection)})],CenterLayout.prototype,"centerHorizontalDirection",void 0),CenterLayout=__decorate$b([ccclass$b("CenterLayout"),disallowMultiple$1(),menu$a("moye/CenterLayout")],CenterLayout);var __decorate$a=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};const{ccclass:ccclass$a,inspector:inspector,property:property$a,disallowMultiple:disallowMultiple,menu:menu$9}=_decorator;let MoyeLabel=class extends Label{constructor(){super(...arguments),this._tempString="",this._clearOnRun=!1}set clearOnRun(e){e!=this._clearOnRun&&(this._clearOnRun=e,this.string=e?this._string:this._tempString)}get clearOnRun(){return this._clearOnRun}set string(e){this.clearOnRun&&EDITOR?(this._tempString=e,this._string=" ",this.markForUpdateRenderData()):super.string=e}get string(){return this.clearOnRun&&EDITOR?this._tempString:this._string}};__decorate$a([property$a({editorOnly:!0})],MoyeLabel.prototype,"_tempString",void 0),__decorate$a([property$a],MoyeLabel.prototype,"_clearOnRun",void 0),__decorate$a([property$a({type:CCBoolean,displayName:"运行时清空",tooltip:"运行时清空"})],MoyeLabel.prototype,"clearOnRun",null),MoyeLabel=__decorate$a([ccclass$a("MoyeLabel"),disallowMultiple(),menu$9("moye/MoyeLabel")],MoyeLabel);var __decorate$9=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};const{ccclass:ccclass$9,property:property$9,menu:menu$8}=_decorator;let RichTextListener=class extends Component{constructor(){super(...arguments),this._cbs=[]}onDestroy(){this._cbs=[]}onClicked(e,t){for(const e of this._cbs)e(t)}addListener(e){this._cbs.push(e)}};RichTextListener=__decorate$9([ccclass$9("RichTextListener"),menu$8("moye/RichTextListener")],RichTextListener);const ViewDecoratorType="ViewDecorator";function ViewDecorator(e,t,s){return function(i){DecoratorCollector.inst.add("ViewDecorator",i,e,t,s)}}var ViewLayer;!function(e){e[e.SCENE=1]="SCENE",e[e.BACKGROUND=2]="BACKGROUND",e[e.NORMAL=3]="NORMAL",e[e.INFO=4]="INFO",e[e.TIPS=5]="TIPS",e[e.TOP=6]="TOP"}(ViewLayer||(ViewLayer={}));class ViewCleanCom extends Entity{constructor(){super(...arguments),this._views=new Set}init(e){return this._viewMgr=e,this}add(e){this._views.add(e)}remove(e){this._views.delete(e)}destroy(){for(const e of this._views)this._viewMgr.hide(e)}}const MoyeViewTag="MoyeView",viewLoadLock="MoyeViewLoadLock";class MoyeViewMgr extends Entity{constructor(){super(...arguments),this._views=new Map,this._type2Names=new Map,this._showingViews=new Set,this._hideViews=new Set,this._viewCfgs=new Map,this._layers=new Map,this._checkInterval=5e3}awake(){MoyeViewMgr.inst=this}destroy(){null!=this._checkTimerId&&(TimerMgr.get().remove(this._checkTimerId),this._checkTimerId=null),MoyeViewMgr.inst=null}init(e,t){return null!=this._uiRoot?coreError("MoyeView","MoyeViewMgr is already inited"):(this._uiRoot=e,this._globalViewCfgType=t,this.reload(),this._checkTimerId=TimerMgr.get().newRepeatedTimer(this._checkInterval,this.check.bind(this)),this)}async show(e,t){let s;if(s="string"==typeof e?e:this._type2Names.get(e),JsHelper.isNullOrEmpty(s))return void coreError("MoyeView","MoyeView name is null or empty, name={0}",s);const i=await CoroutineLock.get().wait(viewLoadLock,s);coreLog("MoyeView","show view, name={0}",s);try{if(null==this._uiRoot)throw new Error("MoyeViewMgr is not inited");if(this._showingViews.has(s)){return this._views.get(s)}if(this._views.has(s)){const e=this._views.get(s);return await this.enterViewShow(e,t),e}const e=this._viewCfgs.get(s),i=await e.load(s),o=this.getLayerNode(e.layer);i.parent=o;const r=this.addCom(e.viewType);return r.node=i,r.layer=e.layer,r.viewName=s,r.onLoad?.(),r._viewMgr=this,this._views.set(s,r),await this.enterViewShow(r,t),r}catch(e){coreError("MoyeView","show view errr, {0}",e.stack)}finally{i.dispose()}}async hide(e){const t=await CoroutineLock.get().wait(viewLoadLock,e);coreLog("MoyeView","hide view, name={0}",e);try{if(!this._showingViews.has(e))return;const t=this._views.get(e);await this.enterViewHide(t)}catch(e){coreError("MoyeView","hide view errr, {0}",e.stack)}finally{t.dispose()}}getView(e){let t;if(t="string"==typeof e?e:this._type2Names.get(e),this._showingViews.has(t)){return this._views.get(t)}}reload(){const e=DecoratorCollector.inst.get("ViewDecorator");for(const t of e){const e=t[0],s=t[1],i=t[2],o=t[3];if(this._viewCfgs.has(s))continue;let r;r=null!=o?new o:new this._globalViewCfgType,r.layer=i,r.name=s,r.viewType=e,r.cleanEntitys=new Set,this._type2Names.set(e,s),this._viewCfgs.set(s,r)}}check(){const e=TimeInfo.get().clientNow();for(const t of this._hideViews){e>=this._viewCfgs.get(t).expireTime&&this.enterViewDestroy(this._views.get(t))}}getLayerNode(e){let t=this._layers.get(e);if(null==t){t=new Node,t.name=ViewLayer[e],t.parent=this._uiRoot,t.setSiblingIndex(e),this._layers.set(e,t);const s=this._uiRoot.getComponent(UITransform).contentSize;t.addComponent(UITransform).setContentSize(s);const i=t.addComponent(Widget);i.top=0,i.bottom=0,i.left=0,i.right=0,i.alignMode=Widget.AlignMode.ON_WINDOW_RESIZE,i.isAlignBottom=!0,i.isAlignLeft=!0,i.isAlignRight=!0,i.isAlignTop=!0}return t}addToCleanCom(e,t){if(null==e)return;let s=e.getCom(ViewCleanCom);const i=this._viewCfgs.get(t);null==s&&(s=e.addCom(ViewCleanCom).init(this)),i.cleanEntitys.add(s),s.add(t)}async enterViewShow(e,t){e.node.active=!0,e.bringToFront();const s=this._viewCfgs.get(e.viewName);if(null!=s.doShowAnimation){const t=Task.create();s.doShowAnimation(e,t),await t}this._showingViews.add(e.viewName),this._hideViews.delete(e.viewName),this.addToCleanCom(t,e.viewName),e.onShow?.()}async enterViewHide(e){const t=this._viewCfgs.get(e.viewName);if(null!=t.doHideAnimation){const s=Task.create();t.doHideAnimation(e,s),await s}e.onHide?.(),e.node.active=!1,this._hideViews.add(e.viewName),this._showingViews.delete(e.viewName);for(const s of t.cleanEntitys)s.remove(e.viewName);t.cleanEntitys.clear(),t.expireTime=TimeInfo.get().clientNow()+t.expire}enterViewDestroy(e){e._realDispose(),e.node.destroy(),this._views.delete(e.viewName),this._hideViews.delete(e.viewName);this._viewCfgs.get(e.viewName).destroy()}}class AMoyeView extends Entity{_realDispose(){super.dispose()}dispose(){this._viewMgr.hide(this.viewName)}bringToFront(){this.node.setSiblingIndex(-1)}}var __decorate$8=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};const{ccclass:ccclass$8,property:property$8,executeInEditMode:executeInEditMode$3,menu:menu$7}=_decorator;let NodeNotBuild=class extends Component{constructor(){super(...arguments),this._destroyOnRun=!0}set destroyOnRun(e){this._destroyOnRun=e}get destroyOnRun(){return this._destroyOnRun}onLoad(){}onEnable(){EDITOR?this.node.hideFlags=this.node.hideFlags|CCObject.Flags.EditorOnly:this._destroyOnRun&&this.node.destroy()}onDisable(){this.node.hideFlags=this.node.hideFlags&~CCObject.Flags.EditorOnly}onDestroy(){this.node.hideFlags=this.node.hideFlags&~CCObject.Flags.EditorOnly}};__decorate$8([property$8],NodeNotBuild.prototype,"_destroyOnRun",void 0),__decorate$8([property$8({type:CCBoolean,tooltip:"运行时销毁节点",displayName:"运行时销毁节点"})],NodeNotBuild.prototype,"destroyOnRun",null),NodeNotBuild=__decorate$8([ccclass$8("NodeNotBuild"),menu$7("moye/NodeNotBuild"),executeInEditMode$3],NodeNotBuild);var __decorate$7=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};const{ccclass:ccclass$7,property:property$7,menu:menu$6}=_decorator;let SizeFollow=class extends Component{constructor(){super(...arguments),this._heightFollow=!0,this._widthFollow=!0,this._heightOffset=0,this._widthOffset=0,this._changeSize=new Size}get target(){return this._target}set target(e){this._target=e,this.updateSizeOffset()}set heightFollow(e){this._heightFollow=e,this.updateSizeOffset()}get heightFollow(){return this._heightFollow}set widthFollow(e){this._widthFollow=e,this.updateSizeOffset()}get widthFollow(){return this._widthFollow}onLoad(){null!=this._target&&this._target.node.on(NodeEventType.SIZE_CHANGED,this.onTargetSizeChange,this)}onDestroy(){null!=this._target&&(this._target.isValid?(this._target.node.off(NodeEventType.SIZE_CHANGED,this.onTargetSizeChange,this),this._target=null):this._target=null)}onTargetSizeChange(){const e=this.node.getComponent(UITransform),t=this._target;this._changeSize.set(e.contentSize),this._widthFollow&&(this._changeSize.width=Math.max(0,t.width+this._widthOffset)),this._heightFollow&&(this._changeSize.height=Math.max(0,t.height+this._heightOffset)),e.setContentSize(this._changeSize)}updateSizeOffset(){if(null==this._target)return;const e=this.node.getComponent(UITransform),t=this._target;if(this._widthFollow){const s=e.width,i=t.width;this._widthOffset=s-i}if(this._heightFollow){const s=e.height,i=t.height;this._heightOffset=s-i}}};__decorate$7([property$7({type:UITransform})],SizeFollow.prototype,"target",null),__decorate$7([property$7({type:UITransform})],SizeFollow.prototype,"_target",void 0),__decorate$7([property$7],SizeFollow.prototype,"heightFollow",null),__decorate$7([property$7],SizeFollow.prototype,"_heightFollow",void 0),__decorate$7([property$7],SizeFollow.prototype,"widthFollow",null),__decorate$7([property$7],SizeFollow.prototype,"_widthFollow",void 0),__decorate$7([property$7({type:CCFloat})],SizeFollow.prototype,"_heightOffset",void 0),__decorate$7([property$7({type:CCFloat})],SizeFollow.prototype,"_widthOffset",void 0),SizeFollow=__decorate$7([ccclass$7("SizeFollow"),menu$6("moye/SizeFollow")],SizeFollow);var __decorate$6=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};const{ccclass:ccclass$6,property:property$6,executeInEditMode:executeInEditMode$2,menu:menu$5}=_decorator;var WidgetBase,WidgetDirection;!function(e){e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.TOP=3]="TOP",e[e.BOTTOM=4]="BOTTOM"}(WidgetBase||(WidgetBase={})),function(e){e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.TOP=3]="TOP",e[e.BOTTOM=4]="BOTTOM",e[e.LEFT_EXTEND=5]="LEFT_EXTEND",e[e.RIGHT_EXTEND=6]="RIGHT_EXTEND",e[e.TOP_EXTEND=7]="TOP_EXTEND",e[e.BOTTOM_EXTEND=8]="BOTTOM_EXTEND"}(WidgetDirection||(WidgetDirection={}));let CTWidget=class extends Component{constructor(){super(...arguments),this._targetDir=WidgetDirection.TOP,this._dir=WidgetDirection.TOP,this.visibleOffset=0,this._isVertical=!0,this._distance=0,this._changePos=new Vec3(0,0,0),this._targetOldPos=new Vec3(0,0,0),this._targetOldSize=0,this._selfOldPos=new Vec3(0,0,0),this._selfOldSize=0}get target(){return this._target}set target(e){this._target=e,this.unregisterEvt(),this.registerEvt(),this.updateData()}set targetDir(e){if(EDITOR){if(e==WidgetDirection.LEFT||e==WidgetDirection.RIGHT){switch(this._dir){case WidgetDirection.TOP:case WidgetDirection.TOP_EXTEND:case WidgetDirection.BOTTOM:case WidgetDirection.BOTTOM_EXTEND:this._dir=WidgetDirection.LEFT}this._isVertical=!1}else{switch(this._dir){case WidgetDirection.LEFT:case WidgetDirection.LEFT_EXTEND:case WidgetDirection.RIGHT:case WidgetDirection.RIGHT_EXTEND:this._dir=WidgetDirection.TOP}this._isVertical=!0}this._targetDir=e,this.updateData()}}get targetDir(){return this._targetDir}set dir(e){if(EDITOR){switch(e){case WidgetDirection.LEFT:case WidgetDirection.LEFT_EXTEND:case WidgetDirection.RIGHT:case WidgetDirection.RIGHT_EXTEND:switch(this._targetDir){case WidgetDirection.TOP:case WidgetDirection.BOTTOM:this._targetDir=WidgetDirection.LEFT}this._isVertical=!1;break;case WidgetDirection.TOP:case WidgetDirection.TOP_EXTEND:case WidgetDirection.BOTTOM:case WidgetDirection.BOTTOM_EXTEND:switch(this._targetDir){case WidgetDirection.LEFT:case WidgetDirection.RIGHT:this._targetDir=WidgetDirection.TOP}this._isVertical=!0}this._dir=e,this.updateData()}}get dir(){return this._dir}onEnable(){EDITOR&&(this.registerEvt(),this.updateData())}onDisable(){EDITOR&&this.unregisterEvt()}onLoad(){this._trans=this.node.getComponent(UITransform),EDITOR||this.registerEvt()}onDestroy(){EDITOR||(this.unregisterEvt(),this._trans=null,this._target=null,this._changePos=null)}registerEvt(){this._target&&(EDITOR&&(this._target.node.on(NodeEventType.ANCHOR_CHANGED,this.updateData,this),this.node.on(NodeEventType.TRANSFORM_CHANGED,this.updateData,this),this.node.on(NodeEventType.SIZE_CHANGED,this.updateData,this)),this._target.node.on(NodeEventType.SIZE_CHANGED,this.onTargetChange,this),this._target.node.on(NodeEventType.TRANSFORM_CHANGED,this.onTargetChange,this),this._target.node.on(NodeEventType.ACTIVE_IN_HIERARCHY_CHANGED,this.onTargetChange,this))}unregisterEvt(){this._target&&this._target.isValid&&(EDITOR&&(this._target.node.off(NodeEventType.ANCHOR_CHANGED,this.updateData,this),this.node.off(NodeEventType.TRANSFORM_CHANGED,this.updateData,this),this.node.off(NodeEventType.SIZE_CHANGED,this.updateData,this)),this._target.node.off(NodeEventType.SIZE_CHANGED,this.onTargetChange,this),this._target.node.off(NodeEventType.TRANSFORM_CHANGED,this.onTargetChange,this),this._target.node.off(NodeEventType.ACTIVE_IN_HIERARCHY_CHANGED,this.onTargetChange,this))}updateData(){if(null!=this._target)switch(this._dir){case WidgetDirection.TOP:case WidgetDirection.BOTTOM:case WidgetDirection.LEFT:case WidgetDirection.RIGHT:this.updateDistance();break;case WidgetDirection.TOP_EXTEND:case WidgetDirection.BOTTOM_EXTEND:case WidgetDirection.LEFT_EXTEND:case WidgetDirection.RIGHT_EXTEND:this.updateTargetPos()}}onTargetChange(){if(null!=this._target)switch(this._dir){case WidgetDirection.TOP:case WidgetDirection.BOTTOM:case WidgetDirection.LEFT:case WidgetDirection.RIGHT:this.updatePos();break;case WidgetDirection.TOP_EXTEND:case WidgetDirection.BOTTOM_EXTEND:case WidgetDirection.LEFT_EXTEND:case WidgetDirection.RIGHT_EXTEND:this.updateSize()}}updateSize(){if(this._isVertical){const e=this._targetOldPos.y-this._target.node.position.y;let t=this._target.height-this._targetOldSize;const s=this._trans.anchorY;this._changePos.set(this._selfOldPos),this._target.getComponent(Label)&&!this._target.node.active&&(t=this._targetOldSize);const i=e+t;this._trans.height=this._selfOldSize+i,this._dir==WidgetDirection.TOP_EXTEND?this.node.setPosition(this._changePos):this._dir==WidgetDirection.BOTTOM_EXTEND&&(this._changePos.y-=i*(1-s),this.node.setPosition(v3(this._changePos)))}}updatePos(){const e=this._trans,t=this._target;let s=this.getPos(t,this._targetDir)-this._distance;if(this._changePos.set(this.node.worldPosition),this._isVertical){switch(this._dir){case WidgetDirection.TOP:s-=e.height*(1-e.anchorY);break;case WidgetDirection.BOTTOM:s+=e.height*e.anchorY;break}this._changePos.y=s}else this._changePos.x=s;this.node.worldPosition=this._changePos}updateTargetPos(){EDITOR&&null==this._changePos&&(console.error("编辑器数据错乱, 请重新添加本组件"),this._changePos=v3()),this.target.node.getPosition(this._targetOldPos),this.node.getPosition(this._selfOldPos),this._isVertical?(this._selfOldSize=this._trans.height,this._targetOldSize=this._target.height):(this._selfOldSize=this._trans.width,this._targetOldSize=this._target.height)}updateDistance(){if(!EDITOR)return;if(null==this._target)return;const e=this.node.getComponent(UITransform),t=this._target,s=this.getPos(e,this._dir),i=this.getPos(t,this._targetDir);this._distance=i-s}getPos(e,t){if(this._isVertical){let s=e.node.worldPosition.y;const i=e.height,o=e.anchorY;switch(t){case WidgetDirection.TOP:case WidgetDirection.TOP_EXTEND:return e.node.active||(s=s-i-this.visibleOffset),s+i*(1-o);case WidgetDirection.BOTTOM:case WidgetDirection.BOTTOM_EXTEND:return e.node.active||(s=s+i+this.visibleOffset),s-i*o}}else{const s=e.node.worldPosition.x,i=e.width,o=e.anchorX;switch(t){case WidgetDirection.LEFT:return s-i*o;case WidgetDirection.RIGHT:return s+i*(1-o)}}}};__decorate$6([property$6({type:UITransform})],CTWidget.prototype,"target",null),__decorate$6([property$6({type:UITransform})],CTWidget.prototype,"_target",void 0),__decorate$6([property$6({type:Enum(WidgetBase)})],CTWidget.prototype,"targetDir",null),__decorate$6([property$6],CTWidget.prototype,"_targetDir",void 0),__decorate$6([property$6({type:Enum(WidgetDirection)})],CTWidget.prototype,"dir",null),__decorate$6([property$6],CTWidget.prototype,"_dir",void 0),__decorate$6([property$6({type:CCFloat})],CTWidget.prototype,"visibleOffset",void 0),__decorate$6([property$6],CTWidget.prototype,"_isVertical",void 0),__decorate$6([property$6],CTWidget.prototype,"_distance",void 0),__decorate$6([property$6],CTWidget.prototype,"_changePos",void 0),__decorate$6([property$6],CTWidget.prototype,"_targetOldPos",void 0),__decorate$6([property$6],CTWidget.prototype,"_targetOldSize",void 0),__decorate$6([property$6],CTWidget.prototype,"_selfOldPos",void 0),__decorate$6([property$6],CTWidget.prototype,"_selfOldSize",void 0),CTWidget=__decorate$6([ccclass$6("CTWidget"),menu$5("moye/CTWidget"),executeInEditMode$2],CTWidget);const RoundBoxAssembler={GetIndexBuffer(e){const t=[0,1,2,2,3,0,4,5,6,6,7,4,8,9,10,10,11,8];let s=12;const i=function(i,o,r){let n=o;for(let o=0;o<e.segments-1;o++){const e=s;s++,t.push(i,n,e),n=e}t.push(i,n,r)};return e.leftBottom&&i(3,4,0),e.leftTop&&i(2,1,5),e.rightTop&&i(9,6,10),e.rightBottom&&i(8,11,7),t},createData(e){const t=e.requestRenderData();let s=0;s+=e.leftBottom?1:0,s+=e.leftTop?1:0,s+=e.rightTop?1:0,s+=e.rightBottom?1:0;const i=12+(e.segments-1)*s;t.dataLength=i,t.resize(i,18+3*e.segments*s);const o=RoundBoxAssembler.GetIndexBuffer(e);return t.chunk.setIndexBuffer(o),t},updateRenderData(e){const t=e.spriteFrame;dynamicAtlasManager.packToDynamicAtlas(e,t),this.updateUVs(e);const s=e.renderData;s&&t&&(s.vertDirty&&this.updateVertexData(e),s.updateRenderData(e,t))},updateWorldVerts(e,t){const s=e.renderData,i=t.vb,o=s.data,r=e.node.worldMatrix,n=s.floatStride;let a=0;const c=o.length;for(let e=0;e<c;e++){const t=o[e],s=t.x,c=t.y;let l=r.m03*s+r.m07*c+r.m15;l=l?1/l:1,a=e*n,i[a+0]=(r.m00*s+r.m04*c+r.m12)*l,i[a+1]=(r.m01*s+r.m05*c+r.m13)*l,i[a+2]=(r.m02*s+r.m06*c+r.m14)*l}},fillBuffers(e){if(null===e)return;const t=e.renderData,s=t.chunk;(e.node.hasChangedFlags||t.vertDirty)&&(this.updateWorldVerts(e,s),t.vertDirty=!1),(e._flagChangedVersion!==e.node.flagChangedVersion||t.vertDirty)&&(this.updateWorldVerts(e,s),t.vertDirty=!1,e._flagChangedVersion=e.node.flagChangedVersion),s.bufferId;const i=s.vertexOffset,o=s.meshBuffer,r=s.meshBuffer.iData;let n=o.indexOffset;const a=i,c=RoundBoxAssembler.GetIndexBuffer(e);for(let e=0;e<t.indexCount;e++)r[n++]=a+c[e];o.indexOffset+=t.indexCount},updateVertexData(e){const t=e.renderData;if(!t)return;const s=e.node._uiProps.uiTransformComp,i=t.data,o=s.width,r=s.height,n=s.anchorX*o,a=s.anchorY*r,c=0-n,l=o-n,h=r-a,d=0-a,p=c+e.radius,_=d+e.radius,u=h-e.radius,g=l-e.radius;i[0].x=c,i[0].y=e.leftBottom?_:d,i[1].x=c,i[1].y=e.leftTop?u:h,i[2].x=p,i[2].y=e.leftTop?u:h,i[3].x=p,i[3].y=e.leftBottom?_:d,i[4].x=p,i[4].y=d,i[5].x=p,i[5].y=h,i[6].x=g,i[6].y=h,i[7].x=g,i[7].y=d,i[8].x=g,i[8].y=e.rightBottom?_:d,i[9].x=g,i[9].y=e.rightTop?u:h,i[10].x=l,i[10].y=e.rightTop?u:h,i[11].x=l,i[11].y=e.rightBottom?_:d;let y=12;const m=function(t,s){for(let o=1;o<e.segments;o++){const r=s*Math.PI/180-o/e.segments*.5*Math.PI;i[y].x=t.x+Math.cos(r)*e.radius,i[y].y=t.y+Math.sin(r)*e.radius,y++}};e.leftBottom&&m(i[3],270),e.leftTop&&m(i[2],180),e.rightTop&&m(i[9],90),e.rightBottom&&m(i[8],0),t.vertDirty=!0},updateUVs(e){if(!e.spriteFrame)return;const t=e.renderData,s=t.chunk.vb,i=e.spriteFrame.uv,o=i[0],r=i[1],n=i[2],a=i[5],c=Math.abs(n-o),l=a-r,h=e.node._uiProps.uiTransformComp,d=t.data,p=h.width,_=h.height,u=h.anchorX*p,g=h.anchorY*_;for(let e=0;e<t.dataLength;e++)s[e*t.floatStride+3]=o+(d[e].x+u)/p*c,s[e*t.floatStride+4]=r+(d[e].y+g)/_*l},updateColor(e){const t=e.renderData,s=t.chunk.vb;let i=5;const o=e.color,r=o.r/255,n=o.g/255,a=o.b/255,c=o.a/255;for(let e=0;e<t.dataLength;e++,i+=t.floatStride)s[i]=r,s[i+1]=n,s[i+2]=a,s[i+3]=c}};var __decorate$5=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};const{ccclass:ccclass$5,property:property$5,type:type,menu:menu$4}=_decorator;var EventType;!function(e){e.SPRITE_FRAME_CHANGED="spriteframe-changed"}(EventType||(EventType={}));let RoundBoxSprite=class extends UIRenderer{constructor(){super(...arguments),this._sizeMode=Sprite.SizeMode.TRIMMED,this._useGrayscale=!1,this._atlas=null,this._segments=10,this._radius=20,this._spriteFrame=null,this._leftTop=!0,this._rightTop=!0,this._leftBottom=!0,this._rightBottom=!0}get sizeMode(){return this._sizeMode}set sizeMode(e){this._sizeMode!==e&&(this._sizeMode=e,e!==Sprite.SizeMode.CUSTOM&&this._applySpriteSize())}get grayscale(){return this._useGrayscale}set grayscale(e){this._useGrayscale!==e&&(this._useGrayscale=e,this.changeMaterialForDefine(),this.updateMaterial())}get spriteAtlas(){return this._atlas}set spriteAtlas(e){this._atlas!==e&&(this._atlas=e)}get segments(){return this._segments}set segments(e){this._segments=e,this._renderData=null,this._flushAssembler()}get radius(){return this._radius}set radius(e){this._radius=e,this._updateUVs(),this.markForUpdateRenderData(!0)}get spriteFrame(){return this._spriteFrame}set spriteFrame(e){if(this._spriteFrame===e)return;const t=this._spriteFrame;this._spriteFrame=e,this.markForUpdateRenderData(),this._applySpriteFrame(t),EDITOR&&this.node.emit(EventType.SPRITE_FRAME_CHANGED,this)}get leftTop(){return this._leftTop}set leftTop(e){this._leftTop=e,this.resetAssembler()}get rightTop(){return this._rightTop}set rightTop(e){this._rightTop=e,this.resetAssembler()}get leftBottom(){return this._leftBottom}set leftBottom(e){this._leftBottom=e,this.resetAssembler()}get rightBottom(){return this._rightBottom}set rightBottom(e){this._rightBottom=e,this.resetAssembler()}onLoad(){this._flushAssembler()}__preload(){this.changeMaterialForDefine(),super.__preload(),EDITOR&&(this._resized(),this.node.on(NodeEventType.SIZE_CHANGED,this._resized,this))}onEnable(){super.onEnable(),this._activateMaterial();this._spriteFrame&&this._updateUVs()}onDestroy(){EDITOR&&this.node.off(NodeEventType.SIZE_CHANGED,this._resized,this),super.onDestroy()}changeSpriteFrameFromAtlas(e){if(!this._atlas)return void console.warn("SpriteAtlas is null.");const t=this._atlas.getSpriteFrame(e);this.spriteFrame=t}changeMaterialForDefine(){let e;const t=this._instanceMaterialType;this._spriteFrame&&(e=this._spriteFrame.texture);let s=!1;if(e instanceof cclegacy.TextureBase){const t=e.getPixelFormat();s=t===cclegacy.TextureBase.PixelFormat.RGBA_ETC1||t===cclegacy.TextureBase.PixelFormat.RGB_A_PVRTC_4BPPV1||t===cclegacy.TextureBase.PixelFormat.RGB_A_PVRTC_2BPPV1}s&&this.grayscale?this._instanceMaterialType=InstanceMaterialType.USE_ALPHA_SEPARATED_AND_GRAY:s?this._instanceMaterialType=InstanceMaterialType.USE_ALPHA_SEPARATED:this.grayscale?this._instanceMaterialType=InstanceMaterialType.GRAYSCALE:this._instanceMaterialType=InstanceMaterialType.ADD_COLOR_AND_TEXTURE,t!==this._instanceMaterialType&&this.updateMaterial()}_updateBuiltinMaterial(){let e=super._updateBuiltinMaterial();if(this.spriteFrame&&this.spriteFrame.texture instanceof RenderTexture){const t={SAMPLE_FROM_RT:!0,...e.passes[0].defines},s=new Material;s.initialize({effectAsset:e.effectAsset,defines:t}),e=s}return e}_render(e){e.commitComp(this,this.renderData,this._spriteFrame,this._assembler,null)}_canRender(){if(!super._canRender())return!1;const e=this._spriteFrame;return!(!e||!e.texture)}resetAssembler(){this._assembler=null,this._flushAssembler()}_flushAssembler(){const e=RoundBoxAssembler;this._assembler!==e&&(this.destroyRenderData(),this._assembler=e),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.getRenderMaterial(0),this.markForUpdateRenderData(),this.spriteFrame&&this._assembler.updateRenderData(this),this._updateColor())}_applySpriteSize(){if(this._spriteFrame){if(BUILD||!this._spriteFrame.isDefault)if(Sprite.SizeMode.RAW===this._sizeMode){const e=this._spriteFrame.originalSize;this.node._uiProps.uiTransformComp.setContentSize(e)}else if(Sprite.SizeMode.TRIMMED===this._sizeMode){const e=this._spriteFrame.rect;this.node._uiProps.uiTransformComp.setContentSize(e.width,e.height)}this.markForUpdateRenderData(!0),this._assembler.updateRenderData(this)}}_resized(){if(EDITOR&&this._spriteFrame){const e=this.node._uiProps.uiTransformComp.contentSize;let t=e.width,s=e.height;if(this._sizeMode===Sprite.SizeMode.RAW){const e=this._spriteFrame.originalSize;t=e.width,s=e.height}else if(this._sizeMode===Sprite.SizeMode.TRIMMED){const e=this._spriteFrame.rect;t=e.width,s=e.height}t===e.width&&s===e.height||(this._sizeMode=Sprite.SizeMode.CUSTOM)}}_activateMaterial(){const e=this._spriteFrame,t=this.getRenderMaterial(0);e&&t&&this.markForUpdateRenderData(),this.renderData&&(this.renderData.material=t)}_updateUVs(){this._assembler&&this._assembler.updateUVs(this)}_applySpriteFrame(e){const t=this._spriteFrame;let s=!1;t&&(e&&e.texture===t.texture||(s=!0),s&&(this.renderData&&(this.renderData.textureDirty=!0),this.changeMaterialForDefine()),this._applySpriteSize())}};__decorate$5([property$5({serializable:!0})],RoundBoxSprite.prototype,"_sizeMode",void 0),__decorate$5([type(Sprite.SizeMode)],RoundBoxSprite.prototype,"sizeMode",null),__decorate$5([property$5({serializable:!0})],RoundBoxSprite.prototype,"_useGrayscale",void 0),__decorate$5([property$5({type:CCBoolean})],RoundBoxSprite.prototype,"grayscale",null),__decorate$5([property$5({serializable:!0})],RoundBoxSprite.prototype,"_atlas",void 0),__decorate$5([type(SpriteAtlas)],RoundBoxSprite.prototype,"spriteAtlas",null),__decorate$5([property$5({type:CCInteger,serializable:!0})],RoundBoxSprite.prototype,"_segments",void 0),__decorate$5([property$5({type:CCInteger,serializable:!0,min:1})],RoundBoxSprite.prototype,"segments",null),__decorate$5([property$5({type:CCFloat,serializable:!0})],RoundBoxSprite.prototype,"_radius",void 0),__decorate$5([property$5({type:CCFloat,serializable:!0,min:0})],RoundBoxSprite.prototype,"radius",null),__decorate$5([property$5({serializable:!0})],RoundBoxSprite.prototype,"_spriteFrame",void 0),__decorate$5([type(SpriteFrame)],RoundBoxSprite.prototype,"spriteFrame",null),__decorate$5([property$5({serializable:!0})],RoundBoxSprite.prototype,"_leftTop",void 0),__decorate$5([property$5({serializable:!0})],RoundBoxSprite.prototype,"leftTop",null),__decorate$5([property$5({serializable:!0})],RoundBoxSprite.prototype,"_rightTop",void 0),__decorate$5([property$5({serializable:!0})],RoundBoxSprite.prototype,"rightTop",null),__decorate$5([property$5({serializable:!0})],RoundBoxSprite.prototype,"_leftBottom",void 0),__decorate$5([property$5({serializable:!0})],RoundBoxSprite.prototype,"leftBottom",null),__decorate$5([property$5({serializable:!0})],RoundBoxSprite.prototype,"_rightBottom",void 0),__decorate$5([property$5({serializable:!0})],RoundBoxSprite.prototype,"rightBottom",null),RoundBoxSprite=__decorate$5([ccclass$5("RoundBoxSprite"),menu$4("moye/RoundBoxSprite")],RoundBoxSprite);var __decorate$4=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};const{ccclass:ccclass$4,property:property$4,executeInEditMode:executeInEditMode$1,menu:menu$3}=_decorator;var UIControllerIndex;!function(e){e[e.Index_0=1]="Index_0",e[e.Index_1=2]="Index_1",e[e.Index_2=4]="Index_2",e[e.Index_3=8]="Index_3",e[e.Index_4=16]="Index_4",e[e.Index_5=32]="Index_5",e[e.Index_6=64]="Index_6",e[e.Index_7=128]="Index_7",e[e.Index_8=256]="Index_8",e[e.Index_9=512]="Index_9",e[e.Index_10=1024]="Index_10",e[e.Index_11=2048]="Index_11",e[e.Index_12=4096]="Index_12"}(UIControllerIndex||(UIControllerIndex={}));let UIController=class extends Component{constructor(){super(...arguments),this._index=UIControllerIndex.Index_0,this._listeners=[]}set index(e){this._index!=e&&(this._index=e,this.notifyListeners())}get index(){return this._index}onDestroy(){this._listeners=[]}addListener(e){if(-1==this._listeners.indexOf(e)&&this._listeners.push(e),EDITOR)for(let e=this._listeners.length-1;e>=0;e--)null!=this._listeners[e]&&null!=this._listeners[e]||this._listeners.splice(e,1)}removeListener(e){const t=this._listeners.indexOf(e);if(-1!=t&&this._listeners.splice(t,1),EDITOR)for(let e=this._listeners.length-1;e>=0;e--)null!=this._listeners[e]&&null!=this._listeners[e]||this._listeners.splice(e,1)}notifyListeners(){for(let e=0;e<this._listeners.length;e++)this._listeners[e]&&this._listeners[e].onChangeIndex(this._index);if(EDITOR){for(let e=this._listeners.length-1;e>=0;e--)null!=this._listeners[e]&&null!=this._listeners[e]||this._listeners.splice(e,1);const e=this.node.getComponent("UIControllerListener");e&&e.registerUIController()}}};__decorate$4([property$4],UIController.prototype,"_index",void 0),__decorate$4([property$4({type:Enum(UIControllerIndex),displayOrder:1})],UIController.prototype,"index",null),__decorate$4([property$4],UIController.prototype,"_listeners",void 0),UIController=__decorate$4([ccclass$4("UIController"),menu$3("moye/UIController"),executeInEditMode$1],UIController);var __decorate$3=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};const{ccclass:ccclass$3,property:property$3}=_decorator;var UIControllerIndexMask,UIControlType;!function(e){e[e.Index_0=1]="Index_0",e[e.Index_1=2]="Index_1",e[e.Index_2=4]="Index_2",e[e.Index_3=8]="Index_3",e[e.Index_4=16]="Index_4",e[e.Index_5=32]="Index_5",e[e.Index_6=64]="Index_6",e[e.Index_7=128]="Index_7",e[e.Index_8=256]="Index_8",e[e.Index_9=512]="Index_9",e[e.Index_10=1024]="Index_10",e[e.Index_11=2048]="Index_11",e[e.Index_12=4096]="Index_12"}(UIControllerIndexMask||(UIControllerIndexMask={})),function(e){e[e.None=0]="None",e[e.Visible=1]="Visible",e[e.Position=2]="Position",e[e.Size=3]="Size",e[e.Scale=4]="Scale",e[e.Angle=5]="Angle",e[e.Anchor=6]="Anchor",e[e.UIController=7]="UIController"}(UIControlType||(UIControlType={}));let UIControllerAttr=class{constructor(){this.controlType=UIControlType.None,this.indexMask=UIControllerIndexMask.Index_0,this._positionMap={},this._sizeMap={},this._scaleMap={},this._angleMap={},this._anchorMap={},this._uiControllerMap={}}hasIndex(e){return 0!=(this.indexMask&e)}setPosition(e,t){this._positionMap[e]=t.clone()}getPosition(e){return this._positionMap[e]}setSize(e,t){this._sizeMap[e]=t.clone()}getSize(e){return this._sizeMap[e]}setScale(e,t){this._scaleMap[e]=t.clone()}getScale(e){return this._scaleMap[e]}setAngle(e,t){this._angleMap[e]=t}getAngle(e){return this._angleMap[e]}setAnchor(e,t){this._anchorMap[e]=t.clone()}getAnchor(e){return this._anchorMap[e]}setUIController(e,t){this._uiControllerMap[e]=t}getUIController(e){return this._uiControllerMap[e]}clearOtherData(){switch(this.controlType){case UIControlType.Visible:this.clearPositionData(),this.clearSizeData(),this.clearScaleData(),this.clearAngleData(),this.clearAnchorData(),this.clearUIControllerData();break;case UIControlType.Position:this.clearSizeData(),this.clearScaleData(),this.clearAngleData(),this.clearAnchorData(),this.clearUIControllerData();break;case UIControlType.Size:this.clearPositionData(),this.clearScaleData(),this.clearAngleData(),this.clearAnchorData(),this.clearUIControllerData();break;case UIControlType.Scale:this.clearPositionData(),this.clearSizeData(),this.clearAngleData(),this.clearAnchorData(),this.clearUIControllerData();break;case UIControlType.Angle:this.clearPositionData(),this.clearSizeData(),this.clearScaleData(),this.clearAnchorData(),this.clearUIControllerData();break;case UIControlType.Anchor:this.clearPositionData(),this.clearSizeData(),this.clearScaleData(),this.clearAngleData(),this.clearUIControllerData();break;case UIControlType.UIController:this.clearPositionData(),this.clearSizeData(),this.clearScaleData(),this.clearAngleData(),this.clearAnchorData()}}clearPositionData(){this._positionMap={}}clearSizeData(){this._sizeMap={}}clearScaleData(){this._scaleMap={}}clearAngleData(){this._angleMap={}}clearAnchorData(){this._anchorMap={}}clearUIControllerData(){this._uiControllerMap={}}};__decorate$3([property$3({type:Enum(UIControlType)})],UIControllerAttr.prototype,"controlType",void 0),__decorate$3([property$3({type:BitMask(UIControllerIndexMask),visible(){return this.controlType==UIControlType.Visible}})],UIControllerAttr.prototype,"indexMask",void 0),__decorate$3([property$3],UIControllerAttr.prototype,"_positionMap",void 0),__decorate$3([property$3],UIControllerAttr.prototype,"_sizeMap",void 0),__decorate$3([property$3],UIControllerAttr.prototype,"_scaleMap",void 0),__decorate$3([property$3],UIControllerAttr.prototype,"_angleMap",void 0),__decorate$3([property$3],UIControllerAttr.prototype,"_anchorMap",void 0),__decorate$3([property$3],UIControllerAttr.prototype,"_uiControllerMap",void 0),UIControllerAttr=__decorate$3([ccclass$3("UIControllerAttr")],UIControllerAttr);var __decorate$2=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};const{ccclass:ccclass$2,property:property$2,executeInEditMode:executeInEditMode,menu:menu$2}=_decorator;let UIControllerListener=class extends Component{constructor(){super(...arguments),this._controller=null,this._attrs=[]}set controller(e){this._controller!=e&&(this._controller&&this._controller.removeListener(this),this._controller=e,this.listenController())}get controller(){return this._controller}get curIndex(){if(!this._controller)return"";return`${UIControllerIndex[this._controller.index]}`}set attrs(e){this._attrs=e,this.updateAttr()}get attrs(){return this._attrs}onLoad(){this.listenController()}onDestroy(){if(EDITOR)this.unRegisterEditorEvent();else{if(!this._controller)return;this._controller.removeListener(this)}}onDisable(){}onFocusInEditor(){this.registerEditorEvent()}onLostFocusInEditor(){this.unRegisterEditorEvent()}registerEditorEvent(){this.unRegisterEditorEvent(),this.node.on(Node.EventType.ACTIVE_IN_HIERARCHY_CHANGED,this.onChangeActive,this),this.node.on(Node.EventType.TRANSFORM_CHANGED,this.onTransformChange,this),this.node.on(Node.EventType.SIZE_CHANGED,this.onSizeChange,this),this.node.on(Node.EventType.ANCHOR_CHANGED,this.onAnchorChange,this)}unRegisterEditorEvent(){this.node.off(Node.EventType.ACTIVE_IN_HIERARCHY_CHANGED,this.onChangeActive,this),this.node.off(Node.EventType.TRANSFORM_CHANGED,this.onTransformChange,this),this.node.off(Node.EventType.SIZE_CHANGED,this.onSizeChange,this),this.node.off(Node.EventType.ANCHOR_CHANGED,this.onAnchorChange,this)}listenController(){this._controller&&this._controller.addListener(this)}onChangeActive(){}onTransformChange(){this.registerTransform()}onSizeChange(){this.registerSize()}onAnchorChange(){this.registerAnchor()}registerTransform(){if(!this._controller)return;const e=this._controller.index;for(let t=0;t<this._attrs.length;t++){const s=this._attrs[t];s.controlType==UIControlType.Position?s.setPosition(e,this.node.position):s.controlType==UIControlType.Scale?s.setScale(e,this.node.scale):s.controlType==UIControlType.Angle&&s.setAngle(e,this.node.angle)}}registerSize(){if(!this._controller)return;const e=this._controller.index;for(let t=0;t<this._attrs.length;t++){const s=this._attrs[t];if(s.controlType==UIControlType.Size){const t=this.node.getComponent(UITransform);s.setSize(e,t.contentSize)}}}registerAnchor(){if(!this._controller)return;const e=this._controller.index;for(let t=0;t<this._attrs.length;t++){const s=this._attrs[t];if(s.controlType==UIControlType.Anchor){const t=this.node.getComponent(UITransform);s.setAnchor(e,t.anchorPoint)}}}registerUIController(){if(!this._controller)return;const e=this._controller.index;for(let t=0;t<this._attrs.length;t++){const s=this._attrs[t];s.controlType==UIControlType.UIController&&s.setUIController(e,this.node.getComponent(UIController).index)}}updateAttr(){if(!this._controller)return;const e=this._controller.index;for(let e=0;e<this._attrs.length;e++){this._attrs[e].clearOtherData()}this.onChangeIndex(e)}onChangeIndex(e){for(let t=0;t<this._attrs.length;t++){const s=this._attrs[t];switch(s.controlType){case UIControlType.Visible:this.node.active=s.hasIndex(e);break;case UIControlType.Position:{const t=s.getPosition(e);t?this.node.position=t:s.setPosition(e,this.node.position);break}case UIControlType.Size:{const t=s.getSize(e),i=this.node.getComponent(UITransform);t?i.setContentSize(t):s.setSize(e,i.contentSize);break}case UIControlType.Scale:{const t=s.getScale(e);t?this.node.scale=t:s.setScale(e,this.node.scale);break}case UIControlType.Angle:{const t=s.getAngle(e);null==t||null==t?s.setAngle(e,this.node.angle):this.node.angle=t;break}case UIControlType.Anchor:{const t=s.getAnchor(e);if(t){this.node.getComponent(UITransform).setAnchorPoint(t)}else s.setAnchor(e,this.node.getComponent(UITransform).anchorPoint);break}case UIControlType.UIController:{const t=s.getUIController(e);null!=t&&null!=t?this.node.getComponent(UIController).index=t:s.setUIController(e,this.node.getComponent(UIController).index);break}}}}};__decorate$2([property$2],UIControllerListener.prototype,"_controller",void 0),__decorate$2([property$2(UIController)],UIControllerListener.prototype,"controller",null),__decorate$2([property$2({type:[CCString],visible(){return null!=this._controller}})],UIControllerListener.prototype,"curIndex",null),__decorate$2([property$2],UIControllerListener.prototype,"_attrs",void 0),__decorate$2([property$2({type:[UIControllerAttr],visible(){return null!=this._controller}})],UIControllerListener.prototype,"attrs",null),UIControllerListener=__decorate$2([ccclass$2("UIControllerListener"),menu$2("moye/UIControllerListener"),executeInEditMode],UIControllerListener);var __decorate$1=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};const{ccclass:ccclass$1,property:property$1,menu:menu$1}=_decorator,instance=new EventTarget,SET_JOYSTICK_TYPE="SET_JOYSTICK_TYPE";var DirectionType,SpeedType,JoystickType;!function(e){e[e.FOUR=0]="FOUR",e[e.EIGHT=1]="EIGHT",e[e.ALL=2]="ALL"}(DirectionType||(DirectionType={})),function(e){e[e.STOP=0]="STOP",e[e.NORMAL=1]="NORMAL",e[e.FAST=2]="FAST"}(SpeedType||(SpeedType={})),function(e){e[e.FIXED=0]="FIXED",e[e.FOLLOW=1]="FOLLOW"}(JoystickType||(JoystickType={}));let YYJJoystick=class extends Component{constructor(){super(...arguments),this.dot=null,this.ring=null,this.joystickType=JoystickType.FIXED,this.directionType=DirectionType.ALL,this._stickPos=new Vec3,this._touchLocation=new Vec2,this.radius=50}onLoad(){if(!this.dot)return void console.warn("Joystick Dot is null!");if(!this.ring)return void console.warn("Joystick Ring is null!");const e=this.ring.getComponent(UITransform),t=2*this.radius,s=new Size(t,t);e?.setContentSize(s),this.ring.getChildByName("bg").getComponent(UITransform)?.setContentSize(s),this._initTouchEvent();const i=this.node.getComponent(UIOpacity);this.joystickType===JoystickType.FOLLOW&&i&&(i.opacity=0)}onEnable(){instance.on(SET_JOYSTICK_TYPE,this._onSetJoystickType,this)}onDisable(){instance.off(SET_JOYSTICK_TYPE,this._onSetJoystickType,this)}_onSetJoystickType(e){this.joystickType=e;const t=this.node.getComponent(UIOpacity);t&&(t.opacity=e===JoystickType.FIXED?255:0)}_initTouchEvent(){this.node.on(Input.EventType.TOUCH_START,this._touchStartEvent,this),this.node.on(Input.EventType.TOUCH_MOVE,this._touchMoveEvent,this),this.node.on(Input.EventType.TOUCH_END,this._touchEndEvent,this),this.node.on(Input.EventType.TOUCH_CANCEL,this._touchEndEvent,this)}_touchStartEvent(e){if(!this.ring||!this.dot)return;instance.emit(Input.EventType.TOUCH_START,e);const t=e.getUILocation(),s=new Vec3(t.x,t.y);if(this.joystickType===JoystickType.FIXED){this._stickPos=this.ring.getPosition();const e=s.subtract(this.ring.getPosition()),t=e.length();this.radius>t&&this.dot.setPosition(e)}else this.joystickType===JoystickType.FOLLOW&&(this._stickPos=s,this.node.getComponent(UIOpacity).opacity=255,this._touchLocation=e.getUILocation(),this.ring.setPosition(s),this.dot.setPosition(new Vec3))}_touchMoveEvent(e){if(!this.dot||!this.ring)return;if(this.joystickType===JoystickType.FOLLOW&&this._touchLocation===e.getUILocation())return!1;const t=e.getUILocation(),s=new Vec3(t.x,t.y).subtract(this.ring.getPosition()),i=s.length();let o=SpeedType.NORMAL;this.radius>i?(this.dot.setPosition(s),o=SpeedType.NORMAL):(this.dot.setPosition(s.normalize().multiplyScalar(this.radius)),o=SpeedType.FAST),instance.emit(Input.EventType.TOUCH_MOVE,e,{speedType:o,moveVec:s.normalize()})}_touchEndEvent(e){this.dot&&this.ring&&(this.dot.setPosition(new Vec3),this.joystickType===JoystickType.FOLLOW&&(this.node.getComponent(UIOpacity).opacity=0),instance.emit(Input.EventType.TOUCH_END,e,{speedType:SpeedType.STOP}))}};__decorate$1([property$1({type:Node,displayName:"Dot",tooltip:"摇杆操纵点"})],YYJJoystick.prototype,"dot",void 0),__decorate$1([property$1({type:Node,displayName:"Ring",tooltip:"摇杆背景节点"})],YYJJoystick.prototype,"ring",void 0),__decorate$1([property$1({type:Enum(JoystickType),displayName:"Touch Type",tooltip:"触摸类型"})],YYJJoystick.prototype,"joystickType",void 0),__decorate$1([property$1({type:Enum(DirectionType),displayName:"Direction Type",tooltip:"方向类型"})],YYJJoystick.prototype,"directionType",void 0),__decorate$1([property$1({type:Vec3,tooltip:"摇杆所在位置"})],YYJJoystick.prototype,"_stickPos",void 0),__decorate$1([property$1({type:Vec2,tooltip:"触摸位置"})],YYJJoystick.prototype,"_touchLocation",void 0),__decorate$1([property$1({type:CCInteger,displayName:"Ring Radius",tooltip:"半径"})],YYJJoystick.prototype,"radius",void 0),YYJJoystick=__decorate$1([ccclass$1("YYJJoystick"),menu$1("moye/YYJJoystick")],YYJJoystick);class YYJJoystickCom extends Entity{constructor(){super(...arguments),this.moveDir=new Vec3(0,1,0),this._speedType=SpeedType.STOP,this._moveSpeed=0,this.stopSpeed=0,this.normalSpeed=100,this.fastSpeed=200,this.isRotation=!0}init(e){return this._entity=e,instance.on(Input.EventType.TOUCH_START,this.onTouchStart,this),instance.on(Input.EventType.TOUCH_MOVE,this.onTouchMove,this),instance.on(Input.EventType.TOUCH_END,this.onTouchEnd,this),this}destroy(){instance.off(Input.EventType.TOUCH_START,this.onTouchStart,this),instance.off(Input.EventType.TOUCH_MOVE,this.onTouchMove,this),instance.off(Input.EventType.TOUCH_END,this.onTouchEnd,this)}onTouchStart(){}onTouchMove(e,t){const s=this._speedType;this._speedType=t.speedType,this.moveDir=t.moveVec,this.onSetMoveSpeed(this._speedType),s!==this._speedType&&this._entity.speedChange(this._speedType,this._moveSpeed)}onTouchEnd(e,t){const s=this._speedType;this._speedType=t.speedType,this.onSetMoveSpeed(this._speedType),s!==this._speedType&&this._entity.speedChange(this._speedType,this._moveSpeed)}onSetMoveSpeed(e){switch(e){case SpeedType.STOP:this._moveSpeed=this.stopSpeed;break;case SpeedType.NORMAL:this._moveSpeed=this.normalSpeed;break;case SpeedType.FAST:this._moveSpeed=this.fastSpeed}}move(){this.isRotation&&this._entity.setAngle(misc.radiansToDegrees(Math.atan2(this.moveDir.y,this.moveDir.x))-90);const e=this._entity.getPos().add(this.moveDir.clone().multiplyScalar(this._moveSpeed/60));this._entity.setPos(e)}update(){this._speedType!==SpeedType.STOP&&this.move()}}var __decorate=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};const{ccclass:ccclass,property:property,menu:menu}=_decorator;let YYJJoystickPlayer=class extends Component{constructor(){super(...arguments),this.rigidbody=!1,this.moveDir=new Vec3(0,1,0),this._speedType=SpeedType.STOP,this._moveSpeed=0,this.stopSpeed=0,this.normalSpeed=100,this.fastSpeed=200,this.isRotation=!0,this._body=null}onLoad(){this.rigidbody&&(this._body=this.node.getComponent(RigidBody2D)),instance.on(Input.EventType.TOUCH_START,this.onTouchStart,this),instance.on(Input.EventType.TOUCH_MOVE,this.onTouchMove,this),instance.on(Input.EventType.TOUCH_END,this.onTouchEnd,this)}onTouchStart(){}onTouchMove(e,t){this._speedType=t.speedType,this.moveDir=t.moveVec,this.onSetMoveSpeed(this._speedType)}onTouchEnd(e,t){this._speedType=t.speedType,this.onSetMoveSpeed(this._speedType)}onSetMoveSpeed(e){switch(e){case SpeedType.STOP:this._moveSpeed=this.stopSpeed;break;case SpeedType.NORMAL:this._moveSpeed=this.normalSpeed;break;case SpeedType.FAST:this._moveSpeed=this.fastSpeed}}move(){if(this.isRotation&&(this.node.angle=misc.radiansToDegrees(Math.atan2(this.moveDir.y,this.moveDir.x))-90),this.rigidbody&&this._body){const e=this.moveDir.clone().multiplyScalar(this._moveSpeed/20),t=new Vec2(e.x,e.y);this._body.applyForceToCenter(t,!0)}else{const e=this.node.getPosition().add(this.moveDir.clone().multiplyScalar(this._moveSpeed/60));this.node.setPosition(e)}}update(e){this._speedType!==SpeedType.STOP&&this.move()}};__decorate([property({displayName:"刚体模式",tooltip:"不会立即停止"})],YYJJoystickPlayer.prototype,"rigidbody",void 0),__decorate([property({displayName:"Move Dir",tooltip:"移动方向"})],YYJJoystickPlayer.prototype,"moveDir",void 0),__decorate([property({tooltip:"速度级别"})],YYJJoystickPlayer.prototype,"_speedType",void 0),__decorate([property({type:CCInteger,tooltip:"移动速度"})],YYJJoystickPlayer.prototype,"_moveSpeed",void 0),__decorate([property({type:CCInteger,tooltip:"停止时速度"})],YYJJoystickPlayer.prototype,"stopSpeed",void 0),__decorate([property({type:CCInteger,tooltip:"正常速度"})],YYJJoystickPlayer.prototype,"normalSpeed",void 0),__decorate([property({type:CCInteger,tooltip:"最快速度"})],YYJJoystickPlayer.prototype,"fastSpeed",void 0),__decorate([property({tooltip:"最快速度"})],YYJJoystickPlayer.prototype,"isRotation",void 0),YYJJoystickPlayer=__decorate([ccclass("YYJJoystickPlayer"),menu("moye/YYJJoystickPlayer")],YYJJoystickPlayer);class YYJJoystickSpeedChangeEvent extends AEvent{}class YYJJoystickMoveEvent extends AEvent{}class YYJJoystickListener extends Entity{constructor(){super(...arguments),this._speedType=SpeedType.STOP}awake(){instance.on(Input.EventType.TOUCH_START,this.onTouchStart,this),instance.on(Input.EventType.TOUCH_MOVE,this.onTouchMove,this),instance.on(Input.EventType.TOUCH_END,this.onTouchEnd,this)}destroy(){instance.off(Input.EventType.TOUCH_START,this.onTouchStart,this),instance.off(Input.EventType.TOUCH_MOVE,this.onTouchMove,this),instance.off(Input.EventType.TOUCH_END,this.onTouchEnd,this)}onTouchStart(){}onTouchMove(e,t){const s=this._speedType;this._speedType=t.speedType,s!==this._speedType&&EventSystem.get().publish(this.domainScene(),YYJJoystickSpeedChangeEvent.create({speedType:this._speedType})),EventSystem.get().publish(this.domainScene(),YYJJoystickMoveEvent.create({dir:t.moveVec}))}onTouchEnd(e,t){this.onTouchMove(e,t)}}export{AEvent,AEventHandler,AMHandler,AMoyeView,AWait,AfterAddLoginCom,AfterCreateClientScene,AfterCreateCurrentScene,AfterProgramInit,AfterProgramStart,AfterSingletonAdd,AssetOperationHandle,AsyncButtonListener,BeforeProgramInit,BeforeProgramStart,BeforeSingletonAdd,BgAdapter,BundleAsset,CTWidget,CancellationToken,CancellationTokenTag,CenterLayout,CoroutineLock,CoroutineLockItem,CoroutineLockTag,DecoratorCollector,Entity,EntityCenter,EventCom,EventDecorator,EventDecoratorType,EventHandlerTag,EventSystem,Game,IPEndPoint,IdGenerator,IdStruct,InstanceIdStruct,JsHelper,LocalStorageHelper,Logger,LoginCom,MoyeAssets,MoyeLabel,MoyeViewMgr,MsgHandlerDecorator,MsgHandlerDecoratorType,MsgMgr,MsgSerializeMgr,MultiMap,NetCom,NetServices,NetworkErrorCode,NodeNotBuild,ObjectPool,ObjectWait,Options,Program,RecycleObj,RichTextListener,Root,RoundBoxSprite,Scene,SceneFactory,SceneRefCom,SceneType,Session,SessionCom,Singleton,SizeFollow,SpeedType,Task,TimeHelper,TimeInfo,TimerMgr,UIControlType,UIController,UIControllerAttr,UIControllerIndex,UIControllerIndexMask,UIControllerListener,ViewDecorator,ViewDecoratorType,ViewLayer,WChannel,WService,WaitError,YYJJoystick,YYJJoystickCom,YYJJoystickListener,YYJJoystickMoveEvent,YYJJoystickSpeedChangeEvent,error,log,safeCall,warn};